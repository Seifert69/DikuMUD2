/*
filename    sands2
password    getcrabs
changedby   Javelin
EmailAdd     Palio <palio@blinksoft.com>
request     compile
version     10
END HEADER*/

/* Zone:    Baardek Keep                                          */
/* Author:  Sand                                                  */
/*                                                                */
/* Version information:                                           */
/*                                                                */
/* v.5 Fixed Tunisk dil to be more user friendly.                 */
/*     Took out the shouting mob to placate ppl.                  */
/*                                                                */
/* v.6 Fixed the exp on Eros.                                     */
/*                                                                */
/* v.7 Changed the inventor so he's less talkative during         */
/*     battle.                                                    */
/*     Fixed a few typos...                                         */
/*                                                                */
/*                                                                */
/*                                                                */
/*                                                                */
/*                                                                */
/*                                                                */
/*                                                                */
/* Previous versions undocumented..                               */


#include<composed.h>

#define WHIMBOIST_ONGOING         "Searching for the sea and the sky."
#define WHIMBOIST_COMPLETE        "Master of sea and sky."
#define VOMOULK_ONGOING           "Helping the Cheleho.."
#define VOMOULK_COMPLETE          "Friend of the Cheleho tribe."
#define SNERT_ONGOING             "Fetching things for Snert."
#define SNERT_COMPLETE            "Snert's Quest, Complete."
#define SNERT_PISSED              "Snert's Enemy."
#define GET_NOTES_FOR_SILK        "Getting Mahrnak's Notes.."
#define BRING_SHIT_TO_GRISHALMUS  "Getting a sword for Grishalmus.."
#define SILK_DONE                 "Silk's Dirty Work, Done."
#define TUNISK_ONGOING            "Searching for a Dragon's Wants.."
#define TUNISK_COMPLETE           "A Dragon Befriended."

%zone sands2
title "Baardek Keep"
lifespan 20
reset RESET_ANYHOW

creators {"javelin"}
notes
" This Zone is by, Philip Burch&n
&c+g javelin@eskimo.com &cw or.. &n
&c+g javelin@nsccux.sccd.ctc.edu &cw &n
Feel free to mail me feedback this way as well as mudmail&n &n
The keep is for level 50-70 (maybe groups of two) characters which is
three stories plus a Dungeon and a tower."

help
"&c+wThe keep is inhabited by spies who watch over Valhalla with a careful
eye, beware of mischievious mobiles and hidden surprises because they
may be watching you! The leader of the spies is Eros, but the master
overseer is Silk and she may be even more dangerous..&n
&cwThis zone is for 50 - 70's soloing or grouped. Look around for hidden
stuff there is some here, I haven't made it too tough as long as you
read the descriptions.. If you need help with something else, Yell for
Sand or Javelin, and I will help you as much as is allowed!&n"

/*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*/
/*-=-=-=-=-=-=-=-=-=-=-=-= Dil -=-=-=-=-=-=-=-=-=-=-=-=-=-=*/
/*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*/
%dil
dilbegin dem_cmd(onr :string);
code{
  :start:
  wait(SFB_DONE, (command(CMD_TELL)) and (onr == activator.name) and (target == self));
  exec(argument, self);
  goto start;
}
dilend

dilbegin tunisk_give();
var
  what_i_got :extraptr;
  pc         :unitptr;
code{
  heartbeat := PULSE_SEC *2;
 :start:
  wait(SFB_DONE, (command(CMD_GIVE)) and (target == self));
  pc := activator;
  if((TUNISK_ONGOING in activator.quests) and (self.position > POSITION_FIGHTING)){
    if("questobj" in medium.names){
      what_i_got := TUNISK_ONGOING in pc.quests;
      if(medium.title in what_i_got.names){
        exec("say I can always you a few extra "+medium.name+"s, thank you.", self);
        destroy(medium);
        pause;
        exec("say Give me one of the daggers that you have not already.", self);
        goto start;
      }
      else{
        addstring(what_i_got.names, medium.title);
        destroy(medium);
        exec("say Thank you "+pc.name+".", self); pause;
        pause;
        goto start;
      }
    }
    else{
      pause;
      exec("say You had best bring me what I want.", self); pause;
      exec("give "+medium.name+" "+pc.name, self);
      exec("drop "+medium.name, self);
      goto start;
    }
  }
}
dilend

/* Move */
dilbegin global_move();
var
  irand :integer;
code
{
 :start:
  heartbeat:=PULSE_SEC*4;
  wait(SFB_TICK, TRUE);
  if(rnd(1,2) == 2)
  {
    irand := rnd(1,4);
    if(irand == 1){
      if(self.outside.exit_info[NORTH] == EX_CLOSED) exec("open north "+self.outside.exit_names[NORTH].[0], self);
      exec("n", self);
    }
    if(irand == 2){
      if(self.outside.exit_info[SOUTH] == EX_CLOSED) exec("open south "+self.outside.exit_names[SOUTH].[0], self);
      exec("s", self);
    }
    if(irand == 3){
      if(self.outside.exit_info[EAST] == EX_CLOSED) exec("open east "+self.outside.exit_names[EAST].[0], self);
      exec("e", self);
    }
    if(irand == 4){
      if(self.outside.exit_info[WEST] == EX_CLOSED) exec("open west "+self.outside.exit_names[WEST].[0], self);
      exec("w", self);
    }
  }
  goto start;
}
dilend
dilbegin blessed_me();
code{
  heartbeat := PULSE_SEC*10;
:start:
  if(rnd(1, 100) == 10){
    act("Javelin's spirit comes and polishes $2n for you with a kiss and a wink.", A_ALWAYS, self.outside, self, null, TO_CHAR);
    act("Javelin's spirit comes and polishes $1n's $2n for $1m with a kiss and a wink.", A_ALWAYS, self.outside, self, null, TO_REST);
  }
  else if(rnd(1, 100) == 10){
    act("Sand's spirit comes and polishes $2n for you with a shy smile", A_ALWAYS, self.outside, self, null, TO_CHAR);
    act("Sand's spirit comes and polishes $1n's $2n for $1m with a shy smile.", A_ALWAYS, self.outside, self, null, TO_REST);
  }
  pause;pause;pause;pause;
  goto start;
} 
dilend
/* Spy Me */
dilbegin aware spy_me();
var
  uspy    :unitptr;
  ticks   :integer;
  count   :integer;
  i_tick  :integer;
  i_quit  :integer;
  temp    :string;
code
{
  heartbeat := PULSE_SEC * 7;
  count := 0;
  ticks := (10 + rnd(1, 30));
 :start:
  i_tick := interrupt(SFB_TICK, TRUE, a_tick);
  i_quit := interrupt(SFB_CMD, ((command(CMD_QUIT)) and (activator == self)), i_quit);
  wait(SFB_DONE, TRUE);
  if((command(CMD_SAY)) and (activator == self))
  {
    clear(i_tick);
    temp := "SPY: "+self.name+" "+argument;
    if(activator == self) sendtoalldil(temp, "earcuff@sands2");
    goto start;
  }
  goto start;
 :i_quit:
  block;
  clear(i_tick);
  clear(i_quit);
  sendtoalldil("SPY: DONE: "+self.name, "earcuff@sands2");
  exec("quit", self);
  quit;
 :a_tick:
  clear(i_tick);
  count := count + 1;
  if(count > ticks)
  {
    sendtoalldil("SPY: DONE: "+self.name, "earcuff@sands2");
    quit;
  }
  goto start;
}
dilend
/*--- GET BOOK ----*/
dilbegin get_book();
var
  Pc        :unitptr;
  BKptr     :unitptr;
  RNDint    :integer;
  newtitle  :string;
  newdescr  :string;
code
{
  heartbeat := PULSE_SEC *2;
  :start:
  wait(SFB_CMD, TRUE);
  if(((command(CMD_GET)) and ("book" in argument)))
  {
    Pc:=activator;
    block;
    RNDint := (rnd(1, 23));
    if(RNDint == 1)
    {
      newtitle := "'Activity Log, 14th Day of the Month of the Heat, Year 204'";
      newdescr := "Arny of Udgaard went to the bank today, talked to Slade, and ran his shop as normal.&n-Listner Vafkee.";
    }
    if(RNDint == 2)
    {
      newtitle := "'The exciting world of fruit'";
      newdescr := "Fruit can be an exciting and exotic thing, one who plays with it is often aroused and thusly playful.";
    }
    if(RNDint == 3)
    {
      newtitle := "'Playboy Compendium'";
      newdescr := "There are no words, only pictures :)";
    }
    if(RNDint == 4)
    {
      newtitle := "'The Wheel Of Time'";
      newdescr := "The Wheel of Time turns, and Ages come and pass, leaving memories that become legend. Legend faades to myth, and even myth is long forgotten when the Age that gave it birth comes again...";
    }
    if(RNDint == 5)
    {
      newtitle := "'The little steam engine that could'";
      newdescr := "It's in a language you can't understand.";
    }
    if(RNDint == 6)
    {
      newtitle := "'Mudding for Dummies'";
      newdescr := "The command 'help' seems to do the trick, if you can't    decide what to use it with, type 'help help'.. Dummy!";
    }
    if(RNDint == 7)
    {
      newtitle := "'Around the Mud in 80 days'";
      newdescr := "If you don't know this book is pretty useless, you've been on this mud for MUCH less then 80 days, sheesh!";
    }
    if(RNDint == 8)
    {
      newtitle := "'Janitor's handbook'";
      newdescr := "Put the mop IN the bucket, remove, rotate and move, repeat.";
    }
    if(RNDint == 9)
    {
      newtitle := "'Everything you wanted to know about women'";
      newdescr := "It's in a language you can't understand.";
    }
    if(RNDint == 10)
    {
      newtitle := "'Activity Log, 11th Day of the Month of the Heat, Year 204'";
      newdescr := (Pc.name +" bored the pants off our listeners today. They seem to have no redeeming qualities at all, not worth further observation.&n-Listner Heinriche.");
    }
    if(RNDint == 11)
    {
      newtitle := "'Sheep Digest'";
      newdescr := "Sheep are fun and exciting, this reviewer reccomends them to any and all horney bastards..";
    }
    if(RNDint == 12)
    {
      newtitle := "'The exciting world of Tuborg'";
      newdescr := "What is there to say about this wonderful creation, It's what keeps Valhalla alive!";
    }
    if(RNDint == 13)
    {
      newtitle := "'Armour of Slade'";
      newdescr := "Slades catalog:&n
      a small wooden shield&n
      a pair of scale mail boots &n
      a long chain mail skirt&n
      a chain mail jerkin&n
      a pair of chain mail sleeves&n
      a chain mail coif&n";
    }
    if(RNDint == 14)
    {
      newtitle := "'Baardek Spy Report #8023'";
      newdescr := "We have been watching the activities of Bob the banker and his wife Bernice. It would seem the two of them lead several sheep into their home at night and out again in the morning. Conclusion drawn later.";
    }
    if(RNDint == 15)
    {
      newtitle := "'Philisophical Compendium'";
      newdescr := "If a tree fell in the cypress forest and no-one was around to hear it, would anyone care?";
    }
    if(RNDint == 16)
    {
      newtitle := "'Udgaard at 1 Silver a Day'";
      newdescr := "Spend all your time in the Chicken's Rest and you should be fine.";
    }
    if(RNDint == 17)
    {
      newtitle := "'Around the Mud in 80 days'";
      newdescr := "If you don't know this book is pretty useless, you've been on this mud for MUCH less then 80 days, sheesh!";
    }
    if(RNDint == 18)
    {
      newtitle := "'Shopkeeper's handbook'";
      newdescr := "Sell things to people because you get them for free and it works out really well.";
    }
    if(RNDint == 19)
    {
      newtitle := "'Everything you wanted to know about men'";
      newdescr := "It's in a language you can't understand.";
    }
    if(RNDint == 20)
    {
      newtitle := "'Activity Log, 9th Day of the Month of the Long Shadows, Year 204'";
      newdescr := (Pc.name +" bored the pants off our listeners today. They seem to have no redeeming qualities at all, not worth further observation.&n-Listner Heinriche.");
    }
    if(RNDint == 21)
    {
      newtitle := "'The Wyrm Scandal'";
      newdescr := "It's in a language you can't understand.";
    }
    if(RNDint == 22)
    {
      newtitle := "'Al Kazeem's Cook Book'";
      newdescr := "It's in a language you can't understand.";
    }
    if(RNDint == 23)
    {
      newtitle := "'The Pros and Cons of Teleporting'";
      newdescr := "It's in a language you can't understand.";
    }
    BKptr := load("book@sands2");
    BKptr.title := newtitle;
    addextra(BKptr.extra, {""}, newdescr);
    link(BKptr, Pc);
    act("You grab $2n from a shelf.", A_SOMEONE, Pc, BKptr, null, TO_CHAR);
    act("$1n grabs $2n from a shelf.", A_SOMEONE, Pc, BKptr, null, TO_REST);
  }
  goto start;
}
dilend
/**** Ivory Path Wander ****/
dilbegin pathwander();
var
  Pc        :unitptr;
  each      :unitptr;
  where_to  :integer;
code
{
  heartbeat:=PULSE_SEC*10;
 :start:
  wait(SFB_CMD, ((activator.type == UNIT_ST_NPC) or (activator.type == UNIT_ST_PC)));
  Pc := activator;
  if(command(CMD_WHERE))
  {
    block;
    act("You get confused.", A_SOMEONE, Pc, null, null, TO_CHAR);
    goto start;
  }
  if(command(CMD_NORTH))
  {
    if(self.position != POSITION_STANDING)
    {
      block;
      act("You are in no position to do that.", A_SOMEONE, Pc, null, null, TO_CHAR);
      goto start;
    }
    if(self.exit_to[NORTH] == self)
    {
      block;
      act("$1n leaves north on the Ivory Path.", A_SOMEONE, Pc, null, null, TO_REST);
      act("You walk north on the Ivory Path.", A_SOMEONE, Pc, null, null, TO_CHAR);
      if(rnd(1,7) == 2) goto finally;
      where_to := rnd(1,15);
      link(Pc, findroom("ivory_"+itoa(where_to)+"@sands2"));
      act("$1n arrives from the south.", A_SOMEONE, Pc, null, null, TO_REST);
      exec("look", Pc);
      foreach(UNIT_ST_PC, each)
      {
        if(((each.master == Pc) and (each.position == POSITION_STANDING)))
        {
          act("You follow $2n north on the Ivory Path.", A_SOMEONE, each, Pc, null, TO_CHAR);
          link(each, findroom("ivory_"+itoa(where_to)+"@sands2"));
          act("$1n arrives from the south.", A_SOMEONE, each, null, null, TO_REST);
          exec("look", each);
        }
        else if(((each.master == Pc) and (each.position != POSITION_STANDING)))
        {
          act("You try to follow $2n, but you are not standing.", A_SOMEONE, each, Pc, null, TO_CHAR);
        }
      }
    }
    goto start;
  }
  if(command(CMD_SOUTH))
  {
    if(self.position != POSITION_STANDING)
    {
      block;
      act("You are in no position to do that.", A_SOMEONE, Pc, null, null, TO_CHAR);
      goto start;
    }
    if(rnd(1,10) == 5) goto finally;
    if(self.exit_to[SOUTH] == self)
    {
      block;
      act("$1n leaves south on the Ivory Path.", A_SOMEONE, Pc, null, null, TO_REST);
      act("You walk south on the Ivory Path.", A_SOMEONE, Pc, null, null, TO_CHAR);
      if(rnd(1,25) == 15) goto finally;
      where_to := rnd(1,15);
      link(Pc, findroom("ivory_"+itoa(where_to)+"@sands2"));
      act("$1n arrives from the north.", A_SOMEONE, Pc, null, null, TO_REST);
      exec("look", Pc);
      foreach(UNIT_ST_PC, each)
      {
        if(((each.master == Pc) and (each.position == POSITION_STANDING)))
        {
          act("You follow $2n south on the Ivory Path.", A_SOMEONE, each, Pc, null, TO_CHAR);
          link(each, findroom("ivory_"+itoa(where_to)+"@sands2"));
          act("$1n arrives from the north.", A_SOMEONE, each, null, null, TO_REST);
          exec("look", each);
        }
        else if(((each.master == Pc) and (each.position != POSITION_STANDING)))
        {
          act("You try to follow $2n, but you are not standing.", A_SOMEONE, each, Pc, null, TO_CHAR);
        }
      }
    }
    goto start;
  }
  if(command(CMD_EAST))
  {
    if(self.position != POSITION_STANDING)
    {
      block;
      act("You are in no position to do that.", A_SOMEONE, Pc, null, null, TO_CHAR);
      goto start;
    }
    if(self.exit_to[EAST] == self)
    {
      block;
      act("$1n leaves east on the Ivory Path.", A_SOMEONE, Pc, null, null, TO_REST);
      act("You walk east on the Ivory Path.", A_SOMEONE, Pc, null, null, TO_CHAR);
      if(rnd(1,10) == 5) goto finally;
      where_to := rnd(1,15);
      link(Pc, findroom("ivory_"+itoa(where_to)+"@sands2"));
      act("$1n arrives from the west.", A_SOMEONE, Pc, null, null, TO_REST);
      exec("look", Pc);
      foreach(UNIT_ST_PC, each)
      {
        if(((each.master == Pc) and (each.position == POSITION_STANDING)))
        {
          act("You follow $2n east on the Ivory Path.", A_SOMEONE, each, Pc, null, TO_CHAR);
          link(each, findroom("ivory_"+itoa(where_to)+"@sands2"));
          act("$1n arrives from the west.", A_SOMEONE, each, null, null, TO_REST);
          exec("look", each);
        }
        else if(((each.master == Pc) and (each.position != POSITION_STANDING)))
        {
          act("You try to follow $2n, but you are not standing.", A_SOMEONE, each, Pc, null, TO_CHAR);
        }
      }
    }
    goto start;
  }
  if(command(CMD_WEST))
  {
    if(self.position != POSITION_STANDING)
    {
      block;
      act("You are in no position to do that.", A_SOMEONE, Pc, null, null, TO_CHAR);
      goto start;
    }
    if(self.exit_to[WEST] == self)
    {
      block;
      act("$1n leaves west on the Ivory Path.", A_SOMEONE, Pc, null, null, TO_REST);
      act("You walk west on the Ivory Path.", A_SOMEONE, Pc, null, null, TO_CHAR);
      if(rnd(1,10) == 5) goto finally;
      where_to := rnd(1,15);
      link(Pc, findroom("ivory_"+itoa(where_to)+"@sands2"));
      act("$1n arrives from the east.", A_SOMEONE, Pc, null, null, TO_REST);
      exec("look", Pc);
      foreach(UNIT_ST_PC, each)
      {
        if(((each.master == Pc) and (each.position == POSITION_STANDING)))
        {
          act("You follow $2n west on the Ivory Path.", A_SOMEONE, each, Pc, null, TO_CHAR);
          link(each, findroom("ivory_"+itoa(where_to)+"@sands2"));
          act("$1n arrives from the east.", A_SOMEONE, each, null, null, TO_REST);
          exec("look", each);
        }
        else if(((each.master == Pc) and (each.position != POSITION_STANDING)))
        {
          act("You try to follow $2n, but you are not standing.", A_SOMEONE, each, Pc, null, TO_CHAR);
        }
      }
    }
    goto start;
  }
  goto start;
 :finally:
  where_to := rnd(1,6);
  link(Pc, findroom("gate_home_"+itoa(where_to)+"@sands2"));
  act("$1n saunters up to the dead end.", A_SOMEONE, Pc, null, null, TO_REST);
  exec("look", Pc);
  foreach(UNIT_ST_PC, each)
  {
    if(((each.master == Pc) and (each.position == POSITION_STANDING)))
    {
      act("You follow $2n to a dead end.", A_SOMEONE, each, Pc, null, TO_CHAR);
      link(each, findroom("gate_home_"+itoa(where_to)+"@sands2"));
      act("$1n saunters up to the dead end.", A_SOMEONE, each, null, null, TO_REST);
      exec("look", each);
    }
    else if(((each.master == Pc) and (each.position != POSITION_STANDING)))
    {
      act("You try to follow $2n, but you are not standing.", A_SOMEONE, each, Pc, null, TO_CHAR);
    }
  }
  goto start;
}
dilend
/*------ Falling ------*/
dilbegin recall falling();
var
  iCmd   :integer;
code
{
  heartbeat:=PULSE_SEC*3;
  :start:
    iCmd:=interrupt(SFB_CMD, activator == self, com_done);
    pause;
    act("You whoosh downward!", A_SOMEONE, self, null, null, TO_CHAR);
  :whooshing:
    pause;
    act("You whoosh downward!", A_SOMEONE, self, null, null, TO_CHAR);
    pause;
    act("Wham! You are stunned as you hit bottom!", A_SOMEONE, self, null, null, TO_CHAR);
    self.hp:=-1;
    position_update(self);
    link(self, findroom("pit_floor@sands2"));
    quit;
  :com_done:
    clear(iCmd);
    block;
    act("All you can do is whoosh downward!", A_SOMEONE, self, null, null, TO_CHAR);
    goto whooshing;
}
dilend
/*------ CAVE STUFF ------*/
dilbegin cave();
var
  iRand :integer;
  iJump :integer;
code
{
  heartbeat:=PULSE_SEC*3;
  :start:
  iJump:=interrupt(SFB_CMD, command("jump"), jumped);
  iRand:=rnd(1,30);
  if(iRand == 1) act("A little water from the ceiling drips onto your head.", A_SOMEONE, self, null, null, TO_ALL);
  else if(iRand == 2) act("Drip.", A_SOMEONE, self, null, null, TO_ALL);
  else if(iRand == 3) act("Something or someone shuffles off in the distance.", A_SOMEONE, self, null, null, TO_ALL);
  else if(iRand == 4) act("A quiet moan echos through the cave.", A_SOMEONE, self, null, null, TO_ALL);
  else if(iRand == 5) act("A muffled cough comes from somewhere.", A_SOMEONE, self, null, null, TO_ALL);
  clear(iRand);
  pause;pause;
  clear(iJump);
  goto start;
  :jumped:
  clear(iJump);
  block;
  act("You jump, trying to get out this way is futile!", A_SOMEONE, activator, null, null, TO_CHAR);
  act("$1n jumps up in a futile attempt to leave the cave.", A_SOMEONE, activator, null, null, TO_REST);
  goto start;
}
dilend
/*------ PATH NOISE ------*/
dilbegin path_noise();
var
  i  :integer ;
code
{
  heartbeat:=PULSE_SEC*40;
:start:
  i := rnd (1,50);
  if(i == 1) act("Something seems to whisper in your ear.",A_SOMEONE,self,null,null,TO_ALL);
  if(i == 2) act("Your foots slips on the ivory, scary.",A_SOMEONE,self,null,null,TO_ALL);
  if(i == 3) act("Time seems to slow for a few moments.",A_SOMEONE,self,null,null,TO_ALL);
  if(i == 4) act("The cry of a small child echos from the south.",A_SOMEONE,self,null,null,TO_ALL);
  if(i == 5) act("The cry of a small child echos from the north.",A_SOMEONE,self,null,null,TO_ALL);
  if(i == 6) act("A heatless flame licks you leg momentarilly.",A_SOMEONE,self,null,null,TO_ALL);
  if(i == 7) act("A small wisp of gas floats by.",A_SOMEONE,self,null,null,TO_ALL);
  if(i == 8) act("You hear a mufled explosion followed by the smell of sulfer.",A_SOMEONE,self,null,null,TO_ALL);
  pause;
  goto start;
}
dilend

/*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*/
/*-=-=-=-=-=-=-=-=-=-=-=-= Rooms -=-=-=-=-=-=-=-=-=-=-=-=-=*/
/*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*/
%rooms
/*------ Gate -------*/
gate
  title "The Gate to Baardek Keep"
  names {"b_gate", "baardek keep", "baardek"}
  descr
  "You are standing before the gates of the Baardek keep. The gates are hung from high black walls and set to move soundlessly. Noises
  like whispers are all you hear coming from inside. The walls look like they protect at least three floors. The smell of corruption and secrets is heavy on your sences. You can't help
  feel like you are being watched by much more then the guards in the area, as if someone is looking over your shoulder."
  movement SECT_CITY
  extra {"gates", "gate"}
  "The gates are massive black mithril grating, they look well maintained and probably protect from the forest more then enemies because the forest is the only way in and a far greater foe."
  extra {"baardek keep", "keep"}
  "The keep is a pitch black citadel three floors high, the only way you can see to get in is through the gate. What lies on the other side is for you to find out."
  west to forestA_5@sandzone descr
  "The start of the trail through the Baardek Dark Forest.";
  east to keep2_1 descr
  "The entrance hall of Baardek Keep."
  keyword {"gates", "gate"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*----- Morshaal's Hideout -----*/
morshaal_hq
  title "Morshaal's Strip Joint"
  names {"morshaal_hq", "hangout"}
  descr
  "This is Morshaal's little strip club, several slimy creatures dance about in
  the nude on large cinder blocks, you get the feeling you are not supposed to be
  here."
  dilcopy path_noise@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"dancers", "creatures"}
  "Get out of here!!"
end
/*----- Gate Home 1 -----*/
gate_home_1
  title "A dead end of the Ivory Path"
  names {"gate_home", "storm gate"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Whispers and screams can be heard in the distance but seem to have no
 source, a chill runs up your spine as soon as you hear them, and again
 when you notice the flames below produce no heat."
  dilcopy path_noise@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  west to ivory_2 descr "More of the ivory path.";
end
/*----- Gate Home 2 -----*/
gate_home_2
  title "A dead end of the Ivory Path"
  names {"gate_home", "storm gate"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Whispers and screams can be heard in the distance but seem to have no
 source, a chill runs up your spine as soon as you hear them, and again
 when you notice the flames below produce no heat."
  dilcopy path_noise@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  east to ivory_1 descr "More of the ivory path.";
end
/*----- Gate Home 3 -----*/
gate_home_3
  title "A dead end of the Ivory Path"
  names {"gate_home", "storm gate"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Whispers and screams can be heard in the distance but seem to have no
 source, a chill runs up your spine as soon as you hear them, and again
 when you notice the flames below produce no heat."
  dilcopy path_noise@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  east to ivory_3 descr "More of the ivory path.";
end
/*----- Gate Home 4 -----*/
gate_home_4
  title "A dead end of the Ivory Path"
  names {"gate_home", "storm gate"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Whispers and screams can be heard in the distance but seem to have no
 source, a chill runs up your spine as soon as you hear them, and again
 when you notice the flames below produce no heat."
  dilcopy path_noise@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have.."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  east to ivory_1 descr "More of the ivory path.";
end
/*----- Gate Home 5 -----*/
gate_home_5
  title "A dead end of the Ivory Path"
  names {"gate_home", "storm gate"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Whispers and screams can be heard in the distance but seem to have no
 source, a chill runs up your spine as soon as you hear them, and again
 when you notice the flames below produce no heat."
  dilcopy path_noise@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  east to ivory_7 descr "More of the ivory path.";
end
/*----- Gate Home 6 -----*/
gate_home_6
  title "A dead end of the Ivory Path"
  names {"gate_home", "storm gate"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Whispers and screams can be heard in the distance but seem to have no
 source, a chill runs up your spine as soon as you hear them, and again
 when you notice the flames below produce no heat."
  dilcopy path_noise@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  east to ivory_3 descr "More of the ivory path.";
end
/*----- Ivory Path 1 -----*/
ivory_1
  title "On the Ivory Path"
  names {"ivory_a", "storm gate"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Whispers and screams can be heard in the distance but seem to have no
 source. All around you whisps of smoke and gas rise into the air."
  dilcopy pathwander@sands2();
  dilcopy path_noise@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  west to ivory_1 descr "A dead end in the path.";
  north to ivory_1 descr "More of the ivory path.";
end

/*----- Ivory Path 2 -----*/
ivory_2
  title "On the Ivory Path"
  names {"ivory_2", "storm gate"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metrse above a pit of flowing lava and spouting flames.
 There doesn't seem to be any end to the intersecting ivory paths and
 the smell of old death begins to override your sences."

  dilcopy pathwander@sands2();
  dilcopy path_noise@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  east to ivory_2 descr "More of the ivory path.";
  south to ivory_2 descr "More of the ivory path.";
end
/*----- Ivory Path 3 -----*/
ivory_3
  title "On the Ivory Path"
  names {"ivory path"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Faint scratching noises echo from unseen and seemingly unreachable walls
 in the darkness."
  dilcopy pathwander@sands2();
  dilcopy path_noise@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  west to ivory_3 descr "More of the ivory path.";
  south to ivory_3 descr "More of the ivory path.";
end
/*----- Ivory Path 4 -----*/
ivory_4
  title "On the Ivory Path"
  names {"ivory path"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Whispers and screams can be heard in the distance but seem to have no
 source. You begin to wonder if there is any escape from this hellish
 maze of ivory."

  dilcopy pathwander@sands2();
  dilcopy path_noise@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  south to ivory_4 descr "More of the ivory path.";
  north to ivory_4 descr "More of the ivory path.";
end
/*----- Ivory Path 5 -----*/
ivory_5
  title "On the Ivory Path"
  names {"ivory path"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Whispers and screams can be heard in the distance but seem to have no
 source, a chill runs up your spine as soon as you hear them, and again
 when you notice the flames below produce no heat."
  dilcopy pathwander@sands2();
  dilcopy path_noise@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have. Several paths intersect here
  and then wind off into darkness"
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  south to ivory_5 descr "More of the ivory path.";
  west to ivory_5 descr "More of the ivory path.";
  east to ivory_5 descr "More of the ivory path.";
  north to ivory_5 descr "More of the ivory path.";
end
/*----- Ivory Path 6 -----*/
ivory_6
  title "On the Ivory Path"
  names {"ivory path"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames..
 Whispers and screams can be heard in the distance but seem to have no
 source, a chill runs up your spine as soon as you hear them, and again
 when you notice the flames below produce no heat."

  dilcopy pathwander@sands2();
  dilcopy path_noise@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  south to ivory_6 descr "More of the ivory path.";
  east to ivory_6 descr "More of the ivory path.";
end
/*----- Ivory Path 7 -----*/
ivory_7
  title "On the Ivory Path"
  names {"ivory path"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Thin wisps of smoke and ash float around you causing your lungs to feel
 tainted and unclean."
  dilcopy pathwander@sands2();
  dilcopy path_noise@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible walls rising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  west to ivory_7 descr "More of the ivory path.";
  east to ivory_7 descr "More of the ivory path.";
end
/*----- Ivory Path 8 -----*/
ivory_8
  title "On the Ivory Path"
  names {"ivory path"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Time seems to slow and then quicken randomly as you wander the path looking
 for a way out."
  dilcopy path_noise@sands2();
  dilcopy pathwander@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  north to ivory_8 descr "More of the ivory path.";
end
/*----- Ivory Path 9 -----*/
ivory_9
  title "On the Ivory Path"
  names {"ivory path"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Whispers and screams can be heard in the distance but seem to have no
 source, a chill runs up your spine as soon as you hear them, and again
 when you notice the flames below produce no heat."
  dilcopy path_noise@sands2();
  dilcopy pathwander@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  south to ivory_9 descr "More of the ivory path.";
  east to ivory_9 descr "More of the ivory path.";
  north to ivory_9 descr "More of the ivory path.";
end
/*----- Ivory Path 10 -----*/
ivory_10
  title "On the Ivory Path"
  names {"ivory path"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Strande cries like tortured animals resonate of walls shrouded somewhere in the
 dark."
  dilcopy path_noise@sands2();
  dilcopy pathwander@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  south to ivory_10 descr "More of the ivory path.";
  east to ivory_10 descr "More of the ivory path.";
  north to ivory_10 descr "More of the ivory path.";
end
/*----- Ivory Path 11 -----*/
ivory_11
  title "On the Ivory Path"
  names {"ivory path"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Time seems to run a bit slower in this part of the path, or perhaps it
 is just faster elsewhere."
  dilcopy path_noise@sands2();
  dilcopy pathwander@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  south to ivory_11 descr "More of the ivory path.";
  east to ivory_11 descr "More of the ivory path.";
  west to ivory_11 descr "More of the ivory path.";
  north to ivory_11 descr "More of the ivory path.";
end
/*----- Ivory Path 12 -----*/
ivory_12
  title "On the Ivory Path"
  names {"ivory path"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 A quiet moan can be heard off to the north from here but no path leads
 in that direction."
  dilcopy path_noise@sands2();
  dilcopy pathwander@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  south to ivory_12 descr "More of the ivory path.";
  east to ivory_12 descr "More of the ivory path.";
  west to ivory_12 descr "More of the ivory path.";
end
/*----- Ivory Path 13 -----*/
ivory_13
  title "On the Ivory Path"
  names {"ivory path"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 The quieted laughter from the dark reminds you of your childhood."
  dilcopy path_noise@sands2();
  dilcopy pathwander@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  south to ivory_13 descr "More of the ivory path.";
  north to ivory_13 descr "More of the ivory path.";
end
/*----- Ivory Path 14 -----*/
ivory_14
  title "On the Ivory Path"
  names {"ivory path"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Here, the path ends in a broken edge, too far to the north its other edge
 continues into darkness."
  dilcopy path_noise@sands2();
  dilcopy pathwander@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  south to ivory_14 descr "More of the ivory path.";
end
/*----- Ivory Path 15 -----*/
ivory_15
  title "A dead end of the Ivory Path"
  names {"gate_home", "storm gate"}
  descr
 "The charred ivory path you are standing on appears to be suspended in
 mid-air several metres above a pit of flowing lava and spouting flames.
 Whispers and screams can be heard in the distance but seem to have no
 source, a chill runs up your spine as soon as you hear them, and again
 when you notice the flames below produce no heat.&nThe shattered remains
 of a Storm Gate are laying here."
  dilcopy path_noise@sands2();
  dilcopy pathwander@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_MOUNTAIN
  extra{"ivory path", "path", "ahead"}
  "The path below your feet is made of what seems to be one solid block of
  ivory scorched around its sides. As it stretches off into the distance
  you lose sight of any possible end it might have."
  extra{"ivory"}
  "The ivory is an off white colour where it isn't scorched."
  extra{"lava and flames", "flames", "lava"}
  "With no obvious fuel source flames spout from an ocean of molten rock.
  The horizon seems like a minature globe, slanting down quickly but with
  no visible wallsrising back up."
  extra{"walls", "wall"}
  "You wish there were some."
  extra{"whispers and screams", "whispers", "screams"}
  "If you could see them perhaps you could know their sources. Sadly, you
  can not see sounds."
  west to ivory_15 descr "More of the ivory path.";
end
/*====================== KEEP BASEMENT =============================*/
/*------ Inside the Well -----*/
well_rm
  title "In the well"
  names {"well_rm"}
  descr "You are standing in several feet of clear liquid inside the stone
  well, a small door is in the centre of its bottom set to open without
  draining the water. Sunlight pours in from above where you exit the well."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER, UNIT_FL_NO_MOB}
  IN_ALWAYS_DARK
  movement SECT_INSIDE
  up to beach1_8@sandzone descr "Hmmmmmmmm.";
  down to tunnel_out_6 descr "Further into the tunnel."
  keyword {"bottom of the well", "door"} open {EX_OPEN_CLOSE, EX_CLOSED};
dilbegin well_rm();
var
  pc    :unitptr;
code
{
  heartbeat:=PULSE_SEC*5;
 :start:
  wait(SFB_CMD, command(CMD_UP));
  pc:=activator;
  act("$1n jumps up out of the well.", A_SOMEONE, pc, null,null,TO_REST);
  link(pc, findroom("beach1_8@sandzone"));
  act("You pop out of the well and roll out onto the beach.", A_SOMEONE, pc, null,null,TO_CHAR);
  act("$1n pops $1s head out of the well and rolls out onto the beach.", A_SOMEONE, pc, null,null,TO_REST);
  exec("look", pc);
  block;
  goto start;
}
dilend
end
/*------ Secret Room -----*/
secret_rm
  title "A tiny cavern"
  names {"cavern", "secret"}
  descr "Dripping sounds surround you as you peer about in the unyielding
  darkness. It's almost impossible to see anything but you squint your
  eyes and hope for your safety."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  movement SECT_INSIDE
  extra{"walls", "cavern"}
  "The walls are dark and slick, but you can barely make them out."
  SECRET_DOOR_DIFFICULTY(DOWN, 35)
  down to cave_sin open {EX_OPEN_CLOSE, EX_CLOSED, EX_HIDDEN}
  keyword {"metal grate", "grate", "ceiling"};
end
/*------ Sin Cave -----*/
cave_sin
  title "The Cave of Sin"
  names {"sin cave"}
  descr "The cave is huge and impressive, all around you the walls glimmer
  with comfortable red firelight that illuminates even the highest parts
  of the cave. In the north wall you can make out the word &c+rSIN&cw etched
  into the stone. A small and dark door is in the southern wall leading
  back to the tunnels."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  movement SECT_INSIDE
  extra{"door"}
  "The door leads you out of the cave of sin."
  extra{"walls", "cavern"}
  "The cave and its walls glow warmly in the light of unseen fires, there
  are small markings in the walls that make no sence and the world &c+rSIN&cw
  is scrawled in large letters high on the western wall. A small starwell
  in the far corner leads downward into the unknown."
  extra{"firelight", "light", "fire"}
  "The deep red light of unseen torches make you feel all warm."
  extra{"ceiling", "up", "roof", "crack"}
  "The ceiling is high above and hard to see, it is made of the same
  warm stone as the walls and floor and has only a few small cracks
  in it."
  south to tunnel_out_2 descr  "Back towards the caves"
  keyword {"dark door", "door"} open {EX_OPEN_CLOSE, EX_CLOSED};
  down to cave_pain descr "Further into the depths of darkenss";
  SECRET_DOOR_DIFFICULTY(UP, 35)
  up to secret_rm open {EX_OPEN_CLOSE, EX_CLOSED, EX_HIDDEN}
  keyword {"metal grate", "grate", "ceiling"};
end
/*------ Pain Cave -----*/
cave_pain
  title "The Cave of Pain"
  names {"pain cave"}
  descr "The entirety of this cave is a deep purple, you cannot see its
  highest reaches because some sort of purple mist hangs above you.
  Even the walls here are covered in a thick purple mist which never strays
  from the walls but is constatly swirling and churning. The word &cmPAIN&cw
  is scrawled behind a mist shrouded wall. A small stairwell leads both
  up and down in the corner of the room."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  movement SECT_INSIDE
  extra{"walls", "cavern"}
  "The cave seems to be lined with a thick purple mist. Strange.
  The word PAIN is scrawled in huge letters here."
  extra{"mist", "light"}
  "The mist seems to be the only source of light making all that you look at purple as well."
  up to cave_sin descr "Further up the depths of darkenss";
  down to cave_shame descr "Further into the depths of darkenss";
end
/*------ Shame Cave -----*/
cave_shame
  title "The Cave of Shame"
  names {"shame cave"}
  descr "This depth of the caves is marked by a definate glow of blue.
  Seeming to from the walls, echos of laughter reverberate througout
  the room but with no obvious source. The word &c+bSHAME&cw is clawed
  into one of the glowing walls. The staircase leads only up."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  movement SECT_INSIDE
  extra{"walls", "cavern"}
  "The cave seems to be lined with a thick blue mist. Strange.
  The word SHAME is scrawled in huge letters here."
  extra{"mist", "light"}
  "The mist seems to be the only source of light making all that you look at blue as well."
  up to cave_pain descr "Further up the depths of darkenss";
end
/*----- Pit Floor -----*/
pit_floor
  title "The floor of the Baardek pit"
  names {"pit_floor", "tunnel"}
  descr "Directly above you the thin light of the pit's opening severs complete
  darkness. As you regain yourself and look around in the dark cave
  you can see by the green light of an unknown source. The cavern you are
  in stretches a bit farther to the west, north, and south. To the east a tunnel leads off
  into more green glowing caves."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"walls", "cave"}
  "The cave and its walls are slick black stone, very unattractive and
  unpleasant"
  east to tunnel_1 descr "Down the dark tunnel.";
  west to pit_2 descr "Further west in the pit.";
  north to pit_3 descr "Further north in the pit.";
  south to pit_5 descr "Further sourth in the pit.";
end
/*----- Pit 2 -----*/
pit_2
  title "The floor of the Baardek pit"
  names {"pit_floor", "tunnel"}
  descr "You are standing by the coal black western wall of the pit,
  occasional dripping noises and shuffling are all that you can hear
  around you."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"walls", "cave"}
  "The cave and its walls are slick black stone, very unattractive and
  unpleasant"
  east to pit_floor descr "In the pit.";
end
/*----- Pit 3 -----*/
pit_3
  title "The northern part of the pit"
  names {"pit_floor", "tunnel"}
  descr "You are standing by the dark and oily north wall of the pit,
  The wall itself is not very pleasant to look at, it has thin cracks
  in it that look as old as the wall itself. The centre of the pit is
  close to the south."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER, UNIT_FL_NO_MOB}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"walls", "cave", "crack"}
  "The wall is thinly cracked, as you move your hand over it a small breeze
  lifts the hairs on the back of your hand."
  south to pit_floor descr "In the pit.";
  SECRET_DOOR_DIFFICULTY(NORTH, 25)
  north to tunnel_out_1 open {EX_OPEN_CLOSE, EX_CLOSED, EX_HIDDEN}
  keyword {"door between cracks in the wall", "cracks", "crack", "door", "wall"};
end
/*----- Pit 5 -----*/
pit_5
  title "The southern part of the pit"
  names {"pit_floor", "tunnel"}
  descr "To the north you can see the area in the pit where the opening
  shines from high above, where you stand only oily black walls covered in
  slime surround you."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"walls", "cave", "crack"}
  "The wall is coated with a black slime that feels like oil and smells like death."
  north to pit_floor descr "In the pit.";
end
/*------ Tunnel Out 1 -----*/
tunnel_out_1
  title "The beginning of a secret tunnel"
  names {"tunnel_out_1", "tunnel_out"}
  descr "The tunnel discovered here is dark and gloomy. It leads deep
  to the west into  the unknown and a cool breeze blows up its length, carrying
  the scent of corrosion. On the southern wall the rock is cracked and
  fissured unusually."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"walls", "cave"}
  "The cave and its walls are slick black stone, very unattractive and
  unpleasant"
  south to pit_3 descr "Back into the pit." open {EX_OPEN_CLOSE, EX_CLOSED, EX_HIDDEN}
  keyword {"door between cracks in the wall", "cracks", "crack", "door", "wall"};
  west to tunnel_out_2 descr "Further into the tunnel.";
end
/*------ Tunnel Out 2 -----*/
tunnel_out_2
  title "Inside a dark tunnel"
  names {"tunnel_out_2", "tunnel_out"}
  descr "The dark cavernous tunnel leads deep into the recess of darkness,
  and also steadily upwards. Around you the walls glimmer with slick
  dark vegetation and close in around you tightly. The sign &cc'&c+rWARNING: PAIN&cc'&cw is
  on a small dark door in the northern wall."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"walls", "cave"}
  "The cave and its walls are slick black stone, very unattractive and
  unpleasant"
  extra{"vegetation", "moss"}
  "The vegetation seems to be moss or some other form of unpleasant subterranian
  stuff"
  east to tunnel_out_1 descr "Back down the tunnel.";
  west to tunnel_out_3 descr "Further into the tunnel.";
  north to cave_sin descr "Through the door."
  keyword {"dark door", "door"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*------ Tunnel Out 3 -----*/
tunnel_out_3
  title "A turn in the tunnel"
  names {"tunnel_out_3", "tunnel_out"}
  descr "Here the tunnel turns northward, and yet continues to rise steadilly
  as well. The air seems to be getting fresher and the light is becoming
  less green and more yellow."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"walls", "cave"}
  "The cave and its walls are slick black stone, very unattractive and
  unpleasant"
  extra{"vegetation", "moss"}
  "The vegetation seems to be moss or some other form of unpleasant subterranian
  stuff"
  east to tunnel_out_2 descr "Back down the tunnel.";
  north to tunnel_out_4 descr "Further into the tunnel.";
end
/*------ Tunnel Out 4 -----*/
tunnel_out_4
  title "A dead end in a dark tunnel"
  names {"tunnel_out_4", "tunnel_out"}
  descr "The tunnel has ended here, but you can return to the south or
  try to go up, there is a small ladder here that looks very unstable
  and leads into darkness."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"walls", "cave"}
  "The cave and its walls are slick black stone, very unattractive and
  unpleasant"
  extra{"vegetation", "moss"}
  "The vegetation seems to be moss or some other form of unpleasant subterranian
  stuff"
  up to tunnel_out_5 descr "On the rickety ladder.";
  south to tunnel_out_3 descr "Further into the tunnel.";
end
/*------ Tunnel Out 5 -----*/
tunnel_out_5
  title "In a rocky shaft"
  names {"ladder"}
  descr "As you climb the ladder your eyes adjust to an even greater
  darkness, from somewhere above you can hear the sounds of water dripping
  into unknown depths. You can only hope you don't fall of the ladder or
  pop out in the middle of a Dragon Convention."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"walls", "cave"}
  "The cave and its walls are slick black stone, very unattractive and
  unpleasant"
  extra{"vegetation", "moss"}
  "The vegetation seems to be moss or some other form of unpleasant subterranian
  stuff"
  up to tunnel_out_6 descr "On the rickety ladder.";
  down to tunnel_out_4 descr "Further into the tunnel.";
end
/*------ Tunnel Out 6 -----*/
tunnel_out_6
  title "In a rocky shaft"
  names {"ladder"}
  descr "Directly above, the bottom of a circular stone well is
  staring down at you. A small wooden door is all that blocks your
  passage through it. Below, darkness and dripping noises are all you can
  sence."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"walls", "cave"}
  "The cave and its walls are slick black stone, very unattractive and
  unpleasant"
  extra{"vegetation", "moss"}
  "The vegetation seems to be moss or some other form of unpleasant subterranian
  stuff"
  up to well_rm descr "Hmmmmmmmm."
  keyword {"bottom of the well", "door", "bottom", "well"} open {EX_OPEN_CLOSE, EX_CLOSED};
  down to tunnel_out_5 descr "Further into the tunnel.";
end
/*------ Tunnel 1 -----*/
tunnel_1
  title "The entrance to a dark tunnel"
  names {"tunnel_1", "tunnel"}
  descr "You are standing in the centre of a still and draftless tunnel.
  To the west the huge cave below the Baardek pit spans in morbid quiet.
  Soft shuffles and other sounds echo off the black and sickly looking
  walls around you coming from the east."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"walls", "cave"}
  "The cave and its walls are slick black stone, very unattractive and
  unpleasant"
  west to pit_floor descr "Into the cave.";
  east to tunnel_2 descr "Further into the tunnel.";
end
/*------ Tunnel 2 -----*/
tunnel_2
  title "Inside a dark tunnel"
  names {"tunnel_2", "tunnel"}
  descr "In the darkness you can see very little, there is more light to
  the west where the tunnel's mouth is, to the east the darkness continues."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"walls", "cave"}
  "The cave and its walls are slick black stone, very unattractive and
  unpleasant"
  west to tunnel_1 descr "The mouth of the tunnel.";
  east to tunnel_3 descr "Further into the tunnel.";
end
/*------ Tunnel 3 -----*/
tunnel_3
  title "Inside a dark tunnel"
  names {"tunnel_3", "tunnel"}
  descr "The dark stretches off in both directions, it would not be difficult to lose one's
  self here, even though only two directions are possible."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"walls", "cave"}
  "The cave and its walls are slick black stone, very unattractive and
  unpleasant"
  west to tunnel_2 descr "Further into the tunnel.";
  east to tunnel_4 descr "Further into the tunnel.";
end
/*------ Tunnel 4 -----*/
tunnel_4
  title "Inside a dark tunnel"
  names {"tunnel_4", "tunnel"}
  descr "The sounds of loud and rough breathing come from the east, accompanied by
  an unnatural heat. You can only guess what terrible danger lays in wait
  ahead."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"walls", "cave"}
  "The cave and its walls are slick black stone, very unattractive and
  unpleasant"
  west to tunnel_3 descr "Further into the tunnel.";
  east to tunnel_5 descr "Further into the tunnel.";
end
/*------ Tunnel 5 -----*/
tunnel_5
  title "The edge of an opening in the tunnel"
  names {"tunnel_5", "tunnel"}
  descr "The long dark tunnel ends abrubtly here further to the east opens
  a grand cavern from which comes extremely hot and sulferous air."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"walls", "cave"}
  "The cave and its walls are slick black stone, very unattractive and
  unpleasant"
  west to tunnel_4 descr "Further into the tunnel.";
  east to tunisk_cavern descr "Into the cavern.";
end
/*---__-- Tunisk Cavern --__--*/
tunisk_cavern
  title "The cavern of Tunisk"
  names {"tunnel_5", "tunnel"}
  descr "Walls of scorched black dome upwards into the dark with no visible
  top over piles of bone and armour scattered all over the cavern. Some
  old and worn tapestries hang from the walls displying various scenes of
  unknown origin.."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
  dilcopy cave@sands2();
  movement SECT_INSIDE
  extra{"bones", "bone"}
  "The bleached bones scattered on the ground appeat to be mostly human
  and elven, although a few may be dwarven in nature."
  extra{"armour", "armor"}
  "Armour scraps lay all around you, all destroyed and scorched and generally
  unusable."
  extra{"tapestries", "tapestry"}
  "The tapestry that catches your eye the most seems to fit with the theme
  of all the others... A man stands among villagers holding one dagger above
  his head and wearing two others at his belt. In each tapestry the head of a
  different dragon lays bleeding at his feet."
  extra{"walls", "cave"}
  "The cavern and its walls are slick black stone, very unattractive and
  unpleasant"
  west to tunnel_5 descr "The mouth of the tunnel.";
end
/*========================== TOWER ROOMS ================================*/
/*------- Stairwell -----*/
keep2_7
  title "The tight stairwell at the bottom of a round tower"
  names {"k2_7", "stairwell", "keep"}
  descr "Your shoulders cram up against the railings of the stair, for there
  is only wall around it and no room to move. Properly supplied, a person
  could defend the upper tower against thousands, even if alone. The stairs
  climb upwards into a circular tower."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"walls"}
  "The walls are the same oily black stone, they crowd in on you uncomfortably close."
  west to keep2_6 descr "The eastern end of the tight hallway.";
  up to tower1 descr "Further up the tower stairs.";
end
/*------- Tower 1 -----*/
tower1
  title "The stairs going up a slim round tower"
  names {"stairs", "tower1"}
  descr "You are standing on a tight stairwell ascending the tower of Baardek Keep,
  a thin iron railing is all that helps you retain balance, yet there is nowhere
  to fall except down the spiral stair because the walls barely miss your shoulders.
  Below you the stairwell is so tight only one can fit into it, here you might fit
  more then one person but only uncomfortably."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER, UNIT_FL_NO_MOB}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"walls", "wall"}
  "The walls are uncomfortably close, you imagine that the tower must fan out at the top,
  otherwise it would be purposeless. They are made of some sort of oily
  black stone."
  extra{"floor", "ground"}
  "There is no ground here, only stairs."
  extra{"stairs", "steps", "stair"}
  "The steps, enclosed by a thin iron railing, do little to make you feel comfortable."
  extra{"iron railing", "iron", "railing", "posts"}
  "The railing looks frail, it is only about three centimeters wide and is held to the stairs by even thinner iron posts"
  up to tower2 descr "Further up the tight stairwell.";
  down to keep2_7 descr "Bottom of the stairs.";
dilbegin no_go_down();
var
  roomeast :unitptr;
  foller   :unitptr;
  pc       :unitptr;
code
{
  heartbeat:=PULSE_SEC+3;
  :start:
  wait(SFB_CMD, command(CMD_DOWN));
  pc := activator;
  roomeast:=findroom("keep2_7@sands2");
  if(((roomeast.inside.type == UNIT_ST_PC) or (roomeast.inside.type == UNIT_ST_NPC)))
  {
    block;
    act("&cc$2n completely fills the stairwell!&cw", A_SOMEONE, pc, roomeast.inside, null, TO_CHAR);
    act("&cc$1n bumps into $2n trying to come down!&cw", A_SOMEONE, pc, roomeast.inside, null, TO_REST);
    act("&cc$2n bumps into you trying to get into the stairwell!&cw", A_SOMEONE, roomeast.inside, pc, null, TO_CHAR);
  }
  goto start;
}
dilend
end
/*------- Tower 2 -----*/
tower2
  title "The narrow stairs in a slim round tower"
  names {"stairs", "tower2"}
  descr "Looking up you can see that you are almost halfway up the tower,
  where a ceiling of the same black stone tops the spiraling staircase, perhaps
  there is a door there? Far below you the door leading back to the keep
  sheds a crack of light into the stairwell's bottom."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"walls", "wall"}
  "The walls are uncomfortably close, you imagine that the tower must fan out at the top.
  Otherwise it would be purposeless. The walls are made of some sort of icy
  black stone."
  extra{"floor", "ground"}
  "There is no ground here, only stairs."
  extra{"stairs", "steps"}
  "The steps, enclosed by a thin iron railing, do little to make you feel comfortable."
  extra{"light", "crack"}
  "The light in this tower is so dim that the light of the keep seems bright, even well below you."
  extra{"ceiling"}
  "As far as you can tell it is just a black rock ceiling with wood beams circling its top."
  extra{"iron railing", "iron", "railing", "posts"}
  "The railing looks frail, it is only about three centimeters wide and is held to the stairs by even thinner iron posts."
  up to tower3 descr "Further up the tight stairwell.";
  down to tower1 descr "Bottom of the stairs.";
end
/*------- Tower 3 -----*/
tower3
  title "Midway up the stairs in a slim round tower"
  names {"stairs", "tower3"}
  descr "Looking up you can see that you are halfway up the tower, there is
  what appears to be a trapdoor atop the stairwell which you hope leads
  into somewhere a bit roomier."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"walls", "wall"}
  "The walls are uncomfortably close, you imagine that the tower must fan out at the top.
  Otherwise it would be purposeless. The walls are made of some sort of icy
  black stone. The ceiling has wooden beams cut in angles going between it
  and the walls in a circle. Not too far above you a slit of light pours through
  a small window."
  extra{"floor", "ground"}
  "There is no ground here, only stairs."
  extra{"stairs", "steps"}
  "The steps, enclosed by a thin iron railing, do little to make you feel comfortable."
  extra{"trapdoor", "door", "ceiling"}
  "You can barely make out a small square wood door in the centre of the circular ceiling."
  extra{"iron railing", "iron", "railing", "posts"}
  "The railing looks frail, it is only about three centimeters wide and is held to the stairs by even thinner iron posts"
  up to tower4 descr "Further up the tight stairwell.";
  down to tower2 descr "On the stairs.";
end
/*------- Tower 4 -----*/
tower4
  title "The slim spiraling stairs in a tight round tower"
  names {"stairs", "tower4"}
  descr "All there is around you are the circular walls, far below you can
  see the tower's bottom and the light from Baardek Keep pouring through
  a small door. Above you the ceiling with a trapdoor in it looms ever closer,
  and directly above you a small window is slit into the northern curve
  of the wall."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"walls", "wall"}
  "The walls are uncomfortably close, you imagine that the tower must fan out at the top.
  Otherwise it would be purposeless. The walls are made of some sort of icy
  black stone and the ceiling has wooden beams cut in angles going between it
  and the walls in a circle."
  extra{"floor", "ground"}
  "There is no ground here, only stairs."
  extra{"stairs", "steps"}
  "The steps, enclosed by a thin iron railing, do little to make you feel comfortable."
  extra{"window", "slit"}
  "As far as you can tell it is simply a window carved out of the oily black wall."
  extra{"trapdoor", "door", "ceiling"}
  "You can barely make out a small square wood door in the centre of the circular ceiling."
  extra{"iron railing", "iron", "railing", "posts"}
  "The railing looks frail, it is only about three centimeters wide and is held to the stairs by even thinner iron posts"
  up to tower5 descr "Further up the tight stairwell.";
  down to tower3 descr "On the stairs.";
end
/*------- Tower 5 -----*/
tower5
  title "Nearing the top of a slim round tower"
  names {"stairs", "tower5"}
  descr "Directly above you, after the last step, is a small landing much
  roomier then your current position. Below, you can see a crack of light
  where the narrow hallway of Baardek Keep joins the base of the tower.
  On the northern part of the curved wall there is a meter high window
  cut out of the oily black wall, perhaps you should look through it."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"walls", "wall"}
  "The walls are uncomfortably close, you imagine that the tower must fan
  out at the top. A small window is cut into the northern part of their
  curve."
  extra{"floor", "ground"}
  "There is no ground here, only stairs."
  extra{"stairs", "steps"}
  "The steps, enclosed by a thin iron railing, do little to make you feel comfortable."
  extra{"window", "slit"}
  "The window lets in a narrow ray of the outside world, perhaps you should look through it."
  extra{"light", "crack"}
  "The light in this tower is so dim that the light of the keep seems bright, even well below you."
  extra{"trapdoor", "door", "ceiling"}
  "A small square wood door is planted in the centre of the circular ceiling."
  extra{"landing"}
  "The landing is simply a plateu of the stairs, allowing access to the trapdoor in the ceiling."
  extra{"iron railing", "iron", "railing", "posts"}
  "The railing looks frail, it is only about three centimeters wide and is held to the stairs by even thinner iron posts"
  up to tower6 descr "Further up the tight stairwell.";
  down to tower4 descr "On the stairs.";
dilbegin window_even();
code
{
  heartbeat:=PULSE_SEC*3;
  :start:
  wait(SFB_CMD, command("look"));
  if((("through" in argument) and ("window" in argument)))
  {
    act("As you pop your head through the window you see the world of Valhalla,
from this place you can see over treetops and make out a tiny village which
must be Urlaand. North of small hills which appear on your left is a tiny
line that must be King's Road, travelers look like ants scurrying along it.
Even a beautiful waterfall is visible above those hills."
    ,A_SOMEONE, activator, null, null, TO_CHAR);
    act("$1N pops $1s head through the window and gasps.", A_SOMEONE, activator, null, null, TO_REST);
    block;
  }
  goto start;
}
dilend
end
/*------- Tower 6 -----*/
tower6
  title "A roomy landing on the tower stairs"
  names {"stairs", "tower6"}
  descr "Your head brushes close to the ceiling and the trapdoor wedged
  in its centre. Far below, you can see the bottom of the stairwell yet
  the bustle and noise of the keep cannot reach you."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"walls", "wall"}
  "The walls fan away from you getting wider at the ceiling, a welcome change
  from the tight stairwell. The walls are made of some sort of icy
  black stone. The ceiling has wooden beams cut in angles going between it
  and the walls in a circle."
  extra{"floor", "ground"}
  "You are standing on a metal platform that is no more than an elongater stair."
  extra{"stairs", "steps"}
  "Here the step is elongated enough to form a platform."
  extra{"trapdoor", "door", "ceiling"}
  "The door is small and appears to be made of oak, it is big enough for you to slip through when open."
  extra{"iron railing", "iron", "railing", "posts"}
  "The railing looks frail and is only about three centimeters wide and is held to the stairs by even thinner iron posts"
  up to silk_tower descr "Hmmmmmmmm."
  keyword {"trapdoor", "door"} open {EX_OPEN_CLOSE, EX_CLOSED};
  down to tower5 descr "On the stairs.";
end
/*------- Silk's Tower -----*/
silk_tower
  title "On top of the Baardek Tower"
  names {"stairs", "tower6"}
  descr "The room is surprisingly large considering the narrowness of the climb up.
  Trinkets for the purpose of spying lay on shelves and a desk, mounded seemingly
  without any concern for neatness together with assorted paper and books.
  There are no windows here but an eerie glow leaves the room in a dim sort
  of state. A small wood trapdoor is centred on the floor."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"eerie glow", "light", "glow"}
  "Very eerie, very dim."
  extra{"desk", "papers"}
  "On the desk, various papers with names and events are scattered about."
  extra{"trinkets"}
  "The trinkets are for the purpose of spying, they leave you feeling dirty.
  You decide not to touch them for fear of Baardekan vengance."
  extra{"walls", "wall"}
  "The walls here are made of the same oily black stone, but somehow they seem to glow in an unnatural way."
  extra{"floor", "ground"}
  "The ground here is made of black stone, in its centre a wood door with
  a ring for opening and closing it is imbedded into the stone."
  extra{"trapdoor", "door", "ceiling"}
  "The door is small and appears to be made of oak, it is big enough for you to slip through when open."
  down to tower6 descr "On the stairs."
  keyword {"trapdoor", "door"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*==================== LIBRARY ROOMS ===============================*/
/*------- Library Stairs -----*/
library_stairs
  title "The large stairs by the Library"
  names {"stairs", "library"}
  descr "Here the stairs open out into a huge library, where volume
  after volume of books line massive shelves. Each shelf is so high and
  cluttered it is a wonder people don't get lost in here. The stairs lead
  back down into the keep, as well as further up a floor."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"shelves", "shelf"}
  "The shelves are jam packed, you could spend hours here."
  extra{"books", "book"}
  "They appear to be quantities of paper with writing on them and bound together."
  extra{"library"}
  "Strange, this library seems to have books."
  extra{"floor", "ground"}
  "The floor here is kept generally clean, probably by slaves."
  extra{"stairs"}
  "They are pieces of wood gradually getting lower were you to move along them you would go down as well."
  west to lib2_1 descr "Between two shelves of books.";
  down to keepu1_4 descr "Bottom of the stairs.";
  up to bedroom1 descr "The very top of the stairs.";
end
  /*------ Library 2_1 ------*/
lib2_1
  title "Between two bookshelves"
  names {"l2_1", "library"}
  descr
  "Two giant bookshelves loom high above you to both the north and south.
  Each shelf is piled high with books and notes, on this shelf titles like
  'Aqua's Men Vol XXI' and 'How to pick up Udgaard Women' catch your eye as
  well as stacks of records kept by the spies of Baardek."
  movement SECT_INSIDE
  dilcopy get_book@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER, UNIT_FL_NO_MOB}
  ALWAYS_LIGHT
  extra {"spy records", "records", "record", "books"}
  "They are here, wonder if anyone minds you taking them.."
  extra {"shelves", "shelf"}
  "There are many eye catching titles here, you wonder about the records the spies keep, could you be involved here?"
  extra{"walls", "wall"}
  "The walls here are relativly bland, stone of a black colour like the rest of the keep"
  extra {"stairs"}
  "From here you can tell the stairs definatly go both up and down."
  east to library_stairs descr "The stairs.";
  west to lib1_1 descr "A passage beween rows of bookshelves.";
end
  /*------ Library 1_1 ------*/
lib1_1
  title "A passage between the rows of bookshelves"
  names {"l1_1", "library"}
  descr
  "To the east and west huge and full shelves of books point towards you, you
  can slip between two of them in either direction, there appears to be a
  stairwell at the end of the one to the east. The lane continues south from here
  running beside many more shelves."
  movement SECT_INSIDE
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  extra{"walls", "wall"}
  "The walls here are relativly bland, stone of a black colour like the rest of the keep"
  extra {"stairs"}
  "The stairs appear to head both up and down, perhaps you should get closer."
  extra {"shelves", "shelf"}
  "The shelves are full of books and continue down the hall a great distance."
  east to lib2_1 descr "Between two bookshelves.";
  west to lib0_1 descr "Between two bookshelves.";
  south to lib1_2 descr "A passage between rows of shelves.";
end
  /*------ Library 0_1 ------*/
lib0_1
  title "Between two bookshelves"
  names {"l0_1", "library"}
  descr
  "Two giant bookshelves loom high above you to both the north and south.
  Each shelf is piled high with books and notes, on this shelf titles like
  'The Dragon-liver Cookbook' and 'How to be your own Guildmaster' catch
  your eye as well as stacks of records kept by the spies of Baardek."
  movement SECT_INSIDE
  dilcopy get_book@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  extra {"spy records", "records", "record", "books"}
  "They are here, wonder if anyone minds you taking them.."
  extra{"walls", "wall"}
  "The walls here are relativly bland, stone of a black colour like the rest of the keep"
  extra {"shelves", "shelf"}
  "There are many eye catching titles here, you wonder about the records the spies keep, could you be involved here?"
  east to lib1_1 descr "A hallway in the centre of the rows of shelves..";
end
  /*------ Library 2_2 ------*/
lib2_2
  title "Between two bookshelves"
  names {"l2_2", "library"}
  descr
  "Two giant bookshelves loom high above you to both the north and south.
  Each shelf is piled high with books and notes, on this shelf titles like
  'The History of Xiyang' and 'The Saerimner Sex Scandle' catch your eye as
  well as stacks of records kept by the spies of Baardek."
  dilcopy get_book@sands2();
  movement SECT_INSIDE
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  extra {"spy records", "records", "record", "books"}
  "They are here, wonder if anyone minds you taking them.."
  extra {"shelves", "shelf"}
  "There are many eye catching titles here, you wonder about the records the spies keep, could you be involved here?"
  extra{"walls", "wall"}
  "The walls here are relativly bland, stone of a black colour like the rest of the keep"
  west to lib1_2 descr
  "A passage beween rows of bookshelves.";
end
  /*------ Library 1_2 ------*/
lib1_2
  title "A passage between the rows of bookshelves"
  names {"l1_2", "library"}
  descr
  "To the east and west huge and full shelves of books point towards you, you
  can slip between two of them in either direction. The lane continues south
  from here running beside many more shelves."
  movement SECT_INSIDE
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  extra {"shelves", "shelf"}
  "The shelves are full of books and continue down the hall a great distance."
  east to lib2_2 descr "Between two bookshelves.";
  west to lib0_2 descr "Between two bookshelves.";
  north to lib1_1 descr "A passage between rows of shelves.";
  south to lib1_3 descr "A passage between rows of shelves.";
end
  /*------ Library 0_2 ------*/
lib0_2
  title "Between two bookshelves"
  names {"l0_2", "library"}
  descr
  "Two giant bookshelves loom high above you to both the north and south.
  Each shelf is piled high with books and notes, on this shelf titles like
  'Lag, the Formula' and 'What Happened to The Wyrms' catch
  your eye as well as stacks of records kept by the spies of Baardek."
  dilcopy get_book@sands2();
  movement SECT_INSIDE
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  extra {"spy records", "records", "record", "books"}
  "They are here, wonder if anyone minds you taking them.."
  extra{"walls", "wall"}
  "The walls here are relativly bland, stone of a black colour like the rest of the keep"
  extra {"shelves", "shelf"}
  "There are many eye catching titles here, you wonder about the records the spies keep, could you be involved here?"
  east to lib1_2 descr  "A hallway in the centre of the rows of shelves..";
end
  /*------ Library 2_3 ------*/
lib2_3
  title "Between two bookshelves"
  names {"l2_3", "library"}
  descr
  "Two giant bookshelves loom high above you to both the north and south.
  Each shelf is piled high with books and notes, on this shelf titles like
  'Midgaard on Five Gold a Day' and 'The Map of Valhalla' catch your eye as
  well as stacks of records kept by the spies of Baardek."
  dilcopy get_book@sands2();
  movement SECT_INSIDE
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  extra {"spy records", "records", "record", "books"}
  "They are here, wonder if anyone minds you taking them.."
  extra {"shelves", "shelf"}
  "There are many eye catching titles here, you wonder about the records the spies keep, could you be involved here?"
  extra{"walls", "wall"}
  "The walls here are relativly bland, stone of a black colour like the rest of the keep"
  west to lib1_3 descr "A passage beween rows of bookshelves.";
end
  /*------ Library 1_3 ------*/
lib1_3
  title "A passage between the rows of bookshelves"
  names {"l1_3", "library"}
  descr
  "To the east and west huge and full shelves of books point towards you, you
  can slip between two of them in either direction. The lane continues south
  from here running beside many more shelves."
  movement SECT_INSIDE
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  extra {"shelves", "shelf"}
  "The shelves are full of books and continue down the hall a great distance."
  east to lib2_3 descr "Between two bookshelves.";
  west to lib0_3 descr "Between two bookshelves.";
  north to lib1_2 descr "A passage between rows of shelves.";
  south to lib1_4 descr "A passage between rows of shelves.";
end
  /*------ Library 0_3 ------*/
lib0_3
  title "Between two bookshelves"
  names {"l0_3", "library"}
  descr
  "Two giant bookshelves loom high above you to both the north and south.
  Each shelf is piled high with books and notes, on this shelf titles like
  'Davidough, The Man in Brown' and 'Zen and the Art of Donkey Maintenance' catch
  your eye as well as stacks of records kept by the spies of Baardek."
  movement SECT_INSIDE
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  extra {"spy records", "records", "record", "books"}
  "They are here, wonder if anyone minds you taking them.."
  extra{"walls", "wall"}
  "The walls here are relativly bland, stone of a black colour like the rest of the keep"
  extra {"shelves", "shelf"}
  "There are many eye catching titles here, you wonder about the records the spies keep, could you be involved here?"
  east to lib1_3 descr "A hallway in the centre of the rows of shelves..";
  dilcopy get_book@sands2();
end
  /*------ Library 2_4 ------*/
lib2_4
  title "Between two bookshelves"
  names {"l2_4", "library"}
  descr
  "Two giant bookshelves loom high above you to both the north and south.
  Each shelf is piled high with books and notes, on this shelf titles like
  'The Pros and Cons of Rabbit Bashing' and 'What John doesn't know about Mary' catch your eye as
  well as stacks of records kept by the spies of Baardek."
  movement SECT_INSIDE
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  extra {"spy records", "records", "record", "books"}
  "They are here, wonder if anyone minds you taking them.."
  extra {"shelves", "shelf"}
  "There are many eye catching titles here, you wonder about the records the spies keep, could you be involved here?"
  extra{"walls", "wall"}
  "The walls here are relativly bland, stone of a black colour like the rest of the keep"
  west to lib1_4 descr "A passage beween rows of bookshelves.";
  dilcopy get_book@sands2();
end
  /*------ Library 1_4 ------*/
lib1_4
  title "The end of the passage between rows of bookshelves"
  names {"l1_4", "library"}
  descr
  "To the east and west huge and full shelves of books point towards you, you
  can slip between two of them in either direction. The lane ends here but
  runs south towards the beginning of the library."
  movement SECT_INSIDE
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  extra {"walls", "wall"}
  "This is the southern wall of the library."
  extra {"shelves", "shelf"}
  "The shelves are full of books and continue down the hall a great distance."
  east to lib2_4 descr "Between two bookshelves.";
  west to lib0_4 descr "Between two bookshelves.";
  north to lib1_3 descr "A passage between rows of shelves.";
end
  /*------ Library 0_4 ------*/
lib0_4
  title "Between two bookshelves"
  names {"l0_4", "library"}
  descr
  "Two giant bookshelves loom high above you to both the north and south.
  Each shelf is piled high with books and notes, on this shelf titles like
  'The Truth About Arny and Slade' and 'The Best Places to Kiss in Haon Dur' catch
  your eye as well as stacks of records kept by the spies of Baardek. The table
  here is for readers to relax in while studying the information gathered by listeners."
  movement SECT_INSIDE
  dilcopy get_book@sands2();
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  extra {"spy records", "records", "record", "books"}
  "They are here, wonder if anyone minds you taking them.."
  extra{"walls", "wall"}
  "The walls here are relativly bland, stone of a black colour like the rest of the keep"
  extra {"shelves", "shelf"}
  "There are many eye catching titles here, you wonder about the records the spies keep, could you be involved here?"
  east to lib1_4 descr "A hallway in the centre of the rows of shelves..";
end
/*=========================== Keep Rooms ==============================*/
/*------ Bedroom Hall ------*/
bedroom1
  title "The top of the large stairs"
  names {"bedroom1"}
  descr
  "The stairs halt here, spilling you out into a large hallway. Off a
  ways to the south, at the end of the hall, stands a huge and finely
  detailed door. All around you, paintings of wars and gods decorate
  the walls. All the light illuminating the hall seems to come from
  several lanterns fixed to the wall."
  extra {"door"}
  "Perhaps you should get closer."
  extra{"lanterns", "lantern", "lights", "light"}
  "The lanterns are bright burning and emit a comfortable yellow glow."
  extra{"paintings", "painting", "art", "gods", "wars"}
  "There are portraits of Odin and other gods, some are of Silk and Eros
  and even one of Samphone."
  movement SECT_INSIDE
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  south to bedroom2 descr "Into the hall.";
  down to library_stairs descr "The stairs leading down.";
end
/*------ Bedroom Hall ------*/
bedroom2
  title "The hall on the top floor of the keep"
  names {"bedroom2"}
  descr
  "You are standing in the hall by a well guarded door at the south end of
  the hall. To the north are the stairs leading back to the library and the
  keep. Where you stand, grand paintings and busts hang on the wall or sit on small
  tables every few metres. A small unmarked door makes a break in
  all the art on the west wall."
  extra {"doors", "door"}
  "The door is large and finely decorated to the south, to the west is
  a much smaller and more plain one."
  extra{"lanterns", "lantern", "lights", "light"}
  "The lanterns are bright burning and emit a comfortable yellow glow."
  extra{"paintings", "painting"}
  "The paintings are large and finely crafted."
  movement SECT_INSIDE
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  west to brewer_room descr "The brewer's room."
  keyword {"small unmarked door", "door"} open {EX_OPEN_CLOSE, EX_CLOSED};
  south to bedroom descr "Eros' room."
  keyword {"massive door", "door"} open {EX_OPEN_CLOSE, EX_CLOSED};
  north to bedroom1 descr "The stairs leading down.";
end
/*---- Brewer's Room -----*/
brewer_room
  title "The Baardek Brewery"
  names {"brewery"}
  descr
  "Piles of barley, yeast, and hops fill this room from wall to wall.
  As you look around you notice that everything is cramped but well
  organized for Mashkee's job. There are no windows here, only a small
  door to the east leading back out into the hall."
  extra {"floor", "ground"}
  "What little area isn't covered in supplies is made of wood."
  extra {"walls", "wall"}
  "You can barely see the walls over all the supplies, there is a door on
  the east wall."
  extra {"door"}
  "The door is small and unimportant looking."
  extra {"piles of stuff", "barley", "hops", "piles", "yeast"}
  "They are just things for the making of beer."
  movement SECT_INSIDE
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  east to bedroom2 descr "The hallway."
  keyword {"small unmarked door", "door"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*------ Eros' Room ------*/
bedroom
  title "Eros' Bed Chamber"
  names {"bedroom"}
  descr
  "Eros' room is massive and lavish. There are paintings and other fine furnishings
  everywhere you look, all illuminated by the light of grand brass lanterns.
  The grand door leading out of the room is to the north."
  extra {"door"}
  "The door is very large and painted with colourful images."
  extra{"brass lanterns", "lanterns", "lantern", "lights", "light"}
  "Looking into the lanterns burns your retinas, they are very bright!"
  extra{"lavish furnishings", "furnishings"}
  "They are mostly works of art, probably stolen."
  extra{"paintings", "painting", "art", "works"}
  "Most of the paintings that hang on the wall are pictures of Eros with
  different women, they are well crafted and probably expensive."
  movement SECT_INSIDE
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  north to bedroom2 descr "Into the hall."
  keyword {"massive door", "door"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*----- Basement1 -----*/
basement1
  title "The bottom of the stairs"
  names {"basement1", "basement"}
  descr
  "The stairs from the keep lead down into this huge cobweb-ridden basement. All
  around you slaves are working on turning animal pelts into coats and
  other articles of clothing. Traveling salesmen scurry about grabbing baskets
  of clothes to sell to all of Valhalla. To the south the vast basement continues
  onward."
  flags {UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  movement SECT_INSIDE
  extra{"floor", "ground"}
  "Beside a few scraps of animal fur, the floor is clean"
  extra{"pelts", "fur", "scraps"}
  "The fur comes from the Cheleho tribespeople, who are forced to turn
  over the skins as well as slaves in order to retain peace with the
  Baardekans."
  up to keepu1_4 descr "Back up the stairs";
  south to basement2 descr "The centre of the clothing production.";
end
/*----- Basement2 -----*/
basement2
  title "The centre of the large basement"
  names {"basement2", "basement"}
  descr
  "Even more slaves are scurrying about trying to satisfy the Baardekan
  demands for production. The well lit basement continues both to the north
  and south filled to the brim with slaves, traders, and more deliveries
  from the Cheleho camp across the beach."
  flags {UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  movement SECT_INSIDE
  extra{"floor", "ground"}
  "Beside a few scraps of animal fur, the floor is clean"
  extra{"door"}
  "The door and wall by it look older then the keeps itself, as if the keep was
  built around them."
  extra{"pelts", "fur", "scraps"}
  "The fur comes from the Cheleho tribespeople, who are forced to turn
  over the skins as well as slaves in order to retain peace with the
  Baardekans."
  north to basement1 descr "The bottom of the stairs.";
  south to basement3 descr "More clothing prosuction..";
end
/*----- Basement3 -----*/
basement3
  title "Further in the basement"
  names {"basement3", "basement"}
  descr "You are standing by the southern wall of the basement where a small door leads
  into the office of the slave master, Samphore. All around you tables
  heaped with fur and pelts are being turned into clothing by hardworking slaves
  and then taken off by fur traders."
  flags {UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  movement SECT_INSIDE
  extra{"door", "office"}
  "Behind the door is a small office with a window overlooking production."
  extra{"floor", "ground"}
  "Beside a few scraps of animal fur, the floor is clean"
  extra{"pelts", "fur", "scraps"}
  "The fur comes from the Cheleho tribespeople, who are forced to turn
  over the skins as well as slaves in order to retain peace with the
  Baardekans."
  extra{"tables", "table"}
  "The tables are simple in design and narrow in purpose, they are made
  for clothing production."
  north to basement2 descr "Centre of the basement.";
  south to s_office descr  "The office of Samphore."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*----- SAMPHORE OFFICE -----*/
s_office
  title "The office of Samphore"
  names {"s_o", "office"}
  descr
  "Samphore's office is cluttered and hectic, if this room says anything
  about the man,there is no cleanlyness about him. Anther small door is
  leading off to the west into an even smaller office, the bustle of fur
  production waits to the south."
  flags {UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  movement SECT_INSIDE
  extra{"door", "doors"}
  "There are doors to both the south and west."
  extra{"floor", "ground"}
  "Nothing clean here."
  north to basement3 descr "Southern end of the basement."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
  west to g_office descr "Office of Grishalmus."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*----- GRISHALMUS OFFICE -----*/
g_office
  title "The office of Grishalmus"
  names {"g_o", "office"}
  descr
  "In great contrast to the previous office, Grishalmus' office is clean
  and neat. Starange inventions and toys are laying all around on desks
  and shelves, but each appears to be in its designated spot."
  flags {UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  movement SECT_INSIDE
  extra {"inventions and toys", "inventions", "invention", "toys"}
  "The toys and inventions rival those that have come from the research lab,
  sadly many of their plans have been stolen from there."
  extra{"desks and shelves", "desks", "desk", "shelves", "shelf"}
  "They are here for the expressed purpose of holding on to inventions and
  toys."
  extra{"door", "doors", "office"}
  "The door leads back to Samphore's office."
  extra{"floor", "ground"}
  "Everything is clean here."
  east to s_office descr "Office of Samphore."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*------- k1_1 -----*/
keep1_1
  title "A room for listeners"
  names {"k1_1", "keep"}
  descr
  "This is a very bland and empty room, all there is here is a table and
  chair along with a few meager stubs of wax and quills for writing. The
  stench of elven sweat and excitement is soaked into the very walls."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra {"wax and quills", "wax", "quills"}
  "The wax and quills are no longer of any value, they have been worn down to stubs."
  extra{"walls","wall", "sweat"}
  "The smell of sweat and excitement is definate, but you really can't see it."
  extra{"floor", "ground"}
  "What are you expecting eyeballs? blood? a few dropped platinum? Go on!"
  south to keep2_1 descr
  "The Grand Entry to Baardek Keep."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*------- k1_3 -----*/
keep1_3
  title "A room for listeners"
  names {"k1_3", "keep"}
  descr
  "This is a very bland and empty room, all there is here is a table and
  chair along with a few meager stubs of wax and quills for writing. The
  stench of elven sweat and excitement is soaked into the very walls."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE

  extra {"wax and quills", "wax", "quills"}
  "The wax and quills are no longer of any value, they have been worn down to stubs."
  extra{"walls","wall", "sweat"}
  "The smell of sweat and excitement is definate, but you really can't see it."
  extra{"floor", "ground"}
  "What are you expecting eyeballs? blood? a few dropped platinum? Go on!"
  south to keep2_3 descr
  "The Grand Entry to Baardek Keep."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*------- ku1_4 -----*/
keepu1_4
  title "On the large stairs"
  names {"ku1_4", "keep"}
  descr "The stairs here lead both up and down into the unknown, there is
  a tight little hallway to the south which seems much more familiar. Along
  the walls of the stairwell, several small inexpensive lanterns light the
  way and the smell of old dust seems to carry on the air coming from above.
  From below the smell of animals long dead clashes disgustingly with the oders
  from above, however some light does come from the dank basement."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"floor", "ground"}
  "What are you expecting eyeballs? blood? a few dropped platinum? Go on!"
  extra{"stairs"}
  "They are pieces of wood gradually getting higher, were you to move along them you would go up as well."
  south to keep2_4 descr "Along the tight hallway.";
  up to library_stairs descr "A top for the stairs.";
  down to basement1 descr "Into the basement of the keep.";
end
/*------- k1_4 -----*/
keep1_4
  title "Closet beneath the stairs"
  names {"k1_4", "closet", "keep"}
  descr "This is a small storage closet beneath the stairwell, there are mops and buckets laying around which the slaves use."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"floor", "ground"}
  "What are you expecting eyeballs? blood? a few dropped platinum? Go on!"
  extra{"stairs"}
  "They are leadind upwards above you, there is no way to tell who is going up them, but the footsteps you here periodically can probably be accounted to the slaves. If you
  could turn yourself upside-down you could walk down the stairs to where you are now!"
  east to keep1_5 descr
  "A dead end in the tight hallway."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*------- k1_5 -----*/
keep1_5
  title "The end of the tight hallway"
  names {"k1_5", "keep"}
  descr "The hallway comes to an abrupt stop here, to the south it
  becomes a cross going north, south, east and west . To the west
  there is a door marked, &cc'Supplies'&cw."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"floor", "ground"}
  "What are you expecting eyeballs? blood? a few dropped platinum? Go on!"
  west to keep1_4 descr
  "The door marked &cc'Supplies'&cw."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
  south to keep2_5 descr
  "The 'T' junction of the hallway.";
end
/*------- PIT ROOM -----*/
pit_room
  title "The Pit Room"
  names {"pit room", "keep"}
  descr "This room's floor is almost completely taken up by the pit.
  There is a clawed up door to the south and clawed up walls all around
  you. It would be easy to throw yourself or others into the pit, be careful!"
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"pit", "floor", "ground"}
  "The pit is completely dark, but as you peer over the edge bravely you
  think you might here shuffling noises echoing up its immesurable length.
  There are some broken fingernails laying by the pit's edge and some
  blood stains as well."
  extra{"door"}"The door is simple and wooden, but has some very intimidating
  scratches all over it."
  extra{"broken fingernails","fingernails", "nails"}
  "Who would leave such a fine pair of nails here? Best leave it for them
  to get when they find them missing!"
  extra{"scratches", "marks", "walls", "wall"}
  "The scratches on the walls and door appear to be from human finger nails,
  you begin to wonder who the Baardekans throw into this pit."

  south to keep2_6 descr
  "The door.."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
dilbegin pitfall();
var
  a_string    :string;
  throwee     :unitptr;
  pc          :unitptr;
code
{
  heartbeat:=PULSE_SEC*3;
  :start:
  wait(SFB_CMD, TRUE);
  if(command("throw"))
  {
    pc := activator;
    a_string := getword(argument);
    block;
    if("pit" in argument)
    {
      throwee := findunit(pc, a_string, FIND_UNIT_HERE, null);
      if(throwee != null)
      {
        if(pc != throwee)
        {
          act("You throw $2n into the pit!", A_SOMEONE, pc, throwee, null, TO_CHAR);
          act("$2n throws you into the pit!", A_SOMEONE, throwee, pc, null, TO_CHAR);
          dilcopy("falling@sands2()", throwee);
          link(throwee, findroom("in_pit@sands2"));
          exec("look", throwee);
          act("$1n throws $2n into the pit!", A_SOMEONE, pc, throwee, null, TO_REST);
        }
        else
        {
          act("You throw yourself into the pit!", A_SOMEONE, activator, null, null, TO_CHAR);
          act("$1n throws $1mself into the pit!", A_SOMEONE, activator, null, null, TO_REST);
          dilcopy("falling@sands2()", throwee);
          link(throwee, findroom("in_pit@sands2"));
          exec("look", throwee);
        }
      }
      else act("You can't throw someone who is not here.", A_SOMEONE, pc, null, null, TO_CHAR);
    }
    else act("Where do you want to throw who?", A_SOMEONE, pc, null, null, TO_CHAR);
  }
  else act("Where do you want to throw what?", A_SOMEONE, pc, null, null, TO_CHAR);
  if(((command(CMD_ENTER)) and ("pit" in argument)))
  {
    block;
    act("You throw yourself into the pit!", A_SOMEONE, activator, null, null, TO_CHAR);
    act("$1n throws $1mself into the pit!", A_SOMEONE, activator, null, null, TO_REST);
    dilcopy("falling@sands2()", activator);
    link(activator, findroom("in_pit@sands2"));
    exec("look", activator);
  }
  goto start;
}
dilend
end
/*------- IN THE PIT -----*/
in_pit
  title "You are in the pit, falling!!"
  names {"in_pit"}
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  IN_ALWAYS_DARK
end
/*------- k2_1 -----*/
keep2_1
  title "Western Grand Entrance Hall of Baardek Keep"
  names {"k2_1", "entrance", "keep"}
  descr
  "The Grand Entrance Hall to the Keep is huge, giant diamond chandeliers
  hang from the ceiling every two metres. There are paintings of battles
  and kingdoms lining every wall yet something strikes you as odd about each
  of them. There are doors to both the north and south opening into the
  unknown."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"gates", "gate"}
  "The gates aer massive black metal, on well oiled hiinges and perfectly
  balanced they open and close smoothly. When locked, you guess, they are
  inpenetrable."
  extra {"chandeliers", "chandelier", "ceiling"}
  "Looking at the high ceiling and closer at the chandeliers you are caught
  by their beauty and magnificence, who would have imagined this splendour
  after seeing the morbid black walls of the keeps outside?"
  extra {"painting", "picture"}
  "This picture is quite odd, it seems to have a godlike figure on it with his
  huge god-like hands stretched out to help the little people, the caption
  reads &cc 'Javelin, the mighty'&cw you sigh at the truth and beauty of it!"
  extra {"paintings", "pictures"}
  "Looking closer at the paintings it seems there is always a dark figure in
  a robe who is calm amid chaos, composed after conquest. This figure appears
  to be gaining from the misery of others and yet remains unseen by those
  around him. One painting catches your eye as a bit different."
  north to keep1_1 descr
  "Some sort of room, let's explore."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
  south to keep3_1 descr
  "Some sort of room, let's explore."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
  west to gate descr
  "The start of the trail through the Baardek Dark Forest."
  keyword {"gates", "gate"} open {EX_OPEN_CLOSE, EX_CLOSED};
  east to keep2_2 descr
  "The centre of the keep's entrance hall.";
end
/*------- k2_2 -----*/
keep2_2
  title "Centre of the  Grand Entrance Hall"
  names {"k2_2", "keep"}
  descr
  "The Keep's Entrance Hall stretches both to the west and east, chandeliers
   hang from the ceiling in ranks while paintings continue in great
   number along these walls, occupying most of the brightly lit room.
   To the west, the hall ends with the gate leaving the keep, to the east
   the hall ends in grandious double doors. One of the many paintings
   seems to have a caption below it."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
   extra {"chandeliers", "chandelier", "ceiling"}
  "Looking at the high ceiling and closer at the chandeliers you are caught
  by their beauty and magnificence, who would have imagined this splendour
  after seeing the morbid black walls of the keeps outside?"
  extra {"painting", "picture", "caption"}
  "One picture has really  caught your eye, there are too many guards around
  for you to steal it so you leave it on the wall. The picture is of a
  mighty figure storming accross Valhalla. The caption beneath reads &cc'Eros
  upon the end of Valhalla'&cw, you hope it isn't so, he doesn't look
  friendly."
  extra {"paintings", "pictures"}
  "Looking closer at the paintings it seems there is always a dark figure in
  a robe who is calm amid chaos, composed after conquest. This figure appears
  to be gaining from the misery of others and yet remains unseen by those
  around him."
   west to keep2_1 descr
  "The western end of the Grand entrance hall.";
  east to keep2_3 descr
  "The eastern end of the Grand entrance hall.";
end
/*------- k2_3 -----*/
keep2_3
  title "Eastern Grand Entrance Hall of Baardek Keep"
  names {"k2_3", "keep"}
  descr "Cumbersome double doors make up most of the eastern wall, dwarfing
  the doors to the north and south. More grand paintings cling to the walls
  in eerie silence and even more chandeliers hang from the great ceiling,
  sparkling in a light of unknown origin."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
   extra {"chandeliers", "chandelier", "ceiling"}
  "Looking at the high ceiling and closer at the chandeliers you are caught
  by their beauty and magnificence, who would have imagined this splendour
  after seeing the morbid black walls of the keeps outside?"
   extra {"lights", "light", "source"}
  "The light is much less comfortable then that of familiar torches, there is an eerie unnaturalness to them you cannot account for."
   extra {"paintings", "pictures"}
  "Looking closer at the paintings it seems there is always a dark figure in
  a robe who is calm amid chaos, composed after conquest. This figure appears
  to be gaining from the misery of others and yet remains unseen by those
  around him."
  north to keep1_3 descr "Some sort of room, let's explore."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
  south to keep3_3 descr  "Some sort of room, let's explore."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
  west to keep2_2 descr "The centre of the Grand Entrance of Baardek Keep.";
  east to keep2_4 descr
  "The centre of the keep's entrance hall."
  keyword {"double doors", "doors"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*------- k2_4 -----*/
keep2_4
  title "A small hallway"
  names {"k2_4", "keep"}
  descr "The walls here have become drastically unpleasant compared to the
  Entrance Hall to the west. There is a
  staircase to the north leading both upwards and downwords, the hall
  continues on further to the east."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE

  extra{"walls"}
  "The walls here are a dark blackish stone, cold and slick to the touch like the lies they have seen."

  extra{"staircase", "stairwell", "stairs"}
  "They seem to lead upwards into darkness."

  north to keepu1_4 descr "A dark and despairing stairwell.";

  west to keep2_3 descr "The end of the Grand Entrance Hall."
  keyword {"double doors", "doors"} open {EX_OPEN_CLOSE, EX_CLOSED};

  east to keep2_5 descr "A four-way cross in the tight dark hallway.";
end
/*------- k2_5 -----*/
keep2_5
  title "A four-way cross in the small hallway"
  names {"k2_5", "keep"}
  descr "Slick black stone walls enclose this part of the hallway. The
  northern branch of the hall leads towards a dead end with a door on its
  western wall. Off to the east you can make out a tiny spiral stairwell
  cut into the wall, to the west and south you see sets of large double doors."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE

  extra{"walls"}
  "The walls here are a dark blackish stone, cold and slick to the touch like the lies they have seen."
  extra{"doors"}
  "They are large wood, and unadorned."
  north to keep1_5 descr "A dark and despairing hallway.";
  west to keep2_4 descr "The west end of the hallway.";
  east to keep2_6 descr "The east end of the small hallway.";
  south to keep3_5 descr "Through the doors."
  keyword {"double doors", "doors"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*------- k2_6 -----*/
keep2_6
  title "East end of a small hallway"
  names {"k2_6","keep"}
  descr "The small hallway ends here, further to the east is a tight space
  with a tight spiral stairwell almost imbedded in the wall, you will never
  fit more then one person into that room! To the north you see a dark oak
  door with what appears to be claw or nail marks all over the frame, and
  the words &cc'The Pit'&cw stenciled on its front."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE

  extra{"walls"}
  "The walls here are a dark blackish stone, cold and slick to the touch like the lies they have seen."

  extra{"door", "claw marks", "nail marks", "marks"}
  "The door, due to its markings appears to lead to the pit, the scratches suggest the pit is not the place to be."
  extra{"spiral stair", "stairwell", "stairs", "stair"}
  "The spiral stairwell is so tight and tiny if another person is in it, you
  will have to wait to go there!"
  north to pit_room descr "Through a door and into a room."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
  west to keep2_5 descr "A cross in the hallway.";
  east to keep2_7 descr "A tight room fit for one and the stair.";
dilbegin no_go_east();
var
  roomeast :unitptr;
  foller   :unitptr;
  pc       :unitptr;
code
{
  heartbeat:=PULSE_SEC+3;
  :start:
  wait(SFB_CMD, command(CMD_EAST));
  pc:=activator;
  roomeast:=findroom("keep2_7@sands2");
  if(((roomeast.inside.type == UNIT_ST_PC) or (roomeast.inside.type == UNIT_ST_NPC)))
  {
    block;
    act("&cc$2n completely fills the stairwell!&cw", A_SOMEONE, pc, roomeast.inside, null, TO_CHAR);
    act("&cc$1n bumps into $2n trying to go east!&cw", A_SOMEONE, pc, roomeast.inside, null, TO_REST);
    act("&cc$2n bumps into you trying to get into the stairwell!&cw", A_SOMEONE, roomeast.inside, pc, null, TO_CHAR);
  }
  goto start;
}
dilend
end
/*------- k3_1 -----*/
keep3_1
  title "The Guard Room"
  names {"k3_1", "keep"}
  descr
  "The impressive guards of Baardek Keep are treated well, it seems the
  guarding of secrets is better rewarded then the guarding of lives.
  Many swords and shields are piled in locked storage chests, as
  well as large amounts of armour and clothes. It seems the servants keep
  the table filled with food and a keg full of drink at all times as well."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra {"food", "drink"}
  "The food appears to be in a pot on the table, perhaps to keep it warm,
  the only drink in the room is in the keg in the corner."
  north to keep2_1 descr
  "The Grand Entry to Baardek Keep."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*------- k3_3 -----*/
keep3_3
  title "Restroom"
  names {"k3_3", "keep"}
  descr
  "You are standing in the centre of a small restroom for the slaves' use. There
  are a few dirty magazines by the toilet and a shard of polished metal for
  a mirror on the wall."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  north to keep2_3 descr
  "The Grand Entry to Baardek Keep."
  keyword {"door"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*------- k3_5 -----*/
keep3_5
  title "By the middle table in the Dining Hall"
  names {"k3_5", "keep", "dining_hall"}
  descr
  "You are standing in front of a large table in the dead centre of a
  giant dining hall. This appears to be the table guests sit at, to the
  west there is an even more ornate table with one extremely large chair
  at its centre and to the east a smaller table is set up for the guards."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra {"floor", "ground"}
  "On the ground there seems to be a giant &cc'E'&cw formed of tiles laid
  into the floor."
  north to keep2_5 descr
  "The Grand Entry to Baardek Keep."
  keyword {"double doors", "doors"} open {EX_OPEN_CLOSE, EX_CLOSED};
  west to dining0 descr
  "The nobles end of the dining hall.";
  east to dining2 descr
  "The guard end of the dining hall.";
end
/*------- dining hall -----*/
dining0
  title "By the head table in the Dining Hall"
  names {"dining0", "keep", "dining_hall"}
  descr
  "You are standing by the largest table in the dining hall, A giant
  throne-like chair is poised at its centre awaiting the almighty Eros
  who's appetite often brings him here. This table is set on ground slightly
  higher than the others so that he can view his guests in distrust."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"table"}
  "The table is kept set, due to Eros' random eating habits and harsh demands."
  extra{"chair", "throne"}
  "The chair is carved and polished from a single block of marble, very impressive!"
  extra {"floor", "ground"}
  "On the ground there seems to be a giant &cc'E'&cw formed of tiles laid
  into the floor."
  east to keep3_5 descr
  "The centre of the dining hall.";
end
/*------- dining hall -----*/
dining2
  title "By the guard table in the Dining Hall"
  names {"dining2", "keep", "dining_hall"}
  descr
  "The table given to the guards of Baardek keep is much less impressive than
  the others. Guards only dine here when there are guests to watch or impress
  with muscle. The Guard room is where Baardek Guards spend their nightly breaks.
  Further to the east of here is the clang and clatter of the Baardek kitchens."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"table"}
  "The table is clean and simple, made of old wood. You guess the only reasin it is
  clean is because of its lack of use."
  extra {"floor", "ground"}
  "On the ground there seems to be a giant &cc'E'&cw formed of tiles laid
  into the floor."
  east to kitchen descr
  "The kitchens of Baardek Keep."
  keyword {"swinging doors", "doors"} open {EX_OPEN_CLOSE, EX_CLOSED};
  west to keep3_5 descr
  "The centre of the dining hall.";
end
/*------- Kitchen -----*/
kitchen
  title "The Kitchens of the Keep"
  names {"kitchen", "keep"}
  descr
  "The Kitchens are all abustle almost all of the time, strange compared to the lack
  of guests the Baardekans might entertain. Slaves are running to and fro, helping
  the cook prepare another meal. To the west the guard table is positioned
  to take the grunt of kitchen noises and odors."
  flags {UNIT_FL_NO_TELEPORT, UNIT_FL_INDOORS, UNIT_FL_NO_WEATHER}
  ALWAYS_LIGHT
  movement SECT_INSIDE
  extra{"food"}
  "Nothing you would enjoy, I assure you."
  extra {"walls and floor", "walls", "floor", "ground"}
  "There are alot of food chunks and other such things splattered on the walls and floor."
  west to dining2 descr "The guard table."
  keyword {"swinging doors", "doors"} open {EX_OPEN_CLOSE, EX_CLOSED};
end
/*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*/
/*-=-=-=-=-=-=-=-=-=-=-= Mobiles -=-=-=-=-=-=-=-=-=-=-=-=-=*/
/*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*/
%mobiles
/* Whimboist  */
whimboist
  names {"whimboist", "wizard"}
  title "Whimboist"
  descr "Whimboist the whimsical wizard is talking to himself here."
  extra{}
  "Whimboist is a crazed looking old man who constantly mutters to himself,
  it is obvious he hasn't changed his clothing in quite some time. He does look
  wisened you must confess, perhaps he can teach you something, or at least
  help you practice something."
  level 60
  race RACE_HUMAN
  sex SEX_MALE
  height 180
  weight 111
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(12, 13, 12, 13, 13, 13, 12, 12)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(1, 2, 2, 0, 4, 1)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(10,10,0,10,10,10,10,10,10,10,0)
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  money 1 GOLD_PIECE
  flags {UNIT_FL_MAGIC}
  dilcopy combat_mag@function("color", "heal", 25, 2);
  romflags {CHAR_PROTECTED, CHAR_DETECT_INVISIBLE}
  exp 0
  alignment 1000
  special SFUN_WHISTLE
  special SFUN_ACCUSE
  dilcopy teach_q_block@function(WHIMBOIST_COMPLETE, "grin");

special SFUN_TEACH_INIT
"&lspells;0;
$1n tells you, 'I have never heard of such a way to use magic.';
$1n tells you, 'I do not know how to teach this sort of magic.';
$1n tells you, 'You have not got %s for me.';
$1n tells you, 'You have not got %d skill points.';
$1n tells you, 'I can not teach you any more, you are already good enough.';
$1n tells you, 'You must be without magical aura in order to learn.';
$1n tells you, 'You must remove all that you wear.';

  0;  100; storm gate          ;  25; 2500;  10;          0;
"
dilbegin whimboist();
var
  pc    :unitptr;
  u     :unitptr;
  i_got :extraptr;
  id    :integer;
code
{
  heartbeat := PULSE_SEC * 3;
 :start:
  dilcopy("global_move@sands2",self);
  wait(SFB_DONE, activator.type == UNIT_ST_PC);
  pc := activator;
  id := dildestroy("global_move@sands2", self);
  if((command(CMD_GIVE)) and (target == self))
  {
    exec("give "+medium.name+" "+pc.name, self);
    exec("drop "+medium.name, self);
  }
  if(WHIMBOIST_COMPLETE in pc.quests)
  {
    pause;pause;pause;pause;
    goto start;
  }
  if(WHIMBOIST_ONGOING in pc.quests) goto ongoing;
  secure(pc, lost_pc);
  pause;
  exec("say Before you can learn my spells "+pc.name+", you must master the sky and the sea.", self); pause;
  exec("say Nod if you are willing to undertake the chore of this mastery.", self);
  wait(SFB_DONE, activator == pc);
  if(command(CMD_NOD))
  {
    pause;
    exec("say Then you must bring me a feather and a bottle of sea water.", self);pause;
    addextra(pc.quests, {WHIMBOIST_ONGOING}, "");
    exec("say I will see you when you return.", self);pause;
    exec("wave", self);
    pause;pause;goto lost_pc;
  }
  else
  {
    pause;
    exec("say Fine, leave me alone then.", self);pause;
    pause;pause;pause;goto lost_pc;
  }
 :ongoing:
  secure(pc, lost_pc);
  i_got := WHIMBOIST_ONGOING in pc.quests;
  if((("quest_water" in i_got.names) and ("feather" in i_got.names))) goto all_done;
  pause;
  exec("say Well "+pc.name+", give me what you have found.", self);
  :waiting:
  wait(SFB_DONE, command(CMD_GIVE));
  if((activator == pc) and (target == self))
  {
    i_got := WHIMBOIST_ONGOING in pc.quests;
    if("feather" in medium.names)
    {
      if("feather" in i_got.names)
      {
        exec("say I have enough feathers from you! Give me the sea water.", self);
        goto waiting;
      }
      addstring(i_got.names, "feather");
      destroy(medium);
      exec("say Thank you.", self);pause;
      goto check;
    }
    else if("quest_water" in medium.names)
    {
      if("quest_water" in i_got.names)
      {
        exec("say I have enough water from you! Give me the feather.", self);
        goto waiting;
      }
      addstring(i_got.names, "quest_water");
      destroy(medium);
      exec("say Thank you.", self);pause;
      goto check;
    }
    else
    {
      exec("say This has nothing to do with what I told you to get.", self);pause;
      exec("say Leave or give me something else.", self);
      exec("give "+medium.name+" "+pc.name, self);
      exec("drop "+medium.name, self);
      goto waiting;
    }
  }
  else goto waiting;
  goto start;
 :check:
  i_got := WHIMBOIST_ONGOING in pc.quests;
  if((("quest_water" in i_got.names) and ("feather" in i_got.names))) goto all_done;
  exec("say Return with or give me what else you've brought.", self);
  goto waiting;

 :all_done:
  pause;
  exec("say Well "+pc.name+", you have brought me all I need.", self); pause;
  act("The feather hisses in $1n's hand.", A_SOMEONE, self, null, null, TO_REST); pause;
  exec("emote pushes the feather into the bottle and grins.", self); pause;
  act("$2n throws the bottle's contents into your face.", A_SOMEONE, pc, self, null, TO_CHAR);
  act("$2n throws the bottle's contents into $1n's face.", A_SOMEONE, pc, self, null, TO_REST);pause;
  act("&c+bA strange blue liquid burns as it seeps into your scalp!&cw", A_SOMEONE, pc, self, null, TO_CHAR);
  act("A strange blue liquid seeps into $1n's scalp.", A_SOMEONE, pc, self, null, TO_REST);pause;
  exec("emote raises his fist to the sky.", self);pause;
  act("$2n utters the words, &c+w'Blessed Master'&cw and points at you.", A_SOMEONE, pc, self, null, TO_CHAR);
  act("$2n utters the words, &c+w'Blessed Master'&cw and points at $1n.", A_SOMEONE, pc, self, null, TO_REST);pause;
  act("&c+yLIGHTNING flashes down and strikes you!&cw", A_SOMEONE, pc, self, null, TO_CHAR);
  act("&c+yLIGHTNING flashes down and strikes $1n!&cw", A_SOMEONE, pc, self, null, TO_REST);
  foreach(UNIT_ST_PC, u)
  {
    act("&c+wYou are singed by the lightning.&cw", A_SOMEONE, u, null, null, TO_CHAR);
    u.hp := u.hp / 4;
    position_update(u);
  }pause;
  exec("say You have mastery over the sea and sky now, "+pc.name+".", self);
  addextra(pc.quests, {WHIMBOIST_COMPLETE}, "");
  subextra(pc.quests, WHIMBOIST_ONGOING);
  pause;pause;pause;pause;
  goto start;

 :lost_pc:
  unsecure(pc);
  pause;pause;
  goto start;
}
dilend
end

/* Morshaal  */
morshaal
  names {"morshaal", "wind", "cloud", "dark"}
  title "Morshaal"
  descr "Morshaal, cloud of wind and shadow is here."
  extra{}
  "Morshaal is a shapeless dark cloud whispering, hissing, and screaming its way
  through the Ivory paths. Tales have been told about the inhuman beast that stands
  before you, and none are promising.. FLEE!"
  level 55
  race RACE_CAVE_WIGHT
  sex SEX_NEUTRAL
  height 200
  weight 40
  flags {UNIT_FL_MAGIC}
  NATURAL_DEF(WPN_CRUSH, ARM_PLATE)
  special SFUN_RANDOM_ZONE_MOVE
  special SFUN_AGGRESSIVE "$1n whispers softly and attacks $3N!" time 25 bits SFB_RANTIME
  dilcopy combat_mag@function("stinking", "heal", 25, 1);
  exp 70
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(11,  0, 10, 30, 5, 14, 20, 10)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(0, 0, 0, 0, 25, 5)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(10,10,0,10,10,0,0,10,10,10,0)
dilbegin morshaal();
code
{
  heartbeat := PULSE_SEC * 3;
 :start:
  wait(SFB_TICK, TRUE);
  if(rnd(1,100) < 9)
  {
    if(self.outside == findroom("morshaal_hq@sands2"))
    {
      act("$1n decides to go out for a bit..", A_SOMEONE, self, null, null, TO_REST);
      link(self, findroom("gate_home_"+itoa(rnd(1,6))+"@sands2"));
    }
    else
    {
      if(self.position != POSITION_FIGHTING)
      {
        link(self, findroom("morshaal_hq@sands2"));
        act("$1n descends from above, screaming and blowing..", A_SOMEONE, self, null, null, TO_REST);
      }
    }
  }
  if(rnd(1,100) < 5)
    act("A screaming whispering noise echos by the path.", A_SOMEONE, self, null, null, TO_REST);
  goto start;
}
dilend
end
/* Positive Storm Gate */
pos_st_gate
  names {"storm gate", "positive_gate", "gate", "storm", "cloud"}
  title "Storm Gate"
  descr "&c+wA swirling storm cloud is here.&cc"
  extra {}
  "The storm gate is a gateway to a dimention where distance is warped
  and sanity challenged. Only those with the proper key may enter."
  level 154
  race RACE_CAVE_WIGHT
  sex SEX_NEUTRAL
  height 190
  weight 10
  flags {UNIT_FL_MAGIC, UNIT_FL_NO_TELEPORT}
  NATURAL_DEF(WPN_BITE, ARM_PLATE)
  special SFUN_RANDOM_ZONE_MOVE
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(11, 15, 10, 15, 15, 14, 10, 10)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(0, 0, 5, 0, 0, 5)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(10,10,0,10,10,10,10,10,10,10,0)
dilbegin aware p_storm_gate();
var
  rand        :integer;
  enterer     :unitptr;
  other_gate  :unitptr;
  i_fight     :integer;
  i_opened    :integer;
  i_closetime :integer;
  i_tick      :integer;
  s_bunk      :string;
  cast_bra    :integer;
  i_hit       :integer;
code
{
  heartbeat := PULSE_SEC * 3;
  act("&c+wA clap of thunder shatters your eardrums and deafens you momentarilly!&cw", A_SOMEONE, self, null, null, TO_ALL);
  i_closetime := 0;
:start:
  i_tick   := interrupt(SFB_TICK, TRUE, ticked);
  i_opened := interrupt(SFB_MSG, "OPENCAST" in argument, opened);
  i_hit    := interrupt(SFB_CMD, ((command(CMD_KILL)) and (activator == self)), ikill);
  i_fight  := interrupt(SFB_COM, self.position == POSITION_FIGHTING, in_fight);
  wait(SFB_CMD, ((command(CMD_ENTER)) and (argument in self.names)));
  enterer := activator;   block;
  clear(i_tick);
  clear(i_opened);
  secure(enterer, lost_them);
  if(enterer.position <= POSITION_FIGHTING) goto not_up;
  if(i_closetime > 0)
  {
    act("&ccYou step through the storm gate and your vision grows dim.&cw", A_SOMEONE, enterer, null, null, TO_CHAR);
    if(rnd(1, 100) > (enterer.abilities[ABIL_CON] + enterer.abilities[ABIL_BRA]))
    {
      act("&c+yA wave of nausea hits you and you collapse!&cw", A_SOMEONE, enterer, null, null, TO_CHAR);
      enterer.hp := -1;
      position_update(enterer);
    }
    if(rnd(1, 60) > enterer.abilities[ABIL_DEX])
    {
      if(rnd(1,3) == 2)
      {
        act("&c+yYou stumble on your way into the gate and the world begins to spin violently!!&cw", A_SOMEONE, enterer, null, null, TO_CHAR);
        act("&c+c$1n stumbles on their way into the gate and SHRIEKS as $1e is pulled through.&cw", A_SOMEONE, enterer, null, null, TO_REST);
        link(enterer, findrndunit( self, FIND_UNIT_GLOBAL, UNIT_ST_ROOM));
        goto start;
      }
    }
    act("&c+c$1n enters the $2n and dissapears.&cw", A_SOMEONE, enterer, self, null, TO_REST);
    link(enterer, findroom("ivory_"+itoa(rnd(1,15))+"@sands2"));
    act("&c+c$1n falls from a thickened cloud of gas in the sky.&cw", A_SOMEONE, enterer, other_gate, null, TO_REST);
    exec("look", enterer);
    if(rnd(1, 6) == 2) /* Departure gate explodes */
    {
      act("&c+cThe $1n becomes unstable, quivers for a moment, and then explodes!!&cw", A_SOMEONE, self, null, null, TO_REST);
      destroy(self);
      quit;
    }
    goto start;
  }
  else
  {
    act("The gate is not open.", A_SOMEONE, enterer, null, null, TO_CHAR);
    act("$1n tries to enter a closed gate.", A_SOMEONE, enterer, null, null, TO_REST);
    goto start;
  }
:not_up: /* Not standing or in a fight */
  pause;
  if(enterer.position == POSITION_FIGHTING)
  {
    act("You attempt to flee doom by entering the gate, but it rejects your violent mood.", A_SOMEONE, enterer, null, null, TO_CHAR);
    act("$1n puts a foot through the $2N, which hisses and denies $1m", A_SOMEONE, enterer, self, null, TO_REST);
    change_speed(enterer, PULSE_VIOLENCE);
  }
  else if(enterer.position == POSITION_SLEEPING) act("You dream of entering the $2N.", A_SOMEONE, enterer, self, null, TO_CHAR);
  else act("Perhaps you should stand up first.", A_SOMEONE, enterer, self, null, TO_CHAR);
  goto start;
:ikill:
  block;
  clear(i_hit);
  goto start;
:lost_them:
  pause;
  unsecure(enterer);
  goto start;
 :in_fight:
  clear(i_fight);
  act("&c+rThe $1n becomes unstable and explodes!&cw", A_SOMEONE, self, null, null, TO_REST);
  act("The blast knocks you unconcious.", A_SOMEONE, self.fighting, null, null, TO_CHAR);
  act("The blast knocks $1n unconcious.", A_SOMEONE, self.fighting, null, null, TO_REST);
  self.fighting.hp := -1;
  position_update(self.fighting);
  destroy(self);
  quit;

 :opened:
  clear(i_opened);
  clear(i_tick);
  if(i_closetime  > 0)
  {
    act("The $1n is already open!", A_SOMEONE, self, null, null, TO_REST);
    goto start;
  }
  s_bunk := getword(argument);
  cast_bra := atoi(argument);
  i_closetime  := 1;
  act("&c+wThe $1n opens with a whoosh.&cw", A_SOMEONE, self, null, null, TO_REST);
  goto start;

 :ticked:
  clear(i_tick);
  if(i_closetime > 0)
  {
    i_closetime := i_closetime +1;
    if(i_closetime > (cast_bra / 4))
    {
      act("&c+wThe $1n closes with a hiss.&cw", A_SOMEONE, self, null, null, TO_REST);
      i_closetime :=0;
    }
    goto start;
  }
  if(rnd(1,6000) == 10) link(self, findrndunit(self, FIND_UNIT_GLOBAL, UNIT_ST_ROOM));
  if(rnd(1,5000) == 10)
  {
    act("&c+rThe $1n becomes unstable and explodes!&cw", A_SOMEONE, self, null, null, TO_REST);
    destroy(self);
  }
  goto start;
}
dilend
end
/* Negative Storm Gate */
neg_st_gate
  names {"storm gate", "negative_gate", "gate", "storm", "cloud"}
  title "Storm Gate"
  descr "&c+wA swirling storm cloud is here.&cc"
  extra {}
  "The storm gate will take you home as soon as you enter it.. Maybe."
  level 154
  race RACE_CAVE_WIGHT
  sex SEX_NEUTRAL
  height 190
  weight 10
  NATURAL_DEF(WPN_BITE, ARM_PLATE)
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(11, 15, 10, 15, 15, 14, 10, 10)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(0, 0, 5, 0, 0, 5)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(10,10,0,10,10,10,10,10,10,10,0)
  flags {UNIT_FL_MAGIC, UNIT_FL_NO_TELEPORT}
dilbegin n_storm_gate();
var
  rand        :integer;
  enterer     :unitptr;
  other_gate  :unitptr;
  i_fight     :integer;
  i_opened    :integer;
  i_closetime :integer;
  i_tick      :integer;
  s_bunk      :string;
  cast_bra    :integer;
  i           :integer;
  i_hit       :integer;
code
{
  heartbeat := PULSE_SEC * 3;
  act("&c+wA clap of thunder shatters your eardrums and deafens you momentarilly!&cw", A_SOMEONE, self, null, null, TO_ALL);
  i_closetime := 0;
:start:
  i_tick := interrupt(SFB_TICK, TRUE, ticked);
  i_hit  := interrupt(SFB_CMD, ((command(CMD_KILL)) and (activator == self)), ikill);
  i_opened := interrupt(SFB_MSG, "OPENCAST" in argument, opened);
  i_fight := interrupt(SFB_COM, self.position == POSITION_FIGHTING, in_fight);
  wait(SFB_CMD, ((command(CMD_ENTER)) and (argument in self.names)));
  enterer := activator;   block;
  clear(i_tick);
  secure(enterer, lost_them);
  if(enterer.position <= POSITION_FIGHTING) goto not_up;
  if(i_closetime > 0)
  {
    act("&ccYou step through the storm gate and your vision grows dim.&cw", A_SOMEONE, enterer, null, null, TO_CHAR);
    if(rnd(1, 100) > (enterer.abilities[ABIL_CON] + enterer.abilities[ABIL_BRA]))
    {
      act("&c+yA wave of nausea hits you and you collapse!&cw", A_SOMEONE, enterer, null, null, TO_CHAR);
      enterer.hp := -1;
      position_update(enterer);
    }
    if(rnd(1, 50) > enterer.abilities[ABIL_DEX])
    {
      if(rnd(1,3) == 2)
      {
        act("&c+yYou stumble on your way into the gate and the world begins to spin violently!!&cw", A_SOMEONE, enterer, null, null, TO_CHAR);
        act("&c+c$1n stumbles on their way into the gate and SHRIEKS as $1e is pulled through.&cw", A_SOMEONE, enterer, null, null, TO_REST);
        link(enterer, findrndunit( self, FIND_UNIT_GLOBAL, UNIT_ST_ROOM));
        goto start;
      }
    }
    i := 0;
    rand := rnd(1, 3);
    other_gate := self;
    while(i < rand)
    {
      other_gate := findunit(other_gate, "positive_gate", FIND_UNIT_WORLD, null);
      i := i + 1;
    }
    act("&c+c$1n enters the $2n and dissapears.&cw", A_SOMEONE, enterer, self, null, TO_REST);
    link(enterer, other_gate.outside);
    act("&c+c$1n steps out of the $2n looking disoriented.&cw", A_SOMEONE, enterer, other_gate, null, TO_REST);
    rand := rnd(1,10);
    if(rand == 2) /* Departure gate explodes */
    {
      act("&c+cThe $1n becomes unstable, quivers for a moment, and then explodes!!&cw", A_SOMEONE, self, null, null, TO_REST);
      destroy(self);
      quit;
    }
    if(rand == 3) /* Arrival gate explodes */
    {
      act("&c+cWhen $1n exits the $2n, it quivers for a moment and then explodes!!&cw", A_SOMEONE, enterer, other_gate, null, TO_REST);
      act("&c+yAs you exit the $2n, it quivers for a moment and then explodes!!&cw", A_SOMEONE, enterer, other_gate, null, TO_CHAR);
      destroy(other_gate);
      enterer.hp := enterer.hp - 10;
      position_update(enterer);
    }
    exec("look", enterer);
    goto start;
  }
  else
  {
    act("The gate is not open.", A_SOMEONE, enterer, null, null, TO_CHAR);
    act("$1n tries to enter a closed gate.", A_SOMEONE, enterer, null, null, TO_REST);
    goto start;
  }

:not_up: /* Not standing or in a fight */
  pause;
  if(enterer.position == POSITION_FIGHTING)
  {
    act("You attempt to flee doom by entering the gate, but it rejects your violent mood.", A_SOMEONE, enterer, null, null, TO_CHAR);
    act("$1n puts a foot through the $2n, which hisses and denies $1m", A_SOMEONE, enterer, self, null, TO_REST);
    change_speed(enterer, PULSE_VIOLENCE);
  }
  else if(enterer.position == POSITION_SLEEPING) act("You dream of entering the $2N.", A_SOMEONE, enterer, self, null, TO_CHAR);
  else act("Perhaps you should stand up first.", A_SOMEONE, enterer, self, null, TO_CHAR);
  goto start;
 :lost_them:
  pause;
  unsecure(enterer);
  goto start;
 :in_fight:
  clear(i_fight);
  act("&c+r$1n becomes unstable and explodes!&cw", A_SOMEONE, self, null, null, TO_REST);
  act("The blast knocks you unconcious.", A_SOMEONE, self.fighting, null, null, TO_CHAR);
  act("The blast knocks $1n unconcious.", A_SOMEONE, self.fighting, null, null, TO_REST);
  self.fighting.hp := -1;
  position_update(self.fighting);
  destroy(self);
 :opened:
  clear(i_opened);
  clear(i_tick);
  if(i_closetime  > 0)
  {
    act("The $1n is already open!", A_SOMEONE, self, null, null, TO_REST);
    goto start;
  }
  s_bunk := getword(argument);
  cast_bra := atoi(argument);
  i_closetime  := 1;
  act("&c+wThe $1n opens with a whoosh.&cw", A_SOMEONE, self, null, null, TO_REST);
  goto start;
 :ikill:
  block;
  clear(i_hit);
  goto start;
 :ticked:
  clear(i_tick);
  if(i_closetime > 0)
  {
    i_closetime := i_closetime +1;
    if(i_closetime > (cast_bra / 4))
    {
      act("&c+wThe $1n closes with a hiss.&cw", A_SOMEONE, self, null, null, TO_REST);
      i_closetime :=0;
    }
    goto start;
  }
  goto start;
}
dilend
end
/*------- SHAME -------*/
shame_spirit
  names {"sprit of shame", "spirit", "shame"}
  title "the Spirit of Shame"
  descr "The Spirit of Shame is whispering about in the darkness."
  extra {}
  "The spirit of shame resembles a small distortion in the shadows. She is of
  no visible substance but something tells you she is not to be trifled with."
  level 100
  race RACE_CAVE_WIGHT
  sex SEX_FEMALE
  height 180
  weight 10
  NATURAL_DEF(WPN_BITE, ARM_PLATE)
  dilcopy combat_mag@function("jolt", "heal", 25, 2);
  special SFUN_HIDEAWAY
  special SFUN_AGGRESSIVE "$1n emerges from the shadows to attack $3N!" time 20 bits SFB_RANTIME
  exp 75
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(11, 15, 10, 15, 15, 14, 10, 10)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(0, 0, 5, 0, 0, 5)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(10,10,0,10,10,10,10,10,10,10,0)
dilbegin shame_spirit();
code
{
  heartbeat:=PULSE_SEC*5;
 :start:
  wait(SFB_COM, self.position == POSITION_FIGHTING);
  exec("say You will now experience shame!", self);
  while(self.position == POSITION_FIGHTING)  pause;
  goto start;
}
dilend
end
/*------- PAIN -------*/
pain_spirit
  names {"spirit of pain", "spirit", "pain"}
  title "the Spirit of Pain"
  descr "The Spirit of Pain is hovering here."
  extra {}
  "The spirit is somewhat translucent, otherwise he resembles a slightly decomposed
  corpse clad in torn clothing. Everything about him is purple, from his
  clothes to his eyes."
  level 95
  race RACE_CAVE_WIGHT
  sex SEX_MALE
  height 180
  weight 10
  NATURAL_DEF(WPN_CLAW, ARM_CHAIN)
  dilcopy combat_mag@function("frostball", "heal", 25, 2);
  special SFUN_AGGRESSIVE "$1n howls madly and attacks $3N!" time 20 bits SFB_RANTIME
  exp 70
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(11, 15, 10, 15, 19, 10, 10, 10)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(0, 0, 5, 0, 0, 5)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(20,0,0,0,0,30,0,0,0,20,20)
dilbegin pain_spirit();
code
{
  heartbeat:=PULSE_SEC*5;
 :start:
  wait(SFB_COM, self.position == POSITION_FIGHTING);
  exec("say You will now experience pain!", self);
  while(self.position == POSITION_FIGHTING)
  {
    if(rnd(1, 20) < 3) exec("cast meteor "+self.fighting.name, self);
    pause;
  }
  goto start;
}
dilend
end
/*------ TUNISK ------*/
tunisk
  names {"tunisk", "dragon"}
  title "Tunisk"
  descr "A Gigantic Black Dragon is laying here."
  extra{}
  "Tunisk is giant and ancient. His scales are dark and well oiled making
  his body seem like a dark night and a short and pointy grey beard hangs
  from his dragon chin."
  level 199
  race RACE_DRAGON_BLACK
  sex SEX_MALE
  height 2000
  weight 2500
  NATURAL_DEF(WPN_CLAW, ARM_PLATE)
  dilcopy combat_mag@function("fireball", "heal", 25, 2);
  dilcopy tunisk_give@sands2();
  exp 88
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(11, 15, 10, 15, 10, 14, 10, 15)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(0, 0, 0, 0, 25, 5)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(10,10,0,10,0,10,10,0,10,10,0)
dilbegin tunisk();
var
  swrd_load   :unitptr;
  pc          :unitptr;
  deman       :unitptr;
  hole        :unitptr;
  irnd        :integer;
  iFight      :integer;
  what_i_got  :extraptr;
  nxt_str     :string;
code
{
  heartbeat:=PULSE_SEC * 3;
  on_activation(self.position == POSITION_FIGHTING, in_a_fight);
:start:
  iFight := interrupt(SFB_COM, self.position == POSITION_FIGHTING, in_a_fight);
  wait(SFB_DONE, activator.type == UNIT_ST_PC);
  pc := activator;
  secure(pc, lost_my_dude);
  pause;
  exec("emote purrs loudly, causing dust to fall from the ceiling.", self);
  pause;
  :other:
  if(TUNISK_COMPLETE in pc.quests) goto complete;
  if(TUNISK_ONGOING in pc.quests) goto ongoing;
  pause;
  exec("emote shifts his massive weight.", self);pause;
  act("$2n turns $2s head and looks at you!", A_SOMEONE, pc, self, null, TO_CHAR);
  act("$2n turns $2s head and looks at $1n!", A_SOMEONE, pc, self, null, TO_REST);
  pause;
  exec("nod "+pc.name, self);
  act("Your body begins to tingle and your vision seems to be covered by a blue veil for a moment.", A_SOMEONE, pc, null, null, TO_CHAR);
  act("$1n's body is momentarilly surrounded by a blue glow.", A_SOMEONE, pc, null, null, TO_REST);
  pause;
  exec("grin", self);
  pause;
  if(pc.level > 30){
    exec("say Well "+pc.name+", you seem to be more worthy then the other puny would be adventurers the pit dwellers have sent me.", self);
    pause;
    exec("say Nod if you are trying to get out of here?", self);
    exec("chuckle", self);
   :wait_2:
    wait(SFB_DONE, activator == pc);
    if(command(CMD_SHAKE)){
      pause;
      exec("Then begone, before I gobble you up!", self); pause;
      exec("emote waves a claw toward the entrance of his cave, it seems that is the way to go.", self);
      goto start;
    }
    else if(command(CMD_NOD)){
      pause;
      exec("say Good, perhaps I can help you.", self); pause;
      exec("emote shows far too many teeth for comfort as he smiles again.", self); pause;
      exec("say I will open a gate for you to leave here, but you must bring me some things in return.", self); pause;
      exec("say No, I do not believe you will actually return.", self); pause;
      exec("scratch", self); pause;
      exec("sigh", self); pause;
      exec("say I must have what I ask of you, and so I will make you an offer.", self); pause;
      exec("say Bring me these things and I will let you through my gate at any time.", self); pause;
      exec("say I will also give you something that will make your return worthwhile.", self); pause;
      exec("say Return here empty handed and I will eat you up!", self); pause;
      exec("say Nod if you will bring me the things I will list?", self);
    :wait_1:
      wait(SFB_DONE, activator == pc);
      if(command(CMD_NOD)){
        pause;
        exec("say Good, here is what I need.", self);
        pause;
        deman := load("demands@sands2");
        link(deman, pc);
        act("$2n gives you a note.", A_SOMEONE, pc, self, null, TO_CHAR);
        act("$2n gives $1n a small piece of paper.", A_SOMEONE, pc, self, null, TO_REST); pause;
        addextra(pc.quests, {TUNISK_ONGOING}, "gathering");
        hole := load("portal@sands2");
        link(hole, self.outside);
        exec("emote waves a clawed hand over the floor.", self);
        pause;pause;pause;
        goto start;
      }
      else if(command(CMD_SHAKE)){
        pause;
        exec("Then begone, before I gobble you up!", self); pause;
        exec("emote waves a hand toward the entrance of his cave, it seems that is the way to go.", self);
        pause;pause;pause;
        goto start;
      }
      else{
        pause;
        exec("say "+pc.name+", answer me with a nod or shake of your head.", self);
        goto wait_1;
      }
    }
    else{
      pause;
      exec("say Answer with a nod or shake of your head, "+pc.name+".", self);
      goto wait_2;
    }
  }
  else{
    pause;
    exec("say You are puny! Begone from here!", self); pause;
    exec("emote waves a hand toward the entrance of his cave, it seems that is the way to go.", self);
    goto start;
  }
  goto start;
:ongoing:
  exec("say "+pc.name+", give me the daggers I asked for.", self);
  :on2:
  what_i_got := TUNISK_ONGOING in pc.quests;
  if((("Body Scalder" in what_i_got.names) and ("Mind Scorcher" in what_i_got.names) and ("Soul Burner" in what_i_got.names))) goto all_done;
 :wait2:
  wait(SFB_DONE, activator == pc);
  pause;
  if((findunit(self, "portal", FIND_UNIT_HERE, null)) == null){
    exec("say The portal will open for you.", self); pause;
    hole := load("portal@sands2");
    link(hole, self.outside);
  }
  goto on2;
:complete:
  pause;
  if(not findunit(pc, "revolution", FIND_UNIT_IN_ME, null)){
    what_i_got := TUNISK_COMPLETE in pc.quests;
    if("got it" in what_i_got.names) goto too_many;
    addstring(what_i_got.names, "got it");

    exec("say Hmmm, you have lost the Revolution "+pc.name+".", self);
    exec("say Here is another, be more careful next time.", self); pause;
    exec("smile "+pc.name, self);
    swrd_load := load("revolution@sands2");
    act("$2n gives you $3n.", A_SOMEONE, pc, self, swrd_load, TO_CHAR);
    act("$2n gives $1n $3n.", A_SOMEONE, pc, self, swrd_load, TO_REST);
    link(swrd_load, pc);pause;
  }
  exec("say "+pc.name+", The portal is open for you.", self); pause;
  hole := load("portal@sands2");
  link(hole, self.outside);
  goto start;
 :too_many:
  hole := load("portal@sands2");
  link(hole, self.outside);
  exec("say Well "+pc.name+", you have used all your Revolutions..", self); pause;
  exec("say Worship me and I will let you help me again, or enter the portal.", self);
  wait(SFB_DONE, ((command(CMD_WORSHIP)) and (target == self) and (activator == pc)));
  exec("say You may now listen to my tale again.", self);
  subextra(pc.quests, TUNISK_COMPLETE); pause;
  goto other;
:lost_my_dude:
  unsecure(pc);
  pause;
  goto start;
:all_done:
  pause;
  exec("say You have brought me the three daggers of Hondole's Triad, "+pc.name, self);pause;
  exec("say Good, I will give you what you have earned.", self);pause;
  exec("emote takes each dagger and breaks them in half with a mighty claw.", self);pause;
  exec("look "+pc.name, self);
  exec("grin "+pc.name, self); pause;
  if (pc.sex == SEX_MALE) exec("say "+pc.name+", you think I am mad don't you? Well watch closely my son!", self);
  if (pc.sex == SEX_FEMALE) exec("say "+pc.name+", you think I am mad don't you? Well watch closely my sweet daughter!", self);
  if (pc.sex == SEX_NEUTRAL) exec("say "+pc.name+", you think I am mad don't you? Well watch closely sexless one!", self);
  pause;
  exec("emote breaths a column of blue fire at the pile of dagger pieces.", self); pause;
  exec("emote steps back, almost crushing you!",self);pause;
  act("As you watch the pieces of Body, Mind, and Soul they turn to a silvery liquid.", A_SOMEONE, pc, null, null, TO_ALL); pause;
  act("The liquid metal begins to crawl around the floor, shrieking loudly!", A_SOMEONE, pc, null, null, TO_ALL); pause;
  act("The blobs of liquid gather into three lines and start to take shape!", A_SOMEONE, pc, null, null, TO_ALL); pause;
  act("The lines harden and change back to metal, begin to pulsate with a blue light, and become large broadswords.", A_SOMEONE, pc, null, null, TO_ALL); pause;
  swrd_load := load("revolution@sands2");
  link(swrd_load, self.outside);
  exec("emote grabs two of the swords.", self);pause;
  exec("say The third is yours "+pc.name+". get it off my floor.", self); pause;
  exec("say If your sword breaks, remember I have the other two. The destruction of those daggers was my only goal.", self); pause;
  exec("I consider you a friend now, young "+pc.name+". Return any time for I will open the gate for you and your party.", self); pause;
  addextra(pc.quests, {TUNISK_COMPLETE}, "");
  subextra(pc.quests, TUNISK_ONGOING);
  exec("say The portal is open, farewell.", self); pause;
  exec("wave "+pc.name, self);
  destroy(medium);
  hole := load("portal@sands2");
  link(hole, self.outside);
  goto start;
:in_a_fight:
  clear(iFight);
  exec("You dare attack the mighty Tunisk! You shall suffer for your error!", self);
  act("You think you may have made a mistake.", A_SOMEONE, self.fighting, null, null, TO_CHAR);
  while(self.position == POSITION_FIGHTING) pause;
  goto start;
}
dilend
end
/*------ LIBRARY ASSISTANT ------*/
ast_librarian
  names {"the library assistant", "librarian", "man", "assistant"}
  title "the library assistant"
  descr "A library assistant is standing here."
  extra{}
  "This little fellow is very bookwormish, probably a limited amount of friends."
  level 63
  race RACE_HUMAN
  sex SEX_MALE
  height 165
  weight 120
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  special SFUN_RANDOM_ZONE_MOVE
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(24, 20, 20, 34, 0, 2, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 0, 35, 0, 20, 5)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,30,0,0,0,0,0)
end
/*------ LIBRARIAN ------*/
librarian
  names {"floyd", "librarian", "man"}
  title "Floyd"
  descr "Floyd the librarian is standing here."
  extra{}
  "Floyd is a cute little man who seems more interested in books then people.
  He is watching you closely to make sure you behave and pay all your late fines."
  level 65
  race RACE_HUMAN
  sex SEX_MALE
  height 175
  weight 130
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  special SFUN_RANDOM_ZONE_MOVE
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(24, 20, 20, 34, 0, 2, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 0, 35, 0, 20, 5)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,30,0,0,0,0,0)
dilbegin librarian();
var
  iRand :integer;
  bk    :unitptr;
code
{
  heartbeat:=PULSE_SEC*3;
  :start:
  iRand:=rnd(1,70);
  if(iRand == 1) exec("say Hmmmm, sheep digest.", self);
  else if(iRand == 2){
    act("get book", A_SOMEONE, self, null, null, TO_ALL);
    pause;
    bk:=findunit(self, "book", FIND_UNIT_IN_ME, null);
    if(bk != null) destroy(bk);
  }
  else if(iRand == 3)  exec("emote mumbles to himself.", self);
  else if(iRand == 4)  exec("emote straightens some books.", self);
  else if(iRand == 5)  exec("say Lalala, books books.", self); 
  else if(iRand == 6)  exec("say I like to read, yes I do..", self);
  clear(iRand);
  pause; pause;
  goto start;
}
dilend
end
/*------ PIT DWELLER ------*/
pit_guy
  names {"a pit dweller", "dweller", "man"}
  title "a Pit Dweller"
  descr "A dirty and skinny pit dweller is here."
  extra{}
  "Looking at this crusty fellow makes you feel incredible pity as well as open
  disgust, there is nothing left in his eyes but a dull pain. His skin is deathly
  pale suggesting the length of time he has been down here."
  level 65
  race RACE_HUMAN
  sex SEX_MALE
  height 175
  weight 130
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  special SFUN_RANDOM_ZONE_MOVE
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(24, 20, 20, 34, 0, 2, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 0, 35, 0, 20, 5)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,30,0,0,0,0,0)
dilbegin pit_guy();
var
  iRand :integer;
code
{
  heartbeat:=PULSE_SEC*3;
  :start:
  iRand:=rnd(1,70);
  if(iRand == 1){
    exec("say Do you have a light?", self); pause;
    exec("moohaha", self); pause;
    act("You get the feeling this guy is a little crazy from being down here too long.", A_SOMEONE, self, null, null, TO_ALL);
  }
  else if(iRand == 2){
    act("A small furry creature skitters by.", A_SOMEONE, self, null, null, TO_ALL);
    pause;
    exec("say Are you going to eat that?", self); pause;
    exec("emote grabs the furry critter and eats it.", self); pause;
  }
  else if(iRand == 3)  exec("emote asks himself a question.", self);
  else if(iRand == 4){
    exec("jump", self); pause;
    exec("emote mubles something about it never working.", self); pause;
  }
  else if(iRand == 5){
    exec("say Welcome to my pit!", self); pause;
    exec("say Are you staying long?", self); pause;
  }
  else if(iRand == 6){
    exec("say I was put here by mistake, they will be here to retrieve me soon.", self); pause;
    exec("nod "+ self.name, self); pause;
  }
  else if(iRand == 7){
    if(TUNISK_COMPLETE in activator.quests) exec("say Your friend Tunisk is to the east, I wish he would let me out like he did you.", self);
    else  exec("say Tunisk is to the east, perhaps you are big enough to accept his quest.", self);
  }
  clear(iRand);
  pause; pause;
  goto start;
}
dilend
end
/*------ EROS ------*/
eros
  names {"eros", "keepmaster", "man"}
  title "Eros"
  descr "Eros, master of Baardek Keep is here."
  extra{}
  "Eros is a mighty large and intimidating man, his scowl seems permanent and his eyes seen to never rest. There is no mistaking his authority."
  level 75
  alignment 550
  race RACE_ELF
  sex SEX_MALE
  height 190
  weight 160
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  exp 85
  special SFUN_RESCUE "silk"
  /* CAST BLIND? SPIT? */
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(24, 20, 4, 35, 10, 7, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(0, 45, 0, 0, 20, 5)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,30,0,0,0,0,0)
dilbegin eros();
var
  iFight    :integer;
  iRand     :integer;
  uMusic    :unitptr;
code
{
  heartbeat:=PULSE_SEC*4;
  :start:
  iFight:=interrupt(SFB_COM, self.position == POSITION_FIGHTING, in_a_fight);
  if(self.outside != findroom("bedroom@sands"))
  {
    walkto(findroom("bedroom@sands2"));
  }
  iRand:=rnd(1, 100);
  if(iRand == 2)
  {
    walkto(findroom("dining0@sands2"));
    pause;
    exec("say Music!", self);
    pause;
    exec("tell min_mob come", self);
    pause;
    exec("say Music now!", self);pause;
    exec("emote growls and grows impatient.", self);
    pause;pause;pause;pause;pause;
    exec("clap", self);pause;
    exec("say Enough.", self);pause;
    exec("emote waves the minstrel off.", self);pause;pause;
    goto start;
  }
  clear(iRand);
  pause;pause;
  goto start;
 :in_a_fight:
  clear(iFight);
  exec("You will not take my slaves!", self);
  while(self.position == POSITION_FIGHTING) pause;
  goto start;
}
dilend
end
/*------- MINSTREL ------*/
minstrel
  names {"frank", "minstrel", "min_mob"}
  title "Frank"
  descr "Frank, the Baardekan minstrel is here with his trusty harp."
  extra{}
  "Frank is a handsome minstrel for Eros and the people of Baardek.. The
  usual courtesies given to bards and others of a similar profession, he
  is best LEFT ALONE!"
  level 50
  race RACE_ELF
  sex SEX_MALE
  height 185
  weight 120
  money 6 SILVER_PIECE
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  exp -400
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(20, 2, 14, 22, 20, 12, 10, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 10, 10, 10, 15, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,10,10,10,0,0,0,0)
dilbegin minstrel();
var
  iGave   :integer;
  uPc     :unitptr;
  iTrans  :integer;
code
{
  heartbeat:=PULSE_SEC *4;
 :start:
  iGave:=interrupt(SFB_DONE, ((command(CMD_GIVE)) and (target == self)), gave_me_shit);
  wait(SFB_DONE, ((command(CMD_TELL)) and ("eros" in activator.names) and (target == self)));
  walkto(findroom("dining0@sands2"));
  exec("play harp.", self); pause;
  act("Song, sung, blue.. weeping like a willow.. hmmmmmm...", A_SOMEONE, self, null, null, TO_ALL);pause;
  act("Falalalala la la la la la hummm..", A_SOMEONE, self, null, null, TO_ALL);pause;
  pause; pause;
  exec("bow", self);pause;pause;
  walkto(findroom("dining2@sands2"));pause;
  exec("rest", self);pause;
  exec("emote tunes his harp and hums quietly.", self);
  goto start;
 :gave_me_shit:
  clear(iGave);
  uPc := activator;
  if("frank_harp" in medium.names)
  {
    exec("say You have returned my harp "+uPc.name+"!", self); pause;
    exec("say Thank you!", self); pause;
  }
  else exec("say Thank you, "+uPc.name+", I am always accepting donations.", self);
  goto start;
}
dilend
end
/*------ GENERIC BAARDUK GUARD ------*/
gen_guard
  names {"a baardek guard", "baardek", "guard"}
  title "a Baardek Guard"
  descr "A massive Baardek Guard is standing here, guarding things."
  level 63
  alignment 0
  race RACE_ELF
  sex SEX_MALE
  height 191
  weight 230
  money 1 SILVER_PIECE
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  special SFUN_TEAMWORK "guard/eros"
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(30, 22, 14, 22, 0, 2, 10, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 20, 10, 0, 25, 5)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,30,0,0,0,0,0)
dilbegin gen_guard();
var
  iRand   :integer;
  i_fight :integer;
code
{
  heartbeat := PULSE_SEC * 5;
  :start:
  i_fight := interrupt(SFB_COM, self.position == POSITION_FIGHTING, in_a_fight);

  iRand := rnd(1, 65);
       if(iRand == 1) walkto(findroom("keep1_6@sands2"));
       if(iRand == 1) walkto(findroom("keep2_5@sands2"));
  else if(iRand == 2) walkto(findroom("keep2_2@sands2"));
  else if(iRand == 3) walkto(findroom("keep1_4@sands2"));
  else if(iRand == 4) walkto(findroom("keep3_6@sands2"));
  else if(iRand == 5) exec("emote scratches himself.", self);
  else if(iRand == 6) exec("peer", self);
  else if(iRand == 7) exec("emote whistles to himself.",self);
  else if(iRand == 8) exec("close door",self);
  else if(iRand == 9) exec("close gate",self);
  else if(((iRand > 10) and (iRand < 18)))
  {
    exec("say Are you lost?",self);
    wait(SFB_CMD, TRUE);
    if(command(CMD_NOD))
    {
      pause;
      exec("say Silk is atop the tower, Eros is upstairs in his room, and is NOT to be bothered!", self);
      pause;
      exec("wave", self);
    }
  }
  else if(((iRand > 16) and (iRand < 19)))
  {
    walkto(findroom("gate@sands2"));
    exec("say You're relived of gate duty, lets switch!", self);
    pause;
    exec("smile", self);
    pause;
    exec("say Bye guys!", self);
    exec("wave", self);
    pause;
    exec("wave", self);
    exec("east", self);
    exec("close gate", self);
    walkto(findroom("keep3_1@sands2"));
  }
  else if(((iRand > 19) and (iRand < 22)))
  {
    iRand := rnd(1, 65);
    if(((iRand > 25) and (iRand < 35)))
    {
      walkto(findroom("keep3_1@sands2"));
      pause;
      exec("pull rope", self); pause;
      exec("get mug", self); pause;
      exec("drink beer", self);
      pause;pause;
      exec("bury mug", self);
      exec("close door", self);
      pause;pause;
      goto start;
    }
  }
  pause;pause;pause;pause;
  goto start;
 :in_a_fight:
  clear(i_fight);
  while(self.position == POSITION_FIGHTING) pause;
  goto start;
}
dilend
end
/*------ BAARDUK GUARD ------*/
guard3
  names {"a baardek guard", "baardek", "guard"}
  title "Eros' Guard"
  descr "A massive Baardek Guard is standing by the door."
  extra{}
  "The guard looks bored but aware, he is massive in size yet apears to be fast as well."
  level 65
  alignment 0
  race RACE_ELF
  sex SEX_MALE
  height 189
  weight 210
  money 1 SILVER_PIECE, 1 COPPER_PIECE
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  special SFUN_TEAMWORK "eros"
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(30, 22, 14, 19, 3, 2, 10, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 20, 10, 0, 25, 5)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,30,0,0,0,0,0)
dilbegin guard3();
var
  uPc     :unitptr;
  iFight  :integer;
code
{
  heartbeat:=PULSE_SEC*3;
 :start:
  iFight := interrupt(SFB_COM, self.position == POSITION_FIGHTING, in_a_fight);
  if(self.outside != findroom("bedroom2@sands2"))
  {
    walkto(findroom("bedroom2@sands2"));
    exec("emote takes his position by the door.", self);
  }
  wait (SFB_CMD, ((command(CMD_SOUTH)) and (activator.type == UNIT_ST_PC)));
  uPc := activator;
  if(uPc.level > 45)
  {
    block;
    exec("say You are too great a threat, begone "+uPc.name+"!", self);
  }
  else exec("say You may pass, but you had best have business with Eros, "+uPc.name+"..", self);
  goto start;
 :in_a_fight:
  clear(iFight);
  exec("say I must protect the master of the Keep!", self);
  while(self.position == POSITION_FIGHTING) pause;
  goto start;
}
dilend
end
/*------ BAARDUK GUARD ------*/
guard1
  names {"a baardek guard", "baardek", "guard"}
  title "a Baardek Guard"
  descr "A massive Baardek Guard is standing on the left side of the gate."
  extra{}
  "The guard looks bored but aware, he is massive in size yet apears to be fast as well."
  level 69
  alignment 0
  race RACE_ELF
  sex SEX_MALE
  height 188
  weight 210
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  money 1 COPPER_PIECE
  special SFUN_TEAMWORK "guard"
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(30, 22, 14, 19, 3, 2, 10, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 20, 10, 0, 25, 5)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,30,0,0,0,0,0)
dilbegin guard();
var
  pc      :unitptr;
  swrdo   :unitptr;
  i_fight :integer;
  i_got   :extraptr;
code
{
  heartbeat := PULSE_SEC * 3;
  addextra(self.quests, {SILK_DONE}, "");
:start:
  i_fight := interrupt(SFB_COM, self.position == POSITION_FIGHTING, in_a_fight);
  if(self.outside != findroom("gate@sands2"))
  {
    walkto(findroom("gate@sands2"));
    exec("emote takes his position at the gate.", self);
  }
  wait(SFB_CMD, (activator.type == UNIT_ST_PC));
  pc := activator;
  secure(pc,lost);
:ishere:
  pause; pause;
  if(SILK_DONE in pc.quests)
  {
    pause;
    if(not (findunit(pc, "thanatos", FIND_UNIT_IN_ME, null)))
    {
      exec("say "+pc.name+"!", self);pause;
      exec("say Are you here for Grishalmus' invention?", self);
     :wait_1:
      wait(SFB_CMD, activator == pc);
      if(command(CMD_SHAKE)) goto nopers;
      else if(command(CMD_NOD))
      {
        i_got := SILK_DONE in pc.quests;
        if("Got Thanatos" in i_got.names)
        {
          exec("say Well, I've already given you one.", self);pause;
          pause;pause;pause;
          goto start;
        }
        exec("say Good, here it is.", self);
        pause;
        exec("emote unwraps a large package that was sitting behind him.", self);
        pause;
        swrdo:=load("thanatos@sands2");
        act("$2n gives you $3n.", A_SOMEONE, pc, self, swrdo, TO_CHAR);
        act("$2n gives $1n $3n.", A_SOMEONE, pc, self, swrdo, TO_REST);
        link(swrdo, pc);
        i_got := SILK_DONE in pc.quests;
        addstring(i_got.names, "Got Thanatos");
        pause;
        exec("smile "+pc.name, self);
        pause;
        exec("emote returns to his duties.", self);
        while(pc.outside == self.outside) pause;
        goto start;
      }
      else
      {
        pause;
        exec("Please answer with a shake or nod of your head!", self);
        goto wait_1;
      }
    }
  }
  exec("say Turn away if you have no business here with Silk or Eros!", self);
  while(pc.outside == self.outside) pause;
  goto start;
:lost:
  unsecure(pc);
  goto start;
:nopers:
  pause;
  exec("say Fine then.", self);
  pause;
  exec("say Be on your way, return when you are ready, "+pc.name+".", self);
  pause;
  exec("wave "+pc.name, self);
  while(pc.outside == self.outside) pause;
  goto start;
 :in_a_fight:
  clear(i_fight);
  while(self.position == POSITION_FIGHTING) pause;
  goto start;
}
dilend
end
/*------ BAARDUK GUARD 2 ------*/
guard2
  names {"a baardek guard", "baardek", "guard"}
  title "a Baardek Guard"
  descr "A massive Baardek Guard is standing on the right side of the gate."
  extra{}
  "The guard looks bored but aware, he is massive in size yet appears to be fast as well."
  level 65
  alignment 0
  race RACE_ELF
  sex SEX_MALE
  height 190
  weight 201
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  money 2 SILVER_PIECE
  special SFUN_TEAMWORK "guard"
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(30, 22, 14, 19, 3, 2, 10, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 20, 10, 0, 25, 5)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,30,0,0,0,0,0)
dilbegin guard2();
code
{
  heartbeat:=PULSE_SEC*3;
  :start:
  wait(SFB_DONE, command(CMD_EAST));
  exec("close gate", self);
  goto start;
}
dilend
end
/*------ FUR TRADER ------*/
trader
  names {"a baardek trader", "trader", "man"}
  title "a Baardek Trader"
  descr "A Baardek Fur Trader is here looking to sell."
  extra{}
  "The fur trader looks bored but aware, he is obviously tired from wandering Valhalla."
  level 39
  alignment 0
  race RACE_ELF
  sex SEX_MALE
  height 188
  weight 201
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  special SFUN_TEAMWORK "guard"
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(30, 22, 14, 22, 0, 2, 10, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 30, 0, 0, 25, 5)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,30,0,0,0,0,0)
  special SFUN_RANDOM_GLOBAL_MOVE
    special SFUN_SHOP_INIT
    "Profit sell = 130
    Profit buy = 10
    Production = ~fur@sands2~ ~pelt@sands2~ ~coat@sands2~ ~undies@sands2~
    Msg1 = ~$1n says, 'I've no such item, you git!'~
    Msg2 = ~$1n says, 'Please get with the program $3n?'~
    Msg3 = ~$1n says, 'Furs for sale, prepared by the Cheleho!'~
    Msg4 = ~$1n says, 'Hah!'~
    Msg5 = ~$1n says, '$3n, you're poor, get lost!'~
    Msg6 = ~$1n says, 'That's %s for $2n'~
    Msg7 = ~$1n says, '%s for $2n.'~
    Hours1 = 0 24
    Hours2 = 0 24"
dilbegin trader();
code
{
  heartbeat := PULSE_SEC * 60;
 :start:
  if(rnd(1, 50) == 2)
  {
    walkto(findroom("basement3@sands2"));
    exec("emote gets some more finished clothing from the table.", self);
    walkto(findroom("square@udgaard"));
  }
  pause;
  goto start;
}
dilend
end
/*------ SAMPHORE ------*/
samphore
  names {"samphore","man", "slavemaster" }
  title "Samphore"
  descr "Samphore, the master of Baardek Slaves is here."
  extra{}
  "As head of slaves Samphore is a hardened and uncaring man who is not afraid
  to flog those that misbehave, you had best be careful."
  level 69
  alignment -200
  race RACE_ELF
  sex SEX_MALE
  height 180
  weight 141
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  money 2 GOLD_PIECE
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(20, 22, 22, 24, 10, 2, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 20, 20, 0, 5, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,0,30,0,0,0,0)
dilbegin samphore();
var
  iRand   :integer;
  iFight  :integer;
code
{
  heartbeat:=PULSE_SEC * 5;
 :start:
  iFight:=interrupt(SFB_COM, self.position == POSITION_FIGHTING, in_a_fight);
  iRand:=rnd(1, 50);
       if(iRand == 1) exec("emote mubles about slaves and fur production.", self);
  else if(iRand == 2) exec("say Slaves! Get to work!", self);
  else if(iRand == 3) exec("emote checks his notepad and eyes the slaves.", self);
  else if(iRand == 4) exec("say Odin strike down Silk and her impossible deadlines", self);
  else if(iRand == 5) exec("emote mubles about fur production.", self);
  else if(iRand == 6) exec("close door", self);
  pause; pause;
  goto start;
 :in_a_fight:
  clear(iFight);
  exec("say Oh, I have no time for this!!", self);pause;
  exec("say You will pay!", self);pause;
  while(self.position == POSITION_FIGHTING) pause;
  goto start;
}
dilend
end
/*------ MASHKEE ------*/
mashkee
  names {"mashkee","man", "brewer" }
  title "Mashkee"
  descr "Mashkee, The Baardekan brewer is standing here."
  extra{}
  "Mashkee is one of the chosen who's job it is to make life a little better.
  He is quite famous for the tasty Baardek Beer's that he makes, and is
  under the charge of Eros to make it often.."
  level 65
  alignment 1000
  race RACE_ELF
  sex SEX_MALE
  height 175
  weight 131
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  money 2 GOLD_PIECE
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(10, 32, 32, 24, 0, 2, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 40, 0, 0, 5, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,0,30,0,0,0,0)
dilbegin mashkee();
var
  iRand   :integer;
  iFight  :integer;
code
{
  heartbeat:=PULSE_SEC * 3;
 :start:
  iFight:=interrupt(SFB_COM, self.position == POSITION_FIGHTING, in_a_fight);
  iRand:=rnd(1, 40);
       if(iRand == 1) exec("emote tinkers with his equipment.", self);
  else if(iRand == 2) exec("say Hmmm, needs a bit more bite.", self);
  else if(iRand == 3)
  {
    exec("drink keg", self); pause;
    exec("say Ahhhhhhh", self);
  }
  else if(iRand == 4) exec("say Beer, beer, beer, beer.", self);
  else if(iRand == 5) exec("emote stirs some nutmeg into a mug.", self);
  else if(iRand == 6) exec("emote sings a ballad about beer.", self);
  else if(iRand == 7)
  {
    exec("emote stumbles about a bit", self); pause;
    exec("say Ooh, I think I need another..", self);pause;
    exec("drink keg", self); pause;
    exec("burp", self);
  }
  else if(iRand == 8) exec("hic", self);
  else if(iRand == 9) exec("emote passes out for a minute, then wakes looking refreshed.", self);
  pause; pause;
  goto start;
 :in_a_fight:
  clear(iFight);
  exec("say Oh, I have no time for this!!", self);pause;
  exec("shout Help!! "+self.fighting.name+" doesn't like beer!!", self);pause;
  while(self.position == POSITION_FIGHTING) pause;
  goto start;
}
dilend
end
/*------ GRISHALMUS ------*/
grishalmus
  names {"grishalmus","man", "inventor" }
  title "Grishalmus"
  descr "Grishalmus, Baardek's sole inventor is standing here."
  extra{}
  "Grishalmus is the head, and only inventor for the Baardek spies, from the frustrated grunts he is making you think he may be unsuccessful."
  level 65
  alignment -200
  race RACE_ELF
  sex SEX_MALE
  height 180
  weight 131
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  money 2 GOLD_PIECE
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(10, 32, 32, 24, 0, 2, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 40, 0, 0, 5, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,0,30,0,0,0,0)
dilbegin grishalmus();
var
  iRand   :integer;
  iFight  :integer;
  pc      :unitptr;
  swrdo   :unitptr;
  iInterr :integer;
code
{
  heartbeat:=PULSE_SEC *4;
  on_activation(self.position == POSITION_FIGHTING, ina_fight);
:start:
  iFight :=interrupt(SFB_COM, self.position==POSITION_FIGHTING, ina_fight);
  iInterr:=interrupt(SFB_CMD, activator.type == UNIT_ST_PC, not_alone);
  iRand:=rnd(1, 40);
       if(iRand == 1) exec("emote tinkers with some invention.", self);
  else if(iRand == 2) exec("say I could have been hired at the research lab,  it's just descrimination I tell you.", self);
  else if(iRand == 3) exec("emote checks a notepad.", self);
  else if(iRand == 4) exec("say Make me this, make me that, it's all I hear.", self);
  else if(iRand == 5) exec("emote plays with a sword.", self);
  else if(iRand == 6) exec("emote mumbles something about messy neighbors.", self);
  else if(iRand == 7) exec("close door", self);
  clear(iRand);
  pause;
  goto start;
 :not_alone:
  clear(iInterr);
  pc := activator;
  secure(pc, lostpc);
  if(BRING_SHIT_TO_GRISHALMUS in pc.quests)
  {
    pause;
    exec("say Have you brought me what you were told to, "+pc.name+"?", self);
   :wait_3:
    wait(SFB_DONE, activator == pc);
    if(command(CMD_NOD))
    {
      pause;
      exec("say Give it to me.", self);
      wait(SFB_DONE, ((command(CMD_GIVE)) and (target == self)));
      swrdo:=findunit(self, "long sword", FIND_UNIT_IN_ME, null);
      if(swrdo != null)
      {
        exec("say Thank you "+pc.name+".", self);
        pause;pause;
        exec("emote looks at the sword.", self);
        pause;pause;
        exec("scratch", self);
        pause;pause;
        destroy(swrdo);
        exec("say When you leave, stop by the gate. The guard will have your reward, exactly what I am making now.", self);
        addextra(pc.quests, {SILK_DONE}, "");
        subextra(pc.quests, BRING_SHIT_TO_GRISHALMUS);
        pause;
        exec("wave", self);
        pause; pause; pause; pause; pause; pause;
        goto start;
      }
    }
    else if(command(CMD_SHAKE))
    {
      exec("say Well bring it soon!", self);
      pause; pause; pause; pause; pause; pause;
      goto start;
    }
    else
    {
      exec("say Please nod or shake your head "+pc.name, self);
      goto wait_3;
    }
  }
goto start;
:ina_fight:
  clear(iFight);
  clear(iInterr);
  exec("say You dare attack me, I am an Inventor!", self);
  while(self.position==POSITION_FIGHTING) pause;
  goto start;
:lostpc:
  pc := null;
  unsecure(pc);
  pause;
  goto start;
}
dilend
end
/*------ SILK ------*/
silk
  names {"silk","spy", "mother", "woman" }
  title "Silk"
  descr "Silk, spymaster and mother of lies is standing here."
  extra{}
  "Silk is the head of all Baardek spies in Valhalla, her eyes never rest.
  She would be beautiful with her flowing blonde hair, deep blue eyes, and
  ample bossom, but her tounge slides over her lips every few seconds and
  you know she wouldn't hesitate to kill you for a bit of iinformation."
  level 75
  alignment -200
  race RACE_ELF
  sex SEX_FEMALE
  height 180
  weight 111
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  money 2 GOLD_PIECE
  special SFUN_HIDEAWAY
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(10, 32, 32, 24, 0, 2, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 40, 0, 0, 5, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,0,30,0,0,0,0)
dilbegin silk();
var
  iRand   :integer;
  iFight  :integer;
  pc      :unitptr;
code
{
  heartbeat:=PULSE_SEC *3;
  on_activation(self.position == POSITION_FIGHTING, ina_fight);
  pc := null;
:start:
  iFight:=interrupt(SFB_COM, self.position==POSITION_FIGHTING, ina_fight);
  if(self.outside!=findroom("silk_tower@sands2")) walkto(findroom("silk_tower@sands2"));
  wait(SFB_DONE, (activator.type == UNIT_ST_PC));
  pc := activator;
  secure(pc, lostpc);
  if((command(CMD_GIVE)) and (target == self))
  {
    exec("give "+medium.name+" "+pc.name, self);
    exec("drop "+medium.name, self);
    exec("say There is a time for everything "+pc.name+".", self);
  }
  if(GET_NOTES_FOR_SILK in pc.quests) goto notes_get_em;
  if(SILK_DONE in pc.quests) goto already_done;
  if(BRING_SHIT_TO_GRISHALMUS in pc.quests) goto looking_for_grish;
/*------ Give Quest ------*/
:give_quest:
  pause;pause;
  exec("cough", self);
  pause;
  act("Silk looks you over in an evaluating manner.",A_SOMEONE, pc, null, null, TO_CHAR);
  act("Silk looks $1n over in an evaluating manner.",A_SOMEONE, pc, null, null, TO_REST);
  pause;
  if(pc.sex == SEX_MALE) exec("say Well hello young man, are you some great adventurer?", self);
  if(pc.sex == SEX_FEMALE) exec("say Well hello young lady, are you some great adventurette?", self);
  :wait_1:
  wait(SFB_DONE, activator == pc);
  if(command(CMD_SHAKE)) goto drop_quest;
  else if(command(CMD_NOD))
  {
    pause;
    exec("say You are, are you "+pc.name+"? Well let me tell you a little something then.", self);
    pause;
    exec("say We in this keep are not great adventurers.", self);
    pause;
    exec("say We are masters of subterfuge.", self);
    pause;
    exec("scratch", self);
    pause;
    exec("say Because we lack the agents right now, I suppose I could use you.", self);
    pause;
    exec("say Will you run an errand for me?", self);
   :wait1:
    wait(SFB_DONE, activator == pc);
    if(command(CMD_SHAKE)) goto drop_quest;
    else if(command(CMD_NOD))
    {
      pause;
      exec("say Fine, good, there is a research lab south of Midgaard.", self);
      pause;
      exec("emote sneers at the very mention of Midgaard.", self);
      pause;
      exec("say Go there "+pc.name+", and find a man named Mahrnak, he is an inventor at the lab.", self);
      pause;
      exec("say We have discovered what he is working on, yet he refuses to hand over his notes.", self);
      pause;
      exec("say You can bring me his notes, take whatever steps are necesarry to get them.", self);
      addextra(pc.quests, {GET_NOTES_FOR_SILK}, "");
      pause;
      exec("say Go now, before I kill you for sport!", self);
      pause;
      act("Silk waves you off and turns her attentions.",A_SOMEONE, pc, null, null, TO_CHAR);
      act("Silk waves $1n off and turns her attentions.",A_SOMEONE, pc, null, null, TO_REST);
      pause; pause; pause; pause;
      goto start;
    }
    else
    {
      exec("say "+pc.name+", answer with a nod or shake of your head!", self);
      goto wait1;
    }
  }
  else
  {
    pause;
    exec("say Answer with a nod or shake of your head, "+pc.name+".", self);
    pause;
    goto wait_1;
  }
/*------ Already Done ------*/
:already_done:
  pause;
  exec("whisper "+pc.name+" Fine weapon the Thanatos is, I hope you are enjoying it.", self);
  pause;
  exec("whisper "+pc.name+" Perhaps someday you will be good enough to work for us.", self);
  pause; pause; pause;
      pause; pause; pause; pause;
  goto start;
/*------ Grishalmus Hunting ------*/
:looking_for_grish:
  pause;
  exec("say You are sill seeking Grishalmus, "+pc.name+"?", self);
  pause;
  exec("say Perhaps you have forgotten where Udgaard is.", self);
  pause;
  exec("say Go now "+pc.name+", we have wasted enough time!", self);
  pause; pause; pause;
      pause; pause; pause; pause;
  goto start;
/*------ Drop Quest ------*/
:drop_quest:
  pause;
  exec("emote slowly raises her middle finger, and her face grows dark.", self);
  pause;
  exec("say Begone then! Before I call the guards!", self);
  pause;
  exec("say Return to me when you are ready!", self);
  pc:=null;
  pause;pause;pause;
      pause; pause; pause; pause;
  goto start;
/*------ Still Getting or Got Notes ------*/
:notes_get_em:
  pause;
  exec("say Well, "+pc.name+" have you brought me those notes?", self);
  :wait_2:
  wait(SFB_DONE, activator == pc);
  if(command(CMD_SHAKE)) goto drop_quest;
  else if(command(CMD_NOD))
  {
    pause;
    exec("say Well, can I have them.. Or are you going to stand there waiting for Saerimner the pig to fall from the sky?", self);
    wait(SFB_DONE, ((command(CMD_GIVE)) and (target == self)));
    if(medium.name == "mahrnak's notes")
    {
      destroy(medium);
      pause;pause;
      exec("say Thank you "+pc.name+", you are a faithful servant. Let me look these over.", self);
      pause;pause;
      exec("emote looks at the notes.", self);
      pause;pause;
      exec("scratch", self);
      pause;pause;
      exec("ponder", self);
      pause; pause;
      exec("say Aha! That's it!", self);
      pause; pause;
      exec("say "+pc.name+", you are still here, waiting for your reward no doubt.", self);
      pause;
      exec("say It seems we have been close to developing on our own, what you have stolen the notes for!", self);
      pause;
      exec("say Gather for us a long sword, one of Arny's is fine, and bring it to Grishalmus downstairs.", self);
      pause;
      exec("say Then you will recieve your reward.", self);
      addextra(pc.quests, {BRING_SHIT_TO_GRISHALMUS}, "");
      subextra(pc.quests, GET_NOTES_FOR_SILK);
      pause;
      exec("say Go now, before I eat your spleen!", self);
      pause;
      act("Silk waves you off and turns her attentions.",A_SOMEONE, pc, null, null, TO_CHAR);
      act("Silk waves $1n off and turns her attentions.",A_SOMEONE, pc, null, null, TO_REST);
      pause;pause;pause;
      pause; pause; pause; pause;
      goto start;
    }
    else
    {
      pause;
      exec("say Thank you "+pc.name+", I will treasure it always!", self);
      pause;
      exec("smile", self);
      pc:=null;
      pause; pause;
      pause; pause; pause; pause;
      goto notes_get_em;
    }
  }
  else
  {
    pause;
    exec("say Answer with a nod or shake of your head, "+pc.name+".", self);
    exec("give notes "+pc.name, self);
    exec("drop notes", self);
    pause;
    goto wait_2;
  }
:ina_fight:
  clear(iFight);
  exec("say You dare attack me!", self);
  while(self.position==POSITION_FIGHTING) pause;
  exec("get all from corpse", self);
  exec("rem all", self);
  exec("wear all", self);
  exec("moohaha", self);
  goto start;
:lostpc:
  unsecure(pc);
  pc := null;
  pause;
  goto start;
}
dilend
end
/*------ MAHRNAK ------*/
mahrnak
  names {"mahrnak", "inventor", "man"}
  title "Mahrnak"
  descr "Mahrnak the inventor is inventing here."
  extra{}
  "Mahrnak is a slightly disoriented looking individual, he seems pretty swept up in his work, you get the feeling he is not much of a people person."
  level 35
  alignment 100
  race RACE_HUMAN
  sex SEX_MALE
  height 182
  weight 150
  NATURAL_DEF(WPN_FIST, ARM_LEATHER)
  money 2 SILVER_PIECE
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(25, 10, 15, 25, 15, 5, 5, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(20, 10, 20, 10, 10, 10)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,0,20,0,0,0,0)
dilbegin mahrnak();
var
  iRand   :integer;
  iFight  :integer;
code
{
  heartbeat:=PULSE_SEC*5;
  on_activation(self.position == POSITION_FIGHTING, in_a_fight);
:start:
  iFight:=interrupt(SFB_COM, self.position == POSITION_FIGHTING, in_a_fight);
  if(self.outside!=findroom("annex_101@reslab")) walkto(findroom("annex_101@reslab"));
  iRand:=rnd(1,41);
       if(iRand ==1) exec("emote tinkers with a few notes.", self);
  else if(iRand ==2) exec("say Hmmm, close now.. I know it.", self);
  else if(iRand ==3) exec("emote wonders what a Spare Mary is doing later.", self);
  else if(iRand ==4) exec("grin", self);
  else if(iRand ==5)
  {
    exec("say So one notch here..then one here..", self);
    pause;
    exec("scratch", self);
    pause;
    exec("Yes, there!", self);
  }
  else if(iRand ==6) exec("emote scratches something off his notes, then puts it back.", self);
  else if(iRand ==7) exec("emote scribbles something on a piece of paper.", self);
  else if(iRand ==8)
  {
    exec("say Mmmm, thristy..", self);
    pause;
    walkto(findroom("hall_103@reslab"));
    pause;
    exec("drink fountain", self);
    pause;
    exec("say Ahhhh, tasty!", self);
    pause;
    walkto(findroom("annex_101@reslab"));
  }
  pause; pause;
  goto start;
:in_a_fight:
  clear(iFight);
  exec("say Now, you die!", self);
  exec("say Interrupt my work, I will teach you!", self);
  while(self.position == POSITION_FIGHTING) pause;
  goto start;
}
dilend
end
/*------ SPY ------*/
spy
  names {"baardekan spy", "spy", "man"}
  title "a Spy"
  descr "A Baardekan spy is here, gathering information."
  extra{}
  "He is a dark and shady individual, you look at him for a long
  time but can't seem to commit his image to your memory."
  level 59
  alignment -200
  race RACE_ELF
  sex SEX_MALE
  height 185
  money 2 SILVER_PIECE
  weight 121
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  special SFUN_HIDEAWAY
  special SFUN_AGGRESSIVE "$1n covers $1s work, gasps, and attacks $3N!" time 35 bits SFB_RANTIME
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(10, 32, 32, 24, 0, 2, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 40, 0, 0, 5, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,0,30,0,0,0,0)
dilbegin spy();
code
{
  heartbeat := PULSE_SEC * 4;
  :start:
  while(rnd(1, 100) != 10) pause;
  exec("emote jots something down in his notebook.", self);
  goto start;
}
dilend
end
/*------ SLAVE COOK ------*/
slave_cook
  names {"shlemierre", "slave", "man", "cook"}
  title "Shlemierre"
  descr "Shlemierre the slave cook is standing here."
  extra{}
  "Shlemierre is round and jolly, an instant character and an amazing one at that, he seems to live care free even with his tyrannical masters."
  level 61
  alignment 800
  money 1 COPPER_PIECE
  race RACE_HUMAN
  sex SEX_MALE
  height 170
  weight 210
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  exp 75
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(20, 2, 32, 24, 0, 22, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 0, 0, 10, 35, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,10,20,0,0,0,0)
dilbegin shlemierre();
var
  iRand  :integer;
  iFight :integer;
code
{
  heartbeat:=PULSE_SEC *4;
  on_activation(self.position == POSITION_FIGHTING, ina_fight);

:start:
  iFight:=interrupt(SFB_COM, self.position==POSITION_FIGHTING, ina_fight);
  pause;
  clear(iRand);
  iRand:=rnd(1, 60);
       if (iRand == 2) exec("say I like the croissant", self);
  else if (iRand == 3) exec("grin", self);
  else if (iRand == 4) exec("emote sings in a raspy voice.", self);
  else if (iRand == 5) exec("say I like to make da food, yup yup!", self);
  else if (iRand == 6) exec("sigh.", self);
  else if (iRand == 7) exec("emote plans the next meal for Baardekan big-wigs.", self);
  else if (iRand == 8) exec("emote laughs a jolly laugh.", self);
  pause; pause;
  goto start;
:ina_fight:
  clear(iFight);
  exec("say En Garde!", self);
  exec("emote performs a jolly little dance as he prepares to fight.", self);
  while(self.position == POSITION_FIGHTING)
  {
    iRand:=rnd(1,10);
    if(iRand == 2)
    {
      exec("say En Flambe!", self);
      cast_spell( SPL_FIREBALL_1, self, self, self.fighting );
      pause;pause;
    }
    if(iRand == 4)
    {
      exec("say En Frigidaire!", self);
      cast_spell( SPL_FROSTBALL_1, self, self, self.fighting );
      pause;pause;
    }
  }
  goto start;
}
dilend
end
/*------ FUR SLAVE ------*/
fur_slave
  names {"fur slave", "slave"}
  title "a fur processer"
  descr "A fur processing slave is here working diligently."
  extra{}
  "This slave is obviously of Cheleho heritage, he is busy working on
  turning the fur of animals into useful clothing. It seems this job
  requires strength because he is bigger than the slaves that run around
  the keep."
  level 58
  money 2 IRON_PIECE
  alignment 800
  race RACE_HUMAN
  sex SEX_MALE
  height 181
  weight 160
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(30, 2, 12, 34, 0, 22, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 0, 0, 10, 35, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,10,20,0,0,0,0)
dilbegin fur_slave();
var
  iRand   :integer;
code
{
  heartbeat:=PULSE_SEC * 6;
 :start:
  iRand:=rnd(1, 40);
       if(iRand == 1) exec("emote grabs a pelt from a stack.", self);
  else if(iRand == 2) exec("emote quietly grumbles about his work.", self);
  else if(iRand == 3) exec("emote yanks and pulls at a tough piece of fur.", self);
  else if(iRand == 4) exec("say One day I will return to my cliff top home.", self);
  else if(iRand == 5) exec("emote slides a dull knife over a pelt.", self);
  pause; pause; pause;
  clear(iRand);
  goto start;
}
dilend
end
/*------ SLAVE MAN ------*/
slave_man
  names {"a slave","man","slave"}
  title "a slave"
  descr "An enslaved Cheleho Tribesman is here, tooling about nervously."
  extra{}
  "The slave is running around as fast as he can for fear of his Baardekan masters and their Pit."
  level 59
  alignment 800
  money 3 IRON_PIECE
  race RACE_HUMAN
  sex SEX_MALE
  height 185
  weight 140
  exp 45
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  special SFUN_RANDOM_ZONE_MOVE
  dilcopy slave@sands2();
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(20, 22, 32, 24, 0, 2, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 0, 0, 10, 35, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,0,30,0,0,0,0)
end
/*------ SLAVE BOY ------*/
slave_boy
  names {"slaveboy","boy","slave"}
  title "a slave boy"
  descr "An enslaved Cheleho boy is here, looking frightened yet brave."
  extra{}
  "The slave is running around as fast as he can for fear of his Baardekan masters and their Pit."
  level 58
  alignment 800
  race RACE_HUMAN
  sex SEX_MALE
  height 175
  weight 125
  exp 40
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  special SFUN_RANDOM_ZONE_MOVE
  dilcopy slave@sands2();
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(20, 22, 22, 24, 0, 12, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 0, 0, 20, 25, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,0,30,0,0,0,0)
end
/*------ SLAVE GIRL ------*/
slave_girl
  names {"slavegirl","girl","slave"}
  title "a slave girl"
  descr "A young enslaved Cheleho girl is here, trying not get trampled."
  extra{}
  "The slave is running around as fast as she can for fear of her Baardekan masters and their Pit."
  level 56
  alignment 800
  race RACE_HUMAN
  exp 40
  sex SEX_FEMALE
  height 165
  weight 95
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  special SFUN_RANDOM_ZONE_MOVE
  dilcopy slave@sands2();
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(8, 22, 32, 24, 12, 2, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 0, 0, 20, 25, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,0,30,0,0,0,0)
end
/*------ CUTE SLAVE WOMAN ------*/
cute_slave
  names {"a beutiful slave","slavewoman","woman","slave"}
  title "a beutiful slave woman"
  descr "A very attractive slave woman is cowering on the bed."
  extra{}
  "This cheleho slave is the proud owner of outrageously large breasts and thin hips
   it is no wonder that Eros keeps her here for his own pleasure."
  level 56
  alignment 800
  race RACE_HUMAN
  sex SEX_FEMALE
  exp 45
  height 164
  weight 100
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(10, 22, 32, 24, 0, 12, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 0, 0, 20, 25, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,0,30,0,0,0,0)
end
/*------ SLAVE WOMAN ------*/
slave_woman
  names {"a slavewoman","slavewoman","woman","slave"}
  title "a slave woman"
  descr "An enslaved Cheleho Tribeswoman is here, keeping busy."
  extra{}
  "The slave is running around as fast as she can for fear of her Baardekan masters and their Pit."
  level 57
  alignment 800
  race RACE_HUMAN
  sex SEX_FEMALE
  exp 45
  height 160
  weight 110
  money 1 IRON_PIECE
  NATURAL_DEF(WPN_FIST, ARM_CLOTHES)
  special SFUN_RANDOM_ZONE_MOVE
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(10, 22, 32, 24, 0, 12, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 0, 0, 20, 25, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,0,30,0,0,0,0)
dilbegin slave();
var
  iCount  :integer;
  iRand   :integer;
code
{
  heartbeat:=PULSE_SEC*5;
  :start:
  if(rnd(1, 100) == 2)
  {
    walkto(findroom("keep1_4@sands2"));
    exec("get mop", self);
    iRand:=rnd(1,5);
         if(iRand == 1) walkto(findroom("keep1_1@sands2"));
    else if(iRand == 2) walkto(findroom("keep3_1@sands2"));
    else if(iRand == 3) walkto(findroom("keep1_3@sands2"));
    else if(iRand == 4) walkto(findroom("keep3_3@sands2"));
    exec("hold mop", self); pause;
    exec("emote mops the floor.", self); pause;
    exec("emote rings out the mop.", self); pause;
    exec("emote mops the floor.", self); pause;
    exec("rem mop", self); pause; pause;
    walkto(findroom("keep1_4@sands2"));
    exec("drop mop", self); pause;
    exec("open door", self); pause;
    exec("east", self); pause;
    exec("close door", self); pause; pause;
  }
  if(rnd(1, 50) == 2)
  {
    walkto(findroom("kitchen@sands2"));
    iCount :=0;
    :Count:
    if(iCount < 6)
    {
      iRand:=rnd(1,20);
           if(iRand == 1) exec("emote helps with a heavy roast.", self);
      else if(iRand == 2)
      {
        exec("emote grabs a tray and quickly leaves.", self);
        exec("flee", self);
      }
      else if(iRand == 3) exec("emote picks up a plate and scrapes the food left on it", self);
      else if(iRand == 4) exec("emote slacks off in a corner.", self);
      else if(iRand == 5) exec("emote hums a little tune and throws a shrimp on the barbie.", self);
      else if(iRand == 6) exec("emote kneeds some dough.", self);
      else if(iRand == 7)
      {
        exec("emote slices an onion.", self);
        pause;
        exec("cry", self);
      }
      else if(iRand == 8) exec("emote sautees a mushroom.", self);
      else if(iRand == 9) exec("emote sticks a long dirty finger into a pie and has a taste.", self);
      else if(iRand == 10) exec("emote talks to some food.", self);
    }
    iCount := iCount +1;
    pause; pause;
    goto Count;
  }
  if(rnd(1, 20) == 2)
  {
    exec("close door",self);
    exec("close gate",self);
  }
  goto start;
}
dilend
end
/*------ MINOR BLOOD ------*/
minorblood
  names {"a small blood demon","blood demon", "demon", "blood"}
  title "a Small Blood Demon"
  descr "&c+rA Small Blood Demon is here, slobbering on the floor.&cw"
  extra{}
  "This Demon comes from the changes of &c+gRevolution&cw, when blood becomes beast."
  level 35
  alignment 0
  race RACE_LESSER_DEMON
  sex SEX_MALE
  height 170
  weight 120
  NATURAL_DEF(WPN_CLAW, ARM_CLOTHES)
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(30, 12, 12, 24, 0, 12, 0, 10)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 0, 10, 10, 25, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,0,30,0,0,0,0)
dilbegin demon();
var
  iFlag :integer;
  iRand :integer;
  bld   :unitptr;
code
{
  heartbeat := PULSE_SEC*3;
  iFlag := 0;
  iRand := rnd(10,25);
  :start:
  wait(SFB_TICK, TRUE);
  iFlag:= iFlag + 1;
  if(iFlag > iRand)
  {
    clear(iFlag);
    clear(iRand);
    exec("emote disappears into a pool of blood!", self);
    bld := load("blood_puddle@sands2");
    link(bld, self.outside);
    destroy(self);
  }
  else goto start;
}
dilend
end
/*------ MID BLOOD ------*/
midblood
  names {"a blood demon", "blood demon","demon", "blood"}
  title "a Blood Demon"
  descr "&c+rA Blood Demon is here slobbering on the floor.&cw"
  extra{}
  "This Demon comes from the changes of &c+gRevolution&cw, when blood becomes beast."
  level 45
  alignment 0
  race RACE_LESSER_DEMON
  sex SEX_MALE
  height 190
  weight 160
  NATURAL_DEF(WPN_STING, ARM_LEATHER)
  dilcopy demon@sands2();
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(35, 27, 12, 4, 0, 12, 5, 5)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 0, 0, 10, 35, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,0,30,0,0,0,0)
end
/*------ MAJOR BLOOD ------*/
majorblood
  names {"a huge blood demon","blood demon", "demon", "blood"}
  title "a Huge Blood Demon"
  descr "&c+rA Huge Blood Demon is here slobbering on the floor.&cw"
  extra{}
  "This Demon comes from the changes of &c+gRevolution&cw, when blood becomes beast."
  level 55
  alignment 0
  race RACE_LESSER_DEMON
  sex SEX_MALE
  height 200
  weight 220
  NATURAL_DEF(WPN_CRUSH, ARM_HLEATHER)
  dilcopy demon@sands2();
  /*(str,dex,con,hpp,bra,cha,mag,div)*/
  MSET_ABILITY(45, 37, 12, 4, 0, 2, 0, 0)
  /*(axe_ham, sword, club_mace, flail_pole, unarmed, special)*/
  MSET_WEAPON(10, 0, 0, 0, 45, 15)
  /*(div, pro, det, sum, cre, min, hea, col, cel, int, ext) */
  MSET_SPELL(0,0,0,0,0,0,30,0,0,0,0)
end
/*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*/
/*-=-=-=-=-=-=-=-=-=-=-= Objects -=-=-=-=-=-=-=-=-=-=-=-=-=*/
/*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*/
%objects
blood_puddle
  names{"a pool of blood", "pool", "blood"}
  title "&c+ra pool of blood&cw"
  descr "&c+rA pool of blood flows over the ground here.&cw"
  extra{}
  "It is a crimson pool of lifesblood, not too useful but hey."
  weight 1
  LIQ_DEF(LIQ_BLOOD, 1, 100, 100, 15)
dilbegin blood_puddle();
var
  count :integer;
code
{
  heartbeat:= PULSE_SEC *3;
  count := 0;
 :start:
  wait(SFB_TICK, TRUE);
  count := count + 1;
  if(count > 45)
  {
    act("$1n &c+rseeps into the ground.&cw", A_ALWAYS, self, null, null, TO_REST);
    destroy(self);
    quit;
  }
  goto start;
}
dilend
end
/*---- WRINKLED ROBE ----*/
wiz_robe
  names{"a wrinkled green robe", "robe"}
  title "a wrinkled green robe"
  descr "A very old, tattered, green robe is crumpled up on the ground."
  extra{}
  "This robe has seen its fair share of use yet it seems to glimmer with
  an unidentifiable touch of light."
  flags {UNIT_FL_MAGIC}
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_ABOUT}
  weight 1
  cost 1 GOLD_PIECE
  rent 2 SILVER_PIECE, 1 COPPER_PIECE
  MATERIAL_CLOTH("A dull green cloth")
  BRA_TRANSFER(+1)
  CON_TRANSFER(+1)
  dilcopy level_restrict@function (25,0,0,"");
  dilcopy abi_restrict@function (ABIL_BRA,40,0,0,"");
end
/*---- FUNNY HAT ----*/
funny_hat
  names{"a pointed hat", "hat"}
  title "a funny pointed hat"
  descr "A funny pointed green hat is stranded here."
  extra{}
  "This hat has seen its fair share of use yet it seems to glimmer with
  an unidentifiable touch of light."
  flags {UNIT_FL_MAGIC}
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_HEAD}
  weight 1
  cost 1 GOLD_PIECE
  rent 1 SILVER_PIECE, 2 COPPER_PIECE
  MATERIAL_CLOTH("A dull green cloth")
  BRA_TRANSFER(+1)
  CON_TRANSFER(-1)
  dilcopy level_restrict@function (25,0,0,"");
  dilcopy abi_restrict@function (ABIL_BRA,40,0,0,"");
end
/*------ NOTEBOOK ------*/
notebook
  names {"a notebook", "notebook", "paper"}
  title "a black notebook"
  descr "A small black notebook has been carelessly left here."
  extra{}
  "The writing seems to be in some sory of code."
  type ITEM_NOTE
  manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
  weight 1
end
/*------ SOUL NOTE ------*/
soul_note
  names {"an old worn note", "note", "worn", "paper"}
  title "an old worn note"
  descr "A tattered piece of paper is laying on the floor."
  extra{}
  "The note is old and tarnished, you can barely make out the scrawl.&n&n
  It reads..&n&n
  I am to die here so,&n
  he who finds this note can know; &n
  search the ceiling &n
  in a cave of sin, &n
  and find a dagger of old.&n"
  type ITEM_NOTE
  extra{"$identify"}
  "This is probably an important hint."
  manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
  weight 1
end
/*------ QUEST MAP ------*/
quest_map
  names {"map of Baardek", "quest_map", "map"}
  title "a bloodied map of the Baardek keep"
  descr "A simple paper map of the keep is laying here covered in blood."
  extra{}
  "Alot of blood is splattered on this otherwise fine map of the keep:
  &l
  ,----------------------------------------------,
  |                                              |
  `----------------------------------------------'
   |                               &br             &bn|
   |          --   1st Floor  --      &br          &bn|
   |  &br  &bn                                  &br      &bn|
   |  &br &bn                                       &br  &bn|
   |   .___________________________________.    |
   |   |      |      |      |   |          |    |
   |   |      |      |      |   |          |    |
   |   |---\------\---------'   '--\-------|    |
   |   |             |                |    |    |
   |   \  &br &bn          \                     |    |
   |   |             |                |    |    |
   |   |---\-----&br------&bn-------\------------|    |
   |   |        | &br  &bn                  |    |    |
   |   |        |   &br     &bn             \    |    |
   |   |________|__&br__&bn__&br__&bn_____________|____|    |
   |                 &br    &bn              &br   &bn      |
   |                                      &br &bn     |
  ,----------------------------------------------,
  | &br    &bn                                         |
  `----------------------------------------------'
  &f"
  extra{"$identify"}
  ""
  type ITEM_NOTE
  manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
  weight 1
end

/*------ THE MAP ------*/
the_map
  names {"map of Baardek", "the_map", "map"}
  title "a map of the Baardek keep"
  descr "A simple paper map of the keep is laying here."
  extra{}
  "
  &l
  ,----------------------------------------------,
  |                                              |
  '----------------------------------------------'
   |                                            |
   |          --   1st Floor  --                |
   |                                            |
   |                                            |
   |   .___________________________________.    |
   |   |      |      |      |   |          |    |
   |   |      |      |      |   |          |    |
   |   |---\------\---------'   '--\-------|    |
   |   |             |                |    |    |
   |   \             \                     |    |
   |   |             |                |    |    |
   |   |---\------------------\------------|    |
   |   |        |                     |    |    |
   |   |        |                     \    |    |
   |   |________|_____________________|____|    |
   |                                            |
   |                                            |
  ,----------------------------------------------,
  |                                              |
  '----------------------------------------------'
  &f"
  extra{"$identify"}
  ""
  type ITEM_NOTE
  manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
  weight 1
dilbegin the_map();
var
  newmap  :unitptr;
code
{
  heartbeat := PULSE_SEC * 3;
  :start:
  wait(SFB_COM, (self.outside.position == POSITION_FIGHTING));
  if(self.outside.type == UNIT_ST_PC) goto start;
  if(self.outside.hp > 40) goto start;
  newmap := load("quest_map@sands2");
  link(newmap, self.outside);
  destroy(self);
  quit;
}
dilend
end
/*------ HOLE / PORTAL ------*/
portal
  names {"portal", "hole"}
  title "the Portal"
  descr "&c+wA pure white portal swirls mystically on the ground.&cw"
  extra{}
  "You get dizzy just looking into the bright swirling mist, some people
  seem to be on the other side, Is that the Beastly Fido you see?"
  extra{"$identify"}
  "IT would appear to be a gate to another dimention or something.."
  flags {UNIT_FL_MAGIC}
  weight 500
dilbegin portal();
var
  Tinterrupt  :integer;
  Tcounter    :integer;
  inner       :string;
  findin      :unitptr;
code
{
  heartbeat := PULSE_SEC * 3;
  act("A shimmering portal opens in the floor!", A_SOMEONE, self, null, null, TO_ALL);
  Tcounter := 0;
 :start:
  Tinterrupt:= interrupt(SFB_TICK, TRUE, tick_tick);
  wait(SFB_CMD, ((command(CMD_ENTER)) and (argument == "portal")));
  clear(Tinterrupt);
  if(TUNISK_ONGOING in activator.quests)
  {
    act("&c+bYou enter the portal and it sucks you through.&cw", A_SOMEONE, activator, null, null, TO_CHAR);
    act("$1n places a foot in the portal and is instantly sucked through.", A_SOMEONE, activator, null, null, TO_REST);
    link(activator, findroom("square@udgaard"));
    block;
    exec("look", activator);
    act("$1n lands with a thump after $1e falls from the sky.", A_SOMEONE, activator, null, null, TO_REST);
    exec("emote quivers and then winks out of existance.", self);
    destroy(self);
    quit;
  }
  if(TUNISK_COMPLETE in activator.quests)
  {
    act("&c+bYou enter the portal and it sucks you through.&cw", A_SOMEONE, activator, null, null, TO_CHAR);
    act("$1n places a foot in the portal and is instantly sucked through.", A_SOMEONE, activator, null, null, TO_REST);
    link(activator, findroom("square@udgaard"));
    block;
    exec("look", activator);
    act("$1n falls from the sky and lands with a thump.", A_SOMEONE, activator, null, null, TO_REST);
    exec("emote quivers and then winks out of existance.", self);
    destroy(self);
    quit;
  }
  else
  {
    pause;
    act("The portal spits you out.", A_SOMEONE, activator, null, null, TO_CHAR);
    act("The portal spits $1N onto the floor!", A_SOMEONE, activator, null, null, TO_REST);
    block;
    exec("emote quivers and then winks out of existance.", self);
    destroy(self);
    quit;
  }
 :tick_tick:
  clear(Tinterrupt);
  Tcounter := Tcounter +1;
  if(Tcounter < 15) goto start;
  exec("emote quivers and then winks out of existance.", self);
  destroy(self);
}
dilend
end
/*------ QUEST DAGGERS ------*/
mind_scorcher
  names {"mind scorcher", "scorcher", "questobj", "dagger"}
  title "Mind Scorcher"
  descr "A small and ancient looking ceremonial dagger is here."
  extra{}
  "This dagger is one of the three that curl a Dragon's bane. It was created by Hondole The Dragonslayer, and used to remove the heart's of slain dragons in celebrative ceremonies."
  extra{"$identify"}
  "This dagger is a quest item."
  manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD,MANIPULATE_HOLD}
  WEAPON_DEF(WPN_DAGGER,8,2)
  flags {UNIT_FL_MAGIC}
  weight 2
  cost 2 PLATINUM_PIECE
  rent 2 GOLD_PIECE, 1 SILVER_PIECE
end
soul_burner
  names {"soul burner", "burner", "questobj", "dagger"}
  title "Soul Burner"
  descr "A small and ancient looking ceremonial dagger is here."
  extra{}
  "This dagger is one of the three that curl a Dragon's bane. It was created by Hondole The Dragonslayer, and used to remove the heart's of slain dragons in celebrative ceremonies."
  extra{"$identify"}
  "This dagger is a quest item."
  manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD,MANIPULATE_HOLD}
  WEAPON_DEF(WPN_DAGGER,9,2)
  flags {UNIT_FL_MAGIC}
  weight 2
  cost 2 PLATINUM_PIECE
  rent 2 GOLD_PIECE, 1 SILVER_PIECE
end
body_scalder
  names {"body scalder", "scalder", "questobj", "dagger"}
  title "Body Scalder"
  descr "A small and ancient looking ceremonial dagger is here."
  extra{}
  "This dagger is one of the three that curl a Dragon's bane. It was created by Hondole The Dragonslayer, and used to remove the heart's of slain dragons in celebrative ceremonies."
  extra{"$identify"}
  "This dagger is a quest item."
  manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD,MANIPULATE_HOLD}
  WEAPON_DEF(WPN_DAGGER, 8 ,3)
  flags {UNIT_FL_MAGIC}
  weight 2
  cost 2 PLATINUM_PIECE
  rent 2 GOLD_PIECE, 1 SILVER_PIECE
end
/*------ GUARD TABLE ------*/
guard_table
  names {"a table", "table"}
  title "a long table"
  descr "&crA lengthy table sits on the floor.&cw"
  extra{} "The table is on the floor."
  extra{"$identify"}
  "It's just a freaking table, leave it alone!"
  MATERIAL_WOOD("Deeply grained oak wood.")
  weight 5000
end
/*------ BED ------*/
bed
  names {"a bed", "bed"}
  title "an exceptionally large bed"
  descr "&crA large bed is resting on the floor.&cw"
  extra{} "The bed is on the floor."
  extra{"$identify"}
  "It's just a freaking bed, leave it alone!"
  MATERIAL_WOOD("Deeply grained oak wood.")
  weight 5000
end
/*------ DEMANDS ------*/
demands
  names {"a note", "paper", "note"}
  title "a note from Tunisk"
  descr "A piece of paper is laying here."
  extra{} "&s3In a time long past, a man called Hondole came from the temple of
Udgaard. None had seen him before but it was a peaceful time and he was
welcomed like many adventurers who had emerged from the temple before him.&n
&s3The time of peace was short lived, for sheep began to disappear from neighboring
farms, and cattle from neighboring pastures. Soon small children began to
disappear from the forest of Haon Dor and much concern spread through the
city. Rumours of Dragons hunting in the night brought fear into the hearts
of the udgaard people and doors were barred at night as they hadn't been in
generations.&n&s3Hondole came to the people of Udgaard and announced that he
too was afraid of the dragons, but he would not stand in fear any longer. Hondole
took a lance from his home and left for many months. When he returned, the large
head of a dragon accompanied him and there was much rejoicing in the city.
The slayings continued into the winter and the townspeople decided they should
reward Hondole for his bravery. The smithes of the city began to forge and
the priests began to pray, together they made three daggers; Body, Mind, and
Soul.&n&s3The essences of Dragons long dead were used along with the prayers of
the priests, to create ceremonial daggers for Hondole to carry and use to
carve the hearts out of slain beasts. Hondole's Triad they were called and
they are what I want. Since the death of Hondole, and the destruction of
all dragons near Udgaard the daggers have been spread throughout the land,
and they are:&n
&s3Body Scalder&n
&s3Mind Scorcher&n
&s3Soul Burner"
  type ITEM_NOTE
  manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
  weight 1
end
/*------ BOOK ------*/
book
  names {"book", "record"}
  title "a book"
  descr "A book from the Baardek Library is laying here."
  type ITEM_NOTE
  manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
  weight 5
end
/*------ TABLE ------*/
table
  names {"a table","table"}
  title "a long table"
  descr "&crA lengthy table rests on the floor.&cw"
  extra{}
  "The table is on the floor."
  extra{"$identify"}
  "It's just a freaking table, leave it alone!"
  MATERIAL_WOOD("Deeply grained oak wood.")
  weight 5000
end
/*------ MOP ------*/
mop
  names {"a mop", "mop"}
  title "a mop"
  descr "A filthy mop is propped in the corner."
  extra{}
  "The mop is dirty and uninteresting."
  extra{"$identify"}
  "It's just a freaking mop, leave it alone!"
  manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD, MANIPULATE_WIELD}
  WEAPON_DEF(WPN_QUARTERSTAFF, 1, 0)
  MATERIAL_WOOD("Deeply grained oak wood.")
  weight 2
end
/*------ TOILET ------*/
toilet
  names {"a toilet", "toilet"}
  title "a wooden toilet"
  descr "&crA wooden toilet is standing here.&cw"
  extra{}
  "The toilet is simple but useful."
  MATERIAL_WOOD("Deeply grained oak wood.")
  weight 20
dilbegin toilet();
var
code
{
  heartbeat:=PULSE_SEC*3;
 :start:
  wait(SFB_CMD, TRUE);
  if(command("flush toilet")){
    block;
    act("&c+b$1 flushes the toilet, floooooosh!&cw", A_SOMEONE, activator, null, null, TO_REST);
    act("&c+bYou flush the toilet, floooooosh!&cw", A_SOMEONE, activator, null, null, TO_CHAR);
  }
  if(command(CMD_SIT)){
    if(activator.position == POSITION_SITTING) goto start;
    block;
    act("$1n sits on the toilet.", A_SOMEONE, activator, null, null, TO_REST);
    act("You sit on the toilet.", A_ALWAYS, activator, null, null, TO_CHAR);
    activator.position := POSITION_SITTING;
    position_update(activator);
  }
  goto start;
}
dilend
end
/*------ CHAIR ------*/
chair
  names {"a chair", "chair"}
  title "a wooden chair"
  descr "&crA wooden chair is standing here.&cw"
  extra{}
  "This chair is relatively simple. It has four legs and a seat. Much like a chair."
  MATERIAL_WOOD("Deeply grained oak wood.")
  weight 20
dilbegin chair();
code{
  :start:
  wait(SFB_CMD, TRUE);
  if(command(CMD_SIT)){
    if(activator.position == POSITION_SITTING) goto start;
    block;
    act("The chair squeaks loudly as $1n sits on it.", A_SOMEONE, activator, null, null, TO_REST);
    act("The chair squeaks loudly as you sit on it.", A_ALWAYS, activator, null, null, TO_CHAR);
    activator.position := POSITION_SITTING;
    position_update(activator);
  }
  if(command(CMD_REST)){
    if(activator.position == POSITION_RESTING) goto start;
    block;
    act("The chair squeaks loudly as $1n sits to rest on it.", A_SOMEONE, activator, null, null, TO_REST);
    act("The chair squeaks loudly as you sit and rest on it.", A_ALWAYS, activator, null, null, TO_CHAR);
    activator.position := POSITION_RESTING;
    position_update(activator);
  }
  goto start;
}
dilend
end
/*------ MAHRNAK'S NOTES ------*/
mahrnak_notes
  names {"mahrnak's notes", "ma_notes", "notes"}
  title "Mahrnak's Notes"
  descr "Some notes are here."
  extra{}
  "The notes are very much jibberish, you can make out a design sketch that looks much like a sword with notches along its side."
  extra{"$identify"}
  "These notes are the beginning design for a sword breaker."
  type ITEM_NOTE
  manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
  weight 1
end
/*------ MUG ------*/
mug
  names {"a mug", "mug", "baardek beer", "beer"}
  title "a mug of Baardek Beer"
  descr "A brownish mug is laying here, helpless and lost."
  extra{}
  "The mug is brownish in colour and seems to crave Baardek Beer."
  extra{"$identify"}
  "It's just a freaking mug, leave it alone!"
  manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD, MANIPULATE_WEAR_HEAD}
  MATERIAL_WOOD("Deeply grained oak wood.")
  LIQ_DEF ( LIQ_BEER, 1, 1, 1, 0)
  type ITEM_DRINKCON
  weight 1
end
/*------ KEG ------*/
keg
  names {"a keg","keg", "beer"}
  title "a Keg of Baardek Brew"
  descr "&crA Keg of Baardek Brew rests on the floor.&cw"
  extra{}
  "The keg contains a whole bunch of Baardek beer, brewed by Mashkee himself, there is a tag next to it that says &c+g'PULL ROPE FOR MUG OF BEER'&cw."
  extra{"$identify"}
  "It's just a freaking keg, leave it alone!"
  MATERIAL_WOOD("Deeply grained oak wood.")
  LIQ_DEF ( LIQ_BEER, 20000, 20000, 20000, 0)
  flags {UNIT_FL_MAGIC}
  weight 500
dilbegin keg();
var
  loaded :unitptr;
  isit   :unitptr;
code
{
  heartbeat:=PULSE_SEC*4;
  :start:
  wait(SFB_CMD, ((command("pull")) and (argument == "rope")));
  if(not(findunit(self, "mug", FIND_UNIT_SURRO, null)))
  {
    loaded:=load("mug@sands2");
    link(loaded, activator.outside);
    act("$1N pulls a rope and $2n drops to the floor.", A_SOMEONE, activator, loaded, null, TO_REST);
    act("You pull a rope and $2n drops to the floor.", A_SOMEONE, activator, loaded, null, TO_CHAR);
  }
  else
  {
    act("$1N pulls a rope trying to create a big mess.", A_SOMEONE, activator, loaded, null, TO_REST);
    act("You pull a rope and try to make a big mess, clear all the other mugs out of the room!", A_SOMEONE, activator, loaded, null, TO_CHAR);
  }
  block;
  goto start;
}
dilend
end
/*------ FUR ------*/
fur
  names {"a fur", "fur"}
  title "a Baardek fur"
  descr "Some brown fur is laying here."
  extra{}
  "A simple fur from some animal, it is ready to be prepared and turned
  into clothing."
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_HEAD}
  ARMOUR_LEATHER(1, 0)
  cost 2 SILVER_PIECE
  MATERIAL_CLOTH("A brown fur")
end
/*------ PELT ------*/
pelt
  names {"a pelt", "pelt"}
  title "Baardek pelt"
  descr "A brown pelt is laying here."
  extra{}
  "The pelt is made of an animal the Cheleho have hunted. The skilled
  hands of the Cheleho slaves have turned it into a warm pelt."
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_CHEST}
  ARMOUR_LEATHER(1, 0)
  cost 2 GOLD_PIECE
  MATERIAL_CLOTH("A brown fur")
end
/*------ COAT ------*/
coat
  names {"a coat of fur", "fur coat", "coat"}
  title "Baardek fur coat"
  descr "A fur coat is laying here."
  extra{}
  "It's just a coat of fur."
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_ABOUT}
  ARMOUR_CLOTHES(2, 0)
  cost 3 GOLD_PIECE
  MATERIAL_CLOTH("A brown fur")
end
/*------ COAT 2 ------*/
coat2
  names {"a beer stained coat", "coat"}
  title "Beer stained coat"
  descr "The coat of a brewer is laying here."
  extra{}
  "This coat is a highly attractive ,yet beer stained, article of clothing."
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_ABOUT}
  ARMOUR_LEATHER(2, 0)
  cost 3 GOLD_PIECE
  MATERIAL_CLOTH("A brown fur")
end
/*------ MINSTREL CLOAK ------*/
minstrel_cloak
  names {"a colourful cloak", "cloak"}
  title "Colourful cloak"
  descr "A very colourful cloak is crumpled on the ground."
  extra{}
  "This is the cloak of the Baardek minstrel, it is highly attractive."
  flags {UNIT_FL_MAGIC, UNIT_FL_TRANS}
  type ITEM_CONTAINER
  capacity 3
  value[0] ARM_CLOTHES
  value[1] 4
  value[2] 1
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_ABOUT, MANIPULATE_ENTER, MANIPULATE_HOLD}
  cost 1 GOLD_PIECE
  rent 2 SILVER_PIECE, 1 COPPER_PIECE
  weight 2
  MATERIAL_CLOTH("A colourful silk")
  BRA_TRANSFER(+1)
  CHA_TRANSFER(+1)
  DEX_TRANSFER(+1)
  CON_TRANSFER(+1)
end
/*------ GREEN CLOAK ------*/
green_cloak
  names {"a green cloak", "cloak"}
  title "Green cloak"
  descr "A long cloak of green lies on the ground."
  extra{}
  "This is a simple but long green cloak, its trim appears to be
  immitation gold. The Baardekan symbol is borne proudly on its
  back."
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_ABOUT, MANIPULATE_HOLD}
  ARMOUR_LEATHER(0, 0)
  cost 2 SILVER_PIECE
  weight 2
  MATERIAL_CLOTH("A green silk")
  DEX_TRANSFER(+1)
  CON_TRANSFER(-1)
end

/*------ UNDIES ------*/
undies
  names {"fur underwear", "underwear", "undies"}
  title "a pair of Baardek fur underwear"
  descr "Someone's fur underwear is laying here looking dirty."
  extra{}
  "The are slightly dirty looking, but also warm.."
  extra{"$identify"}
  "They are just underwear, they do add a bit of Charisma, but what underwear doesn't?"
  extra{"$rem_s"}
  "You slide out of the underwear exotically."
  extra{"$rem_o"}
  "$1n slips out of $1s underwear suggestively."
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_LEGS}
  ARMOUR_CLOTHES(0, 0)
  CHA_TRANSFER(+1)
  cost 4 SILVER_PIECE
  MATERIAL_CLOTH("A brown fur")
end
/*------ HARP ------*/
harp
  names {"frank's harp", "harp", "frank_harp"}
  title "Frank's Harp"
  descr "Frank seems to have left his harp here."
  extra{}
  "This beautiful harp belongs to Frank the Baardekan Minstrel, perhaps you should
  bring it to him as a gesture of kindness."
  extra{"$identify"}
  "This harp belongs to Frank, he who takes it risks much."
  flags {UNIT_FL_MAGIC}
  manipulate {MANIPULATE_TAKE, MANIPULATE_HOLD}
  rent 4 GOLD_PIECE
dilbegin harp();
code
{
  heartbeat:=PULSE_SEC*3;
 :start:
  wait(SFB_CMD, ((command("play")) and ("harp" in argument)));
  if(activator == self.outside){
    if(self.equip == WEAR_HOLD){
      act("$1N plays a merry tune on $1s harp..", A_SOMEONE, self.outside, null, null, TO_REST);
      act("You play a merry tune on your harp..", A_SOMEONE, self.outside, null, null, TO_CHAR);pause;pause;
      act("$1N plucks away at the harp, tra la la.", A_SOMEONE, self.outside, null, null, TO_REST);
      act("You pluck at the strings some more.", A_SOMEONE, self.outside, null, null, TO_CHAR);pause;pause;
    }
    else{
      act("$1N plays the air harp, what a fool..", A_SOMEONE, self.outside, null, null, TO_REST);
      act("You can only play a harp that you hold..", A_SOMEONE, self.outside, null, null, TO_CHAR);
    }
  }
  else act("You don't have the harp, $2N does.", A_SOMEONE, activator, self.outside, null, TO_CHAR);
  block;
  goto start;
}
dilend
end
/*------ LOIN CLOTH ------*/
loin_cloth
  names {"loin cloth", "loin", "cloth"}
  title "a dirty loincloth"
  descr "Someone's loin cloth is laying here looking dirty."
  extra{}
  "They are quite dirty and don't look like they provide much warmth."
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_LEGS}
  ARMOUR_CLOTHES(0, 0)
  cost 4 SILVER_PIECE
  weight 1
  MATERIAL_CLOTH("A brown cloth")
end
/*------ CLOTH HALTER ------*/
cloth_halter
  names {"halter top", "halter", "top"}
  title "a dirty halter top"
  descr "Someone's halter top is laying here looking dirty."
  extra{}
  "It is dirty, very feminine, and doesn't look like it provides much warmth."
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_CHEST}
  ARMOUR_CLOTHES(0, 0)
  cost 4 SILVER_PIECE
  weight 1
  MATERIAL_CLOTH("A brown cloth")
end
/*------ SILKS CLOAK ------*/
silk_cloak
  names {"silk's cloak", "cloak", "pockets", "pocket"}
  title "Silk's Cloak"
  descr "Silk's cloak is crumpled on the floor."
  extra{}
  "This is Silk's Cloak, its secrets could be immesurable, or not. Perhaps it has pockets."
  extra{"$pockets", "pockets"}
  "Perhaps you should look IN the pockets, or put things in the pockets."
  extra{"$wear_s"}
  "Silk's cloak wraps itself around your body reluctantly."
  extra{"$wear_o"}
  "Silk's cloak cringes as $1n puts it on."
  extra{"$rem_s"}
  "Silk's cloak sighs as you remove it."
  extra{"$rem_o"}
  "$1n removes Silk's Cloak, it lets off a sigh."
  extra{"$identify"}
  "This is Silk's Cloak, it adds considerable dexterity but takes a touch of strength, It will also protect and cure crabs and has pockets to put things in."
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_ABOUT, MANIPULATE_ENTER, MANIPULATE_HOLD}
  dilcopy level_restrict@function (25,0,0,"");
  dilcopy abi_restrict@function (ABIL_DEX,40,0,0,"");
  flags {UNIT_FL_MAGIC, UNIT_FL_TRANS}
  type ITEM_CONTAINER
  capacity 3
  value[0] ARM_CLOTHES
  value[1] 8
  value[2] 2
  cost 3 GOLD_PIECE
  rent 2 GOLD_PIECE
  weight 2
  DEX_TRANSFER(+3)
  STR_TRANSFER(-1)
  MATERIAL_CLOTH("A greenish cloth")
dilbegin recall cloak();
var
  id :integer;
code
{
  heartbeat:=PULSE_SEC;
  :start:
  wait(SFB_DONE, TRUE);
  pause;
  while(self.equip == WEAR_ABOUT)
  {
    pause; pause;
    if(rnd(1,3900) == 25)
    {
      if("silk" in self.outside.names) pause;
      else act("$2n pouts for want of Silk.",A_SOMEONE, self.outside, self, null, TO_ALL);
    }
    if(dilfind("crabs@sandzone", self.outside))
    {
      pause; pause;
      id := dildestroy("crabs@sandzone", self.outside);
      act("The crabs on your body scream and fall off of you!", A_SOMEONE, self.outside, null, null, TO_CHAR);
      act("The crabs on $1N's body scream and fall off of $1m!", A_SOMEONE, self.outside, null, null, TO_REST);
    }
  }
}
dilend
end
/*------ BAARDEK PLATE ------*/
breast_plate
  names {"baardek plate", "green plate", "plate"}
  title "Green Breast Plate"
  descr "A green breast plate is laying here doing nothing important."
  extra{}
  "This plate is standard equipment for Baardek guards.."
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_BODY}
  dilcopy level_restrict@function (35,0,0,"");
  dilcopy abi_restrict@function (ABIL_STR,50,0,0,"");
  ARMOUR_PLATE(0, 0)
  cost 5 GOLD_PIECE
  rent 1 GOLD_PIECE
  weight 8
  STR_TRANSFER(+2)
  MATERIAL_METAL("A greenish metal")
end
/*------ BAARDEK HELM ------*/
helm
  names {"a baardek helmet", "green helmet", "helmet", "helm"}
  title "a Green Helmet"
  descr "A Baardek helmet is laying on the ground."
  extra{}
  "This helmet is standard equipment for Baardek guards.."
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_HEAD}
  dilcopy level_restrict@function (30,0,0,"");
  dilcopy abi_restrict@function (ABIL_STR,20,0,0,"");
  ARMOUR_PLATE(0, 0)
  cost 5 GOLD_PIECE
  weight 2
  MATERIAL_METAL("A greenish metal")
end
/*------ BAARDEK SLEEVES ------*/
sleeves
  names {"baardek sleeves", "green sleeves", "sleeves"}
  title "Green Sleeves"
  descr "A pair of green sleeves are relaxing here."
  extra{}
  "These sleeves are standard equipment for Baardek guards.."
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_ARMS}
  dilcopy level_restrict@function (30,0,0,"");
  dilcopy abi_restrict@function (ABIL_STR,20,0,0,"");
  ARMOUR_PLATE(0, 0)
  cost 5 GOLD_PIECE
  rent 1 GOLD_PIECE
  weight 3
  MATERIAL_METAL("A greenish metal")
end
/*------ BAARDEK LEGGINGS ------*/
leggings
  names {"baardek leggings", "green leggings", "leggings"}
  title "Green Leggings"
  descr "A pair of green leggings are relaxing here."
  extra{}
  "These leggings are standard equipment for Baardek guards.."
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_LEGS}
  dilcopy level_restrict@function (30,0,0,"");
  dilcopy abi_restrict@function (ABIL_STR,20,0,0,"");
  ARMOUR_PLATE(0, 0)
  cost 5 GOLD_PIECE
  rent 1 GOLD_PIECE
  weight 5
  MATERIAL_METAL("A greenish metal")
end
/*------ BAARDEK BOOTS ------*/
boots
  names {"green boots", "boots"}
  title "Green Boots"
  descr "A pair of green boots are sitting here."
  extra{}
  "These boots are standard equipment for Baardek guards.."
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_FEET}
  dilcopy level_restrict@function (15,0,0,"");
  dilcopy abi_restrict@function (ABIL_STR,20,0,0,"");
  ARMOUR_LEATHER(0, 0)
  cost 5 GOLD_PIECE
  rent 1 GOLD_PIECE
  weight 1
  MATERIAL_CLOTH("A greenish cloth")
end

/*------ BAARDEK SWORD ------*/
long_sword
  names {"longsword", "sword"}
  title "a Baardekan Longsword"
  descr "A Baardekan longsword glimers in the dust."
  extra{}
  "The standard issue Baardekan guard sword, is not too standard. It is of fairly high quality."
  extra{"$identify"}
  "This sword adds to strength and takes from constitution."
  manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD,MANIPULATE_HOLD}
  dilcopy level_restrict@function (20,0,0,"");
  dilcopy abi_restrict@function (ABIL_STR,30,0,0,"");
  WEAPON_DEF(WPN_LONG_SWORD,0,0)
  weight 9
  cost 4 GOLD_PIECE
  rent 3 GOLD_PIECE
  STR_TRANSFER(+3)
  CON_TRANSFER(-2)
end

/*------ REVOLUTION SWORD ------*/
revolution
  names {"revolution", "sword"}
  title "&c+gRevolution&cw, Bringer of Change"
  descr "&c+gRevolution&cw, the longsword of change, glimmers on the ground.&cw"
  extra{}
  "Revolution is a beautiful sword, and Revolution brings change. The fuel for such change is the blood of one's enemies. There is no activation necessary."
  extra{"$identify"}
  "Revolution will call forth help when the time is right and blood is spilled.."
  dilcopy level_restrict@function(40,0,0,"");
  dilcopy abi_restrict@function(ABIL_BRA,30,0,0,"");
  dilcopy quest_restrict@function(TUNISK_COMPLETE,0,25,"");
  manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD,MANIPULATE_HOLD}
  WEAPON_DEF(WPN_BROAD_SWORD,15,10)
  flags {UNIT_FL_MAGIC}
  weight 6
  cost 3 PLATINUM_PIECE
  SKILL_TRANSFER(SKI_RESCUE, 3)
  DEX_TRANSFER(+5)
  CON_TRANSFER(-2)
dilbegin revolution();
var
  iRand     :integer;
  mobassist :unitptr;
  creation  :string;
  hittext   :string;
code
{
  heartbeat:=PULSE_SEC*3;
  :start:
  iRand := 0;
  wait(SFB_COM, ((self.outside.position==POSITION_FIGHTING) and (self.equip == WEAR_WIELD)));
  iRand := rnd(1, (self.outside.level));
  if(iRand > 30)
  {
    creation:="minorblood@sands2";
    hittext:="SLITS";
  }
  if(iRand > 35)
  {
    creation:="midblood@sands2";
    hittext:="GASHES";
  }
  if(iRand > 40)
  {
    creation:="majorblood@sands2";
    hittext:="RIPS OPEN";
  }
  if(iRand > 30)
  {
    if(self.outside.mana > 0)
    {
      if (rnd(1,3) == 2)
      {
        act("$1n's Revolution flares up and "+hittext+" $2n's body!", A_SOMEONE, activator, activator.fighting, null, TO_NOTVICT);
        act("$1n's Revolution flares up and "+hittext+" your body!", A_SOMEONE, activator, activator.fighting, null, TO_VICT);
        act("Your Revolution flares up and "+hittext+" $2n's body!", A_SOMEONE, activator, activator.fighting, null, TO_CHAR);
        act("&c+rYour wound bleeds onto the ground!&cw", A_SOMEONE, activator.fighting, null, null, TO_CHAR);
        act("&c+r$1n's wound bleeds onto the ground!&cw", A_SOMEONE, activator.fighting, null, null, TO_REST);
        act("&c+rREVOLUTION BRINGS CHANGE!&cw", A_SOMEONE, activator, null, null, TO_ALL);
        self.outside.mana := (self.outside.mana - (self.outside.max_mana / 3));
        change_speed(self.outside, PULSE_VIOLENCE);
        position_update(self.outside);
        mobassist:=load(creation);
        dilcopy("dem_cmd@sands2("+self.outside.name+")", mobassist);
        link(mobassist, activator.outside);
        exec("emote appears in a bloody splash!", mobassist);
        exec("fol "+self.outside.name, mobassist);
        secure(mobassist, lostmob);
        while(self.outside.position == POSITION_FIGHTING) exec("hit "+self.outside.fighting.name, mobassist);
        mobassist := null;
        pause;
      }
    }
    else
    {
      act("$1n's Revolution sputters and hisses!", A_SOMEONE, activator, activator.fighting, null, TO_NOTVICT);
      act("$1n's Revolution sputters and hisses!", A_SOMEONE, activator, activator.fighting, null, TO_VICT);
      act("Your Revolution sputters and hisses!", A_SOMEONE, activator, activator.fighting, null, TO_CHAR);
      act("Using it with powerless hands scorches you!", A_SOMEONE, activator, activator.fighting, null, TO_CHAR);
      change_speed(self.outside, PULSE_VIOLENCE);
      self.outside.hp := self.outside.hp - 10;
      position_update(self.outside);
    }
  }
  goto start;
 :lostmob:
  mobassist := null;
  while(self.outside.position == POSITION_FIGHTING) pause;
  goto start;
}
dilend
end
/*------ SILVER DAGGER ------*/
silver_dagger
  names {"the silver dagger", "silver dagger", "dagger"}
  title "the Silver Dagger"
  descr "The dagger of spies glimmers on the ground."
  extra{}
  "This dagger is silver and smooth, warm to the touch. The blade appears
  to be as sharp as its forging day yet there is no doubt it has tasted
  blood. It is definatly a master spy's weapon."
  extra{"$identify"}
  "This dagger enhances dexterity and backstabbing."
  manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD,MANIPULATE_HOLD}
  dilcopy level_restrict@function (30,0,0,"");
  dilcopy abi_restrict@function (ABIL_DEX,50,0,0,"");
  WEAPON_DEF(WPN_DAGGER, 0,0)
  flags {UNIT_FL_MAGIC}
  weight 2
  cost 1 PLATINUM_PIECE
  rent 2 GOLD_PIECE
  SKILL_TRANSFER(SKI_BACKSTAB, 2)
  DEX_TRANSFER(+2)
dilbegin silver_dagger();
var
  mypc      :unitptr;
  mypcenemy :unitptr;
code
{
  heartbeat:=PULSE_SEC *3;
  :start:
  wait(SFB_COM, ((self.outside.position==POSITION_FIGHTING) and (self.equip == WEAR_WIELD)));
  act("&c+r$1N's Sliver Dagger slides through your flesh! OUCH!&cw", A_SOMEONE, self.outside, null, null, TO_VICT);
  act("&c+r$1N's Sliver Dagger hums and whines for BLOOD!&cw", A_SOMEONE, self.outside, null, null, TO_NOTVICT);
  act("&c+rYour Sliver Dagger hums and whines for BLOOD!&cw", A_SOMEONE, self.outside, null, null, TO_CHAR);
  while(self.outside.position == POSITION_FIGHTING) pause;
  goto start;
}
dilend
end
/*------ SLAVE ANKLE CUFF ------*/
anklecuff
  names {"slave's identification cuff", "ankle cuff", "cuff"}
  title "Slave's identification ankle cuff"
  descr "A thin iron ankle cuff is laying on the ground."
  extra{}
  "This cuff is used by the Baardekans to identify their slaves."
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_ANKLE}
  weight 1
  cost 5 SILVER_PIECE
end
/*------ GREEN EAR CUFF ------*/
earcuff
  names {"green earcuff", "ear cuff", "earcuff", "cuff"}
  title "&c+ga green earcuff&cw"
  descr "A small green earcuff sparkles on the floor."
  extra{}
  "This cuff is used by the Baardekans for purposes unknown. Perhaps further
  identification will help."
  extra{"$identify"}
  "While wearing this cuff you can spy on another player by typing listen <target>
  of course you could fail.."
  dilcopy level_restrict@function (15,0,0,"");
  dilcopy abi_restrict@function (ABIL_DEX,20,0,0,"");
  dilcopy abi_restrict@function (ABIL_BRA,35,0,0,"");
  flags {UNIT_FL_MAGIC}
  manipulate {MANIPULATE_TAKE, MANIPULATE_WEAR_EAR}
  value[1] 10
  weight 1
  DEX_TRANSFER(+1)
  cost 5 SILVER_PIECE
  rent 1 SILVER_PIECE, 2 COPPER_PIECE
dilbegin aware earcuff();
var
  who       :string;
  uwho      :unitptr;
  temp      :string;
  arg       :string;
  i_quit    :integer;
code
{
  heartbeat := PULSE_SEC *2;
  :start:
  wait(SFB_CMD, (command("listen")) and (activator == self.outside));
  who := argument;
  block;
  uwho := findunit(self.outside, who, FIND_UNIT_GLOBAL, null);
  if(((self.equip != WEAR_EAR_L) and (self.equip != WEAR_EAR_R)))
  {
    act("You must wear the cuff to listen to someone.", A_SOMEONE, self.outside, null, null, TO_CHAR);
    goto start;
  }
  if(not uwho)
  {
    act("There is no-one here by that name.", A_SOMEONE, self.outside, null, null, TO_CHAR);
    goto start;
  }
  if(dilfind("spy_me@sands2", uwho))
  {
    act("&c+wSomeone is already spying on $2n!&cw", A_SOMEONE, self.outside, uwho, null, TO_CHAR);
    goto start;
  }
  if(uwho.level > 200)
  {
    act("&c+wYou are not godly enough to spy on them!&cw", A_SOMEONE, self.outside, uwho, null, TO_CHAR);
    goto start;
  }
  if(rnd(1, 600) < uwho.level)
  {
    act("&c+wYou fail!&cw", A_SOMEONE, self.outside, uwho, null, TO_CHAR);
    if(rnd(1,3) == 3) act("&c+c$2n just tried to spy on you!&cw", A_SOMEONE, uwho, self.outside, null, TO_CHAR);
    else act("&c+cSomeone just tried to spy on you!&cw", A_SOMEONE, uwho, self.outside, null, TO_CHAR);
    pause;
    act("&c+wA cracking noise comes from $2n.&cw", A_SOMEONE, self.outside, self, null, TO_CHAR);
    self.hp := self.hp - 3;
    position_update(self);
    quit;
  }
  act("&c+wYou are now spying on $2n.&cw", A_SOMEONE, self.outside, uwho, null, TO_CHAR);
  dilcopy("spy_me@sands2", uwho);
  who := uwho.name;
  :spying:
  wait(SFB_MSG, TRUE);
  arg := argument;
  if(((self.equip != WEAR_EAR_L) and (self.equip != WEAR_EAR_R))) goto start;
  if("SPY:" in argument)
  {
    temp := getword(arg);
    temp := getword(arg);
  }
  else goto spying;
  if(temp == "DONE:")
  {
    temp := getword(arg);
    if(temp == who)
    {
      act("&c+wYour earcuff spits and pops, suddenly you feel alone.&cw", A_ALWAYS, self.outside, null, null, TO_CHAR);
      goto start;
    }
    else goto spying;
  }
  if(temp == who)
  {
    if(self.outside.mana < 10)
    {
      self.outside.mana := 0;
      act("&c+wYour earcuff sputters and then falls silent.&cw", A_ALWAYS, self.outside, null, null, TO_CHAR);
      goto start;
    }
    self.outside.mana := self.outside.mana - 10;
    act("&c+wYour earcuff crackles:&n'&c+m"+arg+"&c+w'&cw", A_ALWAYS, self.outside, null, null, TO_CHAR);
    goto spying;
  }
  goto spying;
}
dilend
end
/*------ SHIELD ------*/
shield
  names {"a green shield", "shield", "baardek shield", "green shield"}
  title "a Baardekan Green Shield"
  descr "A Greenish coloured shield is relaxing in the corner."
  type ITEM_SHIELD
  extra{}
  "This shield is not of overwhelmingly good quality, it is standared isssue for the guards of Baardek, who need little to protect themselves."
  extra{"$identify"}
  "This shield is of medium quality and restricted to level 30+ and dex 30+"
  dilcopy level_restrict@function (30,0,0,"");
  dilcopy abi_restrict@function (ABIL_DEX,30,0,0,"");
  manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_SHIELD}
  weight 4
  cost 1 PLATINUM_PIECE
  rent 1 GOLD_PIECE
  SHIELD_DEF(SHIELD_MEDIUM, 0, 0)
end
/*------ THANATOS SWORD BREAKER ------*/
thanatos
  names {"thanatos", "sword breaker", "breaker", "shield"}
  title "&c+yThanatos&cw, Sword Breaker"
  descr "&c+yThanatos&cw, the Sword Breaker is here.&cw"
  type ITEM_SHIELD
  extra{}
  "&c+yThanatos&cw is a long sword with notches every inch down its blade,
  held in one's left hand you realize this is a shield not a weapon! There is
  no special activation for this sword breaker."
  extra{"$identify"}
  "The Thanatos has the ability to break an enemy's sword depending on
  Dexterity and Level, it is a quest item and is restricted from those who
  have not completed it."
  dilcopy level_restrict@function (30,0,0,"");
  dilcopy abi_restrict@function (ABIL_DEX,50,0,0,"");
  dilcopy abi_restrict@function (ABIL_STR,50,0,0,"");
  dilcopy quest_restrict@function (SILK_DONE,0,25,"");
  manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_SHIELD}
  flags {UNIT_FL_MAGIC}
  weight 4
  cost 3 PLATINUM_PIECE
  SHIELD_DEF(SHIELD_MEDIUM, 10, 5)
  STR_TRANSFER(-1)
  DEX_TRANSFER(-1)
dilbegin thanatos();
var
  pc        :unitptr;
  enemy     :unitptr;
  current   :unitptr;
code
{
  heartbeat := PULSE_SEC *2;
:start:
  wait(SFB_COM, ((self.outside.position == POSITION_FIGHTING) and (self.equip==WEAR_SHIELD) and (equipment(self.outside.fighting, WEAR_WIELD)!=null)));
  pc := self.outside;
  enemy := pc.fighting;
  secure(pc, start);
  secure(enemy, start);
  pause;
  while(pc.position == POSITION_FIGHTING){
    if((rnd(1, 310) < pc.level) and (pc.abilities[ABIL_DEX] > (enemy.abilities[ABIL_DEX] / 2))){
      current := equipment(enemy, WEAR_WIELD);
      if(current == null) goto start;
      if((current.value[0] > 10) and (current.value[0] < 21)){
        act("&c+bThe Thanatos catches $2n's $3N and SHATTERS it!&cw",A_SOMEONE,self.outside,self.outside.fighting,current,TO_CHAR);
        act("&c+bYour $3N SHATTERS as it catches on $2n's Thanatos!&cw",A_SOMEONE,self.outside.fighting,self.outside,current,TO_CHAR);
        act("&c+b$1n's Thanatos catches $2n's $3N and SHATTERS it!&cw",A_SOMEONE,self.outside,enemy,current,TO_NOTVICT);
        current.hp:=0;
        self.hp := self.hp - 1;
        position_update(current);
        unequip(current);
        position_update(enemy);
        position_update(self);
        pause;
      }
    }
  }
  goto start;
}
dilend
end
/*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*/
/*-=-=-=-=-=-=-=-=-=-=-=-= Reset -=-=-=-=-=-=-=-=-=-=-=-=-=*/
/*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*/
%reset
/*---------- DOORS ------------*/
door cave_sin UP {EX_OPEN_CLOSE, EX_CLOSED, EX_HIDDEN}
door secret_rm DOWN {EX_OPEN_CLOSE, EX_CLOSED, EX_HIDDEN}
door pit_3 NORTH {EX_OPEN_CLOSE, EX_CLOSED, EX_HIDDEN}
door tunnel_out_1 SOUTH {EX_OPEN_CLOSE, EX_CLOSED, EX_HIDDEN}
door tunnel_out_6 UP   {EX_OPEN_CLOSE, EX_CLOSED}
door well_rm      DOWN {EX_OPEN_CLOSE, EX_CLOSED}
door bedroom2 WEST {EX_OPEN_CLOSE, EX_CLOSED}
door brewer_room EAST {EX_OPEN_CLOSE, EX_CLOSED}
door g_office EAST {EX_OPEN_CLOSE, EX_CLOSED}
door s_office WEST {EX_OPEN_CLOSE, EX_CLOSED}
door s_office NORTH {EX_OPEN_CLOSE, EX_CLOSED}
door basement3 SOUTH {EX_OPEN_CLOSE, EX_CLOSED}
door tunnel_out_2 NORTH {EX_OPEN_CLOSE, EX_CLOSED}
door cave_sin SOUTH {EX_OPEN_CLOSE, EX_CLOSED}
door keep2_1  WEST {EX_OPEN_CLOSE, EX_CLOSED}
door gate EAST {EX_OPEN_CLOSE, EX_CLOSED}
door bedroom  NORTH {EX_OPEN_CLOSE, EX_CLOSED}
door bedroom2 SOUTH {EX_OPEN_CLOSE, EX_CLOSED}
door keep2_3 EAST {EX_OPEN_CLOSE, EX_CLOSED}
door keep2_4 WEST {EX_OPEN_CLOSE, EX_CLOSED}
door keep2_1 SOUTH {EX_OPEN_CLOSE, EX_CLOSED}
door keep2_1 NORTH {EX_OPEN_CLOSE, EX_CLOSED}
door keep1_1 SOUTH {EX_OPEN_CLOSE, EX_CLOSED}
door keep3_1 NORTH {EX_OPEN_CLOSE, EX_CLOSED}
door keep2_3 NORTH {EX_OPEN_CLOSE, EX_CLOSED}
door keep2_3 SOUTH {EX_OPEN_CLOSE, EX_CLOSED}
door keep1_3 SOUTH {EX_OPEN_CLOSE, EX_CLOSED}
door keep3_3 NORTH {EX_OPEN_CLOSE, EX_CLOSED}
door keep2_5 SOUTH {EX_OPEN_CLOSE, EX_CLOSED}
door keep3_5 NORTH {EX_OPEN_CLOSE, EX_CLOSED}
door pit_room SOUTH {EX_OPEN_CLOSE, EX_CLOSED}
door keep2_6  NORTH {EX_OPEN_CLOSE, EX_CLOSED}
door keep1_4 EAST {EX_OPEN_CLOSE, EX_CLOSED}
door keep1_5 WEST {EX_OPEN_CLOSE, EX_CLOSED}
door dining2 EAST {EX_OPEN_CLOSE, EX_CLOSED}
door kitchen WEST {EX_OPEN_CLOSE, EX_CLOSED}
door tower6     UP   {EX_OPEN_CLOSE, EX_CLOSED}
door silk_tower DOWN {EX_OPEN_CLOSE, EX_CLOSED}

/*--------- LOADS ----------*/
load pos_st_gate into hill6@warntz max 10
load pos_st_gate into field7@trees max 10
load pos_st_gate into dock_enter@xiyang2 max 10
load pos_st_gate into courtyard8@gnome max 10
load pos_st_gate into cross_room@hades7 max 10
load pos_st_gate into stair_101@reslab max 10
load pos_st_gate into beach4_3@sandzone max 10
load neg_st_gate into gate_home_1 local 1
load neg_st_gate into gate_home_2 local 1
load neg_st_gate into gate_home_3 local 1
load neg_st_gate into gate_home_4 local 1
load neg_st_gate into gate_home_5 local 1
load neg_st_gate into gate_home_6 local 1
load keg into keep3_1 local 1
load keg into brewer_room local 1
load guard_table into keep3_1 max 1
load toilet into keep3_3 local 1
load chair into keep1_1 local 1
load chair into keep1_3 local 1
load table into keep1_1 local 1
load table into keep1_3 local 1
load table into dining0 local 1
load table into dining2 local 1
load table into keep3_5 local 1
load chair into lib0_4 local 1
load table into lib0_4 local 1
load mop into keep1_4 local 3
load mop into keep1_4 local 3
load chat_board@garden into keep3_3 local 1
load bed into bedroom local 1

load soul_note into jail@udgaard max 1
load soul_burner into secret_rm@sands2 max 1


/*------- People -------*/
load librarian into lib0_1 max 1
{
  load quill@midgaard
  equip dag0@midgaard position WEAR_WIELD
  equip lth_pants@midgaard position WEAR_LEGS
  equip linnen_shirt@xiyang position WEAR_BODY
}
load ast_librarian into lib1_3 max 3
{
  load quill@midgaard
  equip dag0@midgaard position WEAR_WIELD
  equip lth_pants@midgaard position WEAR_LEGS
  equip linnen_shirt@xiyang position WEAR_BODY
}
load ast_librarian into lib1_2 max 3
{
  load quill@midgaard
  equip dag0@midgaard position WEAR_WIELD
  equip lth_pants@midgaard position WEAR_LEGS
  equip linnen_shirt@xiyang position WEAR_BODY
}
/* MS2020 was @midgaard (doesnt exist), changed to @ratswharf */
load whimboist into turning_point@ratswarf max 1
{
  equip funny_hat position WEAR_HEAD
  equip wiz_robe position WEAR_ABOUT
}
load morshaal into morshaal_hq max 1
load mahrnak into annex_101@reslab max 1
{
  load mahrnak_notes
  equip linnen_shirt@xiyang position WEAR_BODY
  equip clean_coat@reslab position WEAR_ABOUT
}
load spy into keep1_1 local 1
{
  equip earcuff position WEAR_EAR_L
  equip green_cloak position WEAR_ABOUT
  equip notebook position WEAR_HOLD
  load quill@midgaard
  equip dag0@midgaard position WEAR_WIELD
  equip lth_pants@midgaard position WEAR_LEGS
}
load spy into keep1_3 local 1
{
  equip earcuff position WEAR_EAR_L
  equip green_cloak position WEAR_ABOUT
  equip notebook position WEAR_HOLD
  load quill@midgaard
  equip dag0@midgaard position WEAR_WIELD
  equip lth_pants@midgaard position WEAR_LEGS
}
load shame_spirit into cave_shame max 1
{
  equip mind_scorcher position WEAR_WIELD
}
load pain_spirit into cave_pain max 1
{
  equip body_scalder position WEAR_WIELD
}
load mashkee into brewer_room max 1
{
  load mug@sands2
  equip mug position WEAR_HOLD
  equip coat2 position WEAR_ABOUT
  equip lth_pants@midgaard position WEAR_LEGS
  equip dag0@midgaard position WEAR_WIELD
}
load silk into silk_tower max 1
{
  equip silver_dagger position WEAR_WIELD
  equip silk_cloak position WEAR_ABOUT
  equip lth_pants1@midgaard WEAR_LEGS
}
load eros into bedroom max 1
{
  equip long_sword position WEAR_WIELD
  equip shield position WEAR_SHIELD
  equip breast_plate position WEAR_CHEST
  equip leggings position WEAR_LEGS
  equip sleeves position WEAR_ARMS
  equip helm position WEAR_HEAD
  equip boots position WEAR_FEET
  equip coat position WEAR_ABOUT
}
load tunisk into tunisk_cavern max 1
load grishalmus into g_office max 1
{
  equip linnen_shirt@xiyang position WEAR_BODY
  equip pelt position WEAR_CHEST
  equip coat position WEAR_ABOUT
  equip dag0@midgaard position WEAR_WIELD
  equip lth_pants@midgaard position WEAR_LEGS
}
load minstrel into dining2 max 1
{
  equip harp position WEAR_HOLD
  equip minstrel_cloak position WEAR_ABOUT
  equip dag0@midgaard position WEAR_WIELD
  equip lth_pants@midgaard position WEAR_LEGS
}
load samphore into s_office max 1
{
  equip pelt position WEAR_CHEST
  equip coat position WEAR_ABOUT
  equip lth_pants@midgaard position WEAR_LEGS
  equip dag0@midgaard position WEAR_WIELD
}
load trader into beach1_1@sandzone max 2
{
  load fur@sands2
  load pelt@sands2
  load coat@sands2
  load undies@sands2
  equip pelt position WEAR_CHEST
  equip coat position WEAR_ABOUT
  equip lth_pants@midgaard position WEAR_LEGS
  equip dag0@midgaard position WEAR_WIELD
}
load trader into basement3 max 2
{
  load fur@sands2
  load pelt@sands2
  load coat@sands2
  load undies@sands2
  equip dag0@midgaard position WEAR_WIELD
  equip pelt position WEAR_CHEST
  equip coat position WEAR_ABOUT
  equip lth_pants@midgaard position WEAR_LEGS
}
/*------- Slaves -------*/
load slave_cook into kitchen max 1
{
  equip rolling_pin@haon_dor position WEAR_WIELD
  equip loin_cloth position WEAR_LEGS
  equip anklecuff position WEAR_ANKLE_L
  equip mocassins@sandzone position WEAR_FEET
  equip dag0@midgaard position WEAR_WIELD
}
load fur_slave into basement1 local 2
{
  equip loin_cloth position WEAR_LEGS
  equip anklecuff position WEAR_ANKLE_L
  equip mocassins@sandzone position WEAR_FEET
  equip dag0@midgaard position WEAR_WIELD
}
load fur_slave into basement2 local 3
{
  equip loin_cloth position WEAR_LEGS
  equip anklecuff position WEAR_ANKLE_L
  equip mocassins@sandzone position WEAR_FEET
  equip dag0@midgaard position WEAR_WIELD
}
load fur_slave into basement2 local 3
{
  equip loin_cloth position WEAR_LEGS
  equip anklecuff position WEAR_ANKLE_L
  equip mocassins@sandzone position WEAR_FEET
  equip dag0@midgaard position WEAR_WIELD
}
load fur_slave into basement3 local 2
{
  equip loin_cloth position WEAR_LEGS
  equip anklecuff position WEAR_ANKLE_L
  equip mocassins@sandzone position WEAR_FEET
  equip dag0@midgaard position WEAR_WIELD
}
load fur_slave into basement3 local 2
{
  equip loin_cloth position WEAR_LEGS
  equip anklecuff position WEAR_ANKLE_L
  equip mocassins@sandzone position WEAR_FEET
  equip dag0@midgaard position WEAR_WIELD
}
load cute_slave into bedroom max 1
{
  equip loin_cloth position WEAR_LEGS
  equip cloth_halter position WEAR_CHEST
  equip anklecuff position WEAR_ANKLE_L
}
load slave_woman into keep2_3 max 3
{
  equip loin_cloth position WEAR_LEGS
  equip cloth_halter position WEAR_CHEST
  equip anklecuff position WEAR_ANKLE_L
  equip mocassins@sandzone position WEAR_FEET
}
load slave_woman into keep2_6 max 3
{
  equip loin_cloth position WEAR_LEGS
  equip cloth_halter position WEAR_CHEST
  equip anklecuff position WEAR_ANKLE_L
  equip mocassins@sandzone position WEAR_FEET
}
load slave_girl into keep1_5 max 2
{
  equip loin_cloth position WEAR_LEGS
  equip cloth_halter position WEAR_CHEST
  equip anklecuff position WEAR_ANKLE_L
  equip mocassins@sandzone position WEAR_FEET
}
load slave_boy into keep2_4 max 1
{
  equip loin_cloth position WEAR_LEGS
  equip anklecuff position WEAR_ANKLE_L
  equip mocassins@sandzone position WEAR_FEET
}
load pit_guy into tunnel_1 zonemax 4
{
  equip loin_cloth position WEAR_LEGS
  equip anklecuff position WEAR_ANKLE_L
  equip mocassins@sandzone position WEAR_FEET
  equip dag0@midgaard position WEAR_WIELD
}
load pit_guy into pit_floor zonemax 4
{
  equip loin_cloth position WEAR_LEGS
  equip anklecuff position WEAR_ANKLE_L
  equip mocassins@sandzone position WEAR_FEET
  equip dag0@midgaard position WEAR_WIELD
}
load pit_guy into pit_floor zonemax 4
{
  equip loin_cloth position WEAR_LEGS
  equip anklecuff position WEAR_ANKLE_L
  equip dag0@midgaard position WEAR_WIELD
  equip mocassins@sandzone position WEAR_FEET
}
load slave_man into keep2_7 max 2
{
  equip loin_cloth position WEAR_LEGS
  equip anklecuff position WEAR_ANKLE_L
  equip mocassins@sandzone position WEAR_FEET
  equip dag0@midgaard position WEAR_WIELD
}
load slave_man into keep3_3 max 2
{
  equip loin_cloth position WEAR_LEGS
  equip anklecuff position WEAR_ANKLE_L
  equip dag0@midgaard position WEAR_WIELD
  equip mocassins@sandzone position WEAR_FEET
}
/*------- Guards -------*/
load guard3 into bedroom2 max 1
{
  equip long_sword position WEAR_WIELD
  equip breast_plate position WEAR_CHEST
  equip sleeves position WEAR_ARMS
  equip boots position WEAR_FEET
  load the_map@sands2
}
load gen_guard into keep2_5 max 4
{
  equip long_sword position WEAR_WIELD
  equip shield position WEAR_SHIELD
  equip leggings position WEAR_LEGS
  equip helm position WEAR_HEAD
  load the_map@sands2
}
load gen_guard into keep2_3 max 4
{
  equip long_sword position WEAR_WIELD
  equip breast_plate position WEAR_CHEST
  equip leggings position WEAR_LEGS
  equip boots position WEAR_FEET
  load the_map@sands2
}
load gen_guard into keep3_1 max 4
{
  equip long_sword position WEAR_WIELD
  equip shield position WEAR_SHIELD
  equip breast_plate position WEAR_CHEST
  equip helm position WEAR_HEAD
  load the_map@sands2
}
load gen_guard into keep3_1 max 4
{
  equip long_sword position WEAR_WIELD
  equip leggings position WEAR_LEGS
  equip sleeves position WEAR_ARMS
  equip boots position WEAR_FEET
  load the_map@sands2
}
load guard1 into gate max 1
{
  equip long_sword position WEAR_WIELD
  equip breast_plate position WEAR_CHEST
  equip leggings position WEAR_LEGS
  equip helm position WEAR_HEAD
  equip boots position WEAR_FEET
  load the_map@sands2
}
load guard2 into gate max 1
{
  equip long_sword position WEAR_WIELD
  equip shield position WEAR_SHIELD
  equip sleeves position WEAR_ARMS
  equip helm position WEAR_HEAD
  load the_map@sands2
}
/*************************** END ***************************************/
%end

